<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SJN Solar Plant Daily Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2c5282;
            --accent-color: #4299e1;
            --success-color: #38a169;
            --warning-color: #dd6b20;
            --danger-color: #e53e3e;
            --light-color: #f7fafc;
            --dark-color: #2d3748;
            --text-color: #4a5568;
            --bg-color: #f8f9fa;
            --border-color: #e2e8f0;
            --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            --metric-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
            --edit-mode-color: #fffdf7;
            --print-primary: #000080;
            --print-secondary: #0066cc
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            font-size: 14px
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05)
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: #fff;
            padding: 25px 30px;
            border-radius: 8px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--card-shadow)
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2
        }

        .header-left h1 {
            font-size: 28px;
            margin-bottom: 5px;
            font-weight: 600;
            letter-spacing: 0.5px
        }

        #report-date {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 300
        }

        .header-right {
            display: flex;
            gap: 12px;
            align-items: center
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1)
        }

        .btn i {
            font-size: 14px
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: #fff
        }

        .btn-primary:hover {
            background-color: #3182ce;
            transform: translateY(-1px)
        }

        .btn-secondary {
            background-color: #718096;
            color: #fff
        }

        .btn-secondary:hover {
            background-color: #4a5568;
            transform: translateY(-1px)
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: #fff
        }

        .btn-danger:hover {
            background-color: #c53030;
            transform: translateY(-1px)
        }

        .btn-success {
            background-color: var(--success-color);
            color: #fff
        }

        .btn-success:hover {
            background-color: #2f855a;
            transform: translateY(-1px)
        }

        .time-bar {
            background-color: var(--dark-color);
            color: #fff;
            padding: 12px 25px;
            border-radius: 6px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--card-shadow)
        }

        .time-display {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px
        }

        .grid {
            display: grid;
            gap: 20px;
            margin-bottom: 25px
        }

        .metric-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr))
        }

        .metric-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 22px;
            box-shadow: var(--metric-shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color)
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1)
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--accent-color), var(--secondary-color))
        }

        .metric-title {
            font-size: 14px;
            color: #718096;
            margin-bottom: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px
        }

        .metric-value {
            font-size: 26px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-color)
        }

        .metric-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .positive {
            color: var(--success-color)
        }

        .negative {
            color: var(--danger-color)
        }

        .neutral {
            color: #718096
        }

        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            overflow: hidden;
            transition: box-shadow 0.3s;
            border: 1px solid var(--border-color)
        }

        .card:hover {
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1)
        }

        .card-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: #fff;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .card-header i {
            font-size: 18px
        }

        .card-body {
            padding: 25px
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px
        }

        th,
        td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color)
        }

        th {
            background-color: #f8fafc;
            font-weight: 500;
            color: var(--dark-color);
            text-transform: uppercase;
            font-size: 13px;
            letter-spacing: 0.5px
        }

        tr:hover {
            background-color: #f8fafc
        }

        .compact-table-container {
            overflow-x: auto;
            margin-bottom: 15px;
            max-height: 300px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #fff
        }

        .compact-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px
        }

        .compact-table th,
        .compact-table td {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            text-align: center;
            white-space: nowrap
        }

        .compact-table th {
            background-color: #f8fafc;
            font-weight: 500;
            color: var(--dark-color)
        }

        .compact-table input {
            width: 60px !important;
            padding: 4px 6px !important;
            font-size: 12px !important;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            height: 24px
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
            display: none;
            background-color: #fff
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2)
        }

        .time-input {
            width: 120px
        }

        .chart-container {
            position: relative;
            height: 450px;
            width: 100%;
            margin-top: 25px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 15px
        }

        .mini-chart-container {
            height: 300px;
            background-color: #fff;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 15px
        }

        .edit-mode .card,
        .edit-mode .metric-card {
            background-color: var(--edit-mode-color)
        }

        .edit-mode input,
        .edit-mode select,
        .edit-mode textarea {
            display: inline-block;
            background-color: #fff;
            border: 1px solid var(--border-color)
        }

        .edit-mode .display-value {
            display: none
        }

        .display-value {
            display: inline-block
        }

        .status-display {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block
        }

        .status-display.completed {
            background-color: rgba(56, 161, 105, 0.1);
            color: var(--success-color)
        }

        .status-display.pending {
            background-color: rgba(221, 107, 32, 0.1);
            color: var(--warning-color)
        }

        .status-display.in-progress {
            background-color: rgba(66, 153, 225, 0.1);
            color: var(--accent-color)
        }

        .report-history-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            background-color: #fff;
            margin-bottom: 8px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05)
        }

        .report-history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1)
        }

        .report-history-item small {
            display: block;
            font-size: 12px;
            color: #718096;
            margin-top: 4px
        }

        .history-actions {
            display: flex;
            gap: 10px
        }

        .history-actions .btn {
            padding: 6px 12px;
            font-size: 13px
        }

        .published-badge {
            background-color: var(--success-color);
            color: #fff;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: 500
        }

        .draft-badge {
            background-color: var(--warning-color);
            color: #fff;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: 500
        }

        @media print {
            @page {
                size: A4;
                margin: 1.5cm;
                margin-bottom: 2cm
            }

            body {
                font-size: 11pt !important;
                line-height: 1.4 !important;
                color: #000 !important;
                background: #fff !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                padding: 0 !important
            }

            .container {
                padding: 0 !important;
                box-shadow: none !important;
                background: none !important;
                max-width: 100% !important
            }

            body::before {
                content: "SJN Solar Plant Daily Report";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                text-align: center;
                padding: 10px;
                border-bottom: 1px solid #ddd;
                background: #fff;
                z-index: 100;
                font-size: 14pt;
                color: var(--print-primary)
            }

            body::after {
                content: "Page " counter(page);
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                text-align: center;
                padding: 10px;
                border-top: 1px solid #ddd;
                background: #fff;
                z-index: 100;
                font-size: 10pt
            }

            .container {
                padding-top: 60px !important;
                padding-bottom: 60px !important
            }

            header {
                background: none !important;
                color: var(--print-primary) !important;
                box-shadow: none !important;
                border-bottom: 2px solid var(--print-primary);
                margin-bottom: 20px;
                padding: 15px 0 !important
            }

            .header-left h1 {
                color: var(--print-primary) !important
            }

            table {
                font-size: 10pt !important;
                width: 100% !important;
                max-width: 100% !important;
                page-break-inside: avoid !important
            }

            th,
            td {
                padding: 8px 10px !important;
                border: 1px solid #ddd !important
            }

            .chart-container,
            .mini-chart-container {
                height: 350px !important;
                width: 100% !important;
                page-break-inside: avoid !important;
                border: 1px solid #ddd !important
            }

            .btn,
            .editable-field::after,
            .tooltip,
            .tab-buttons,
            .history-actions,
            .solar-animation,
            .time-bar {
                display: none !important
            }

            * {
                color: #000 !important
            }

            .status-display.completed {
                background-color: #f0fff4 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact
            }

            .status-display.pending {
                background-color: #fffaf0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact
            }

            .status-display.in-progress {
                background-color: #ebf8ff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact
            }

            .metric-card {
                page-break-inside: avoid !important;
                border: 1px solid #ddd !important
            }

            .metric-card::before {
                background: var(--print-secondary) !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact
            }

            .card-header {
                background: var(--print-primary) !important;
                color: #fff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact
            }
        }

        .solar-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.1;
            overflow: hidden
        }

        .sun {
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #f6ad55, #dd6b20);
            border-radius: 50%;
            filter: blur(10px);
            animation: sunGlow 8s infinite alternate
        }

        .panel {
            position: absolute;
            width: 80px;
            height: 40px;
            background-color: rgba(66, 153, 225, 0.7);
            clip-path: polygon(0% 0%, 100% 0%, 90% 100%, 10% 100%);
            animation: float 4s ease-in-out infinite
        }

        @keyframes sunGlow {
            0% {
                opacity: 0.3
            }

            100% {
                opacity: 0.5
            }
        }

        @keyframes float {
            0% {
                transform: translateY(0px)
            }

            50% {
                transform: translateY(-10px)
            }

            100% {
                transform: translateY(0px)
            }
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: #718096;
            position: relative;
            transition: all 0.3s
        }

        .tab-btn.active {
            color: var(--accent-color);
            font-weight: 600
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--accent-color)
        }

        .tab-content {
            display: none;
            padding: 20px 0
        }

        .tab-content.active {
            display: block
        }

        .gauge-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px
        }

        .gauge-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color)
        }

        .gauge-title {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 16px
        }

        .gauge-chart {
            height: 200px
        }

        .data-highlight {
            background-color: rgba(66, 153, 225, 0.08);
            border-left: 4px solid var(--accent-color);
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 6px
        }

        .data-highlight h4 {
            margin-bottom: 12px;
            color: var(--dark-color);
            font-size: 16px
        }

        .data-highlight p {
            margin-bottom: 8px;
            font-size: 14px
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: var(--dark-color);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1
        }

        .equal-width-tables {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px
        }

        .equal-width-tables>div {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color)
        }

        @media (max-width:1200px) {
            .metric-grid {
                grid-template-columns: repeat(2, 1fr)
            }

            .equal-width-tables {
                grid-template-columns: 1fr
            }
        }

        @media (max-width:768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start
            }

            .header-right {
                width: 100%;
                flex-wrap: wrap
            }

            .metric-grid {
                grid-template-columns: 1fr
            }

            .gauge-container {
                grid-template-columns: 1fr
            }

            .compact-table input {
                width: 40px !important
            }
        }

        .pdf-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: #fff;
            font-size: 24px;
            flex-direction: column
        }

        .pdf-loading-content {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 10px;
            max-width: 500px;
            text-align: center
        }

        .pdf-loading-spinner {
            font-size: 48px;
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
            color: var(--accent-color)
        }

        .pdf-loading-text {
            font-size: 20px;
            margin-bottom: 10px;
            font-weight: 500
        }

        .pdf-loading-subtext {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.8
        }

        .pdf-loading-progress-container {
            width: 100%;
            height: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden
        }

        .pdf-loading-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--accent-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s
        }

        .pdf-loading-details {
            text-align: left;
            margin-bottom: 20px;
            font-size: 14px
        }

        .pdf-loading-step {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px
        }

        .pdf-loading-step i {
            width: 20px;
            text-align: center
        }

        .pdf-loading-estimate {
            font-size: 14px;
            opacity: 0.8
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg)
            }

            100% {
                transform: rotate(360deg)
            }
        }

        .status-select-wrapper {
            position: relative;
            display: inline-block;
            min-width: 120px
        }

        .status-select-wrapper::after {
            content: '\f078';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #718096;
            font-size: 12px
        }

        .status-select {
            appearance: none;
            padding: 8px 30px 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: #fff;
            font-size: 14px;
            cursor: pointer;
            width: 100%
        }

        .edit-mode .status-select {
            display: inline-block !important
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0)
            }

            to {
                opacity: 0;
                transform: translateY(-20px)
            }
        }

        .alert {
            animation: fadeIn 0.3s
        }

        .alert.fade-out {
            animation: fadeOut 0.3s
        }

        .data-updated {
            animation: highlightUpdate 1.5s
        }

        @keyframes highlightUpdate {
            0% {
                background-color: rgba(56, 161, 105, 0.2)
            }

            100% {
                background-color: transparent
            }
        }

        .remark-cell {
            min-width: 200px
        }

        .editable-field {
            position: relative
        }

        .editable-field::after {
            content: '\f044';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-color);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px
        }

        .edit-mode .editable-field::after {
            opacity: 1
        }

        table td {
            position: relative;
            vertical-align: middle
        }

        input,
        select,
        textarea {
            visibility: hidden;
            height: 0;
            padding: 0;
            margin: 0
        }

        .edit-mode input,
        .edit-mode select,
        .edit-mode textarea {
            visibility: visible;
            height: auto;
            padding: 6px 8px;
            background-color: #fff
        }

        .edit-mode .display-value {
            display: none
        }

        .display-value {
            display: inline-block
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="tab-buttons">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="history">Report History</button>
        </div>
        <div class="tab-content active" id="dashboard-tab">
            <div class="container">
                <header>
                    <div class="solar-animation">
                        <div class="sun"></div>
                        <!-- Solar panels -->
                        <div class="panel" style="top: 30%; left: 30%; transform: rotate(15deg);"></div>
                        <div class="panel" style="top: 40%; left: 40%; transform: rotate(30deg);"></div>
                        <div class="panel" style="top: 30%; left: 50%; transform: rotate(45deg);"></div>
                        <div class="panel" style="top: 20%; left: 60%; transform: rotate(60deg);"></div>
                        <div class="panel" style="top: 10%; left: 70%; transform: rotate(75deg);"></div>
                    </div>
                    <div class="header-content">
                        <div class="header-left">
                            <h1>Operation and Maintenance</h1>
                            <p id="report-date"></p>
                        </div>
                        <div class="header-right">
                            <p class="report-date-container">
                            <h2>Report of Date:</h2>
                            <span class="editable-field">
                                <h2> <span class="display-value" id="report-of-date">01-Jan-2023</span>
                                    <input type="date" id="report-date-input" value="2023-01-01">
                                </h2>
                            </span>
                            </p>
                            <button class="btn btn-primary" id="exportPdf">
                                <i class="fas fa-file-pdf"></i> Export PDF
                            </button>
                            <button class="btn btn-secondary" id="toggleEdit">
                                <i class="fas fa-edit"></i> Edit Mode
                            </button>
                            <button class="btn btn-success" id="submitReport">
                                <i class="fas fa-paper-plane"></i> Submit Report
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Time Bar -->
                <div class="time-bar">
                    <div class="time-display">
                        <i class="fas fa-clock"></i><span id="current-time">Loading...</span>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="grid metric-grid">
                    <div class="metric-card">
                        <div class="metric-title">Plant Capacity (DC)</div>
                        <div class="metric-value editable-field">
                            <span class="display-value">387.68 MWdc</span>
                            <input type="text" value="387.68" data-unit="MWdc">
                        </div>
                        <div class="metric-change positive">
                            <i class="fas fa-arrow-up"></i> 1.27 DC/AC Ratio
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Plant Capacity (AC)</div>
                        <div class="metric-value editable-field">
                            <span class="display-value">306.18 MWac</span>
                            <input type="text" value="306.18" data-unit="MWac">
                        </div>
                        <div class="metric-change positive">
                            <i class="fas fa-check-circle"></i> 100% Availability
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Total Energy Export</div>
                        <div class="metric-value editable-field" id="export-energy">
                            <span class="display-value">3,055.32 MWh</span>
                            <input type="number" value="3055.32" step="0.01" data-unit="MWh">
                        </div>
                        <div class="metric-change positive" id="export-deviation">
                            <i class="fas fa-arrow-up"></i> +6.39% vs Expected
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-title">Performance Ratio</div>
                        <div class="metric-value editable-field" id="performance-ratio">
                            <span class="display-value">84.50%</span>
                            <input type="number" value="84.50" step="0.01" data-unit="%">
                        </div>
                        <div class="metric-change positive" id="performance-deviation">
                            <i class="fas fa-arrow-up"></i> +1.90% vs Target
                        </div>
                    </div>
                </div>

                <!-- Plant Summary -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-solar-panel"></i> Plant Operation & Technical Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="equal-width-tables">
                            <div>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Start Time</td>
                                            <td class="editable-field">
                                                <span class="display-value">05:45</span>
                                                <input type="time" id="start-time" value="05:45" class="time-input">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>End Time</td>
                                            <td class="editable-field">
                                                <span class="display-value">19:06</span>
                                                <input type="time" id="end-time" value="19:06" class="time-input">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Total Operational Hours</td>
                                            <td id="total-hours">13:21</td>
                                        </tr>
                                        <tr>
                                            <td>Location</td>
                                            <td class="editable-field">
                                                <span class="display-value">Industrial Area 3, Jeddah, KSA</span>
                                                <input type="text" value="Industrial Area 3, Jeddah, KSA">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Coordinates</td>
                                            <td class="editable-field">
                                                <span class="display-value">21°10'1.39" N, 39°25'38.48" E</span>
                                                <input type="text" value="21°10'1.39&quot; N, 39°25'38.48&quot; E">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Project Company</td>
                                            <td class="editable-field">
                                                <span class="display-value">Masdar-EDF-Nesma JV</span>
                                                <input type="text" value="Masdar-EDF-Nesma JV">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>O&M Operator</td>
                                            <td class="editable-field">
                                                <span class="display-value">L&T</span>
                                                <input type="text" value="L&T">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Module Technology</td>
                                            <td class="editable-field">
                                                <span class="display-value">Mono-Crystalline Bi-Facial LONGI
                                                    Solar</span>
                                                <input type="text" value="Mono-Crystalline Bi-Facial LONGI Solar">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Inverter Type</td>
                                            <td class="editable-field">
                                                <span class="display-value">String Inverter/180 kVA @ 50°C</span>
                                                <input type="text" value="String Inverter/180 kVA @ 50°C">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Plant Altitude</td>
                                            <td class="editable-field">
                                                <span class="display-value">50m</span>
                                                <input type="text" value="50" data-unit="m">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Performance Data -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tachometer-alt"></i> Plant Performance Summary</h3>
                    </div>
                    <div class="card-body">
                        <div class="data-highlight">
                            <h4>Key Performance Indicators</h4>
                            <p><strong>Energy Export:</strong> <span id="highlight-export">3,055.32 MWh</span></p>
                            <p><strong>Performance Ratio:</strong> <span id="highlight-pr">84.50%</span></p>
                            <p><strong>GHI:</strong> <span id="highlight-ghi">7.66 kWh/m²</span></p>
                        </div>

                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Description</th>
                                    <th>Expected</th>
                                    <th>Actual</th>
                                    <th>Units</th>
                                    <th>Deviation %</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Export Energy</td>
                                    <td class="editable-field">
                                        <span class="display-value">2,871.80</span>
                                        <input type="number" class="expected-input" value="2871.8" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">3,055.32</span>
                                        <input type="number" class="actual-input" value="3055.32" step="0.01">
                                    </td>
                                    <td>MWh</td>
                                    <td class="deviation" id="export-dev">6.39%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Import Energy</td>
                                    <td class="editable-field">
                                        <span class="display-value">11.53</span>
                                        <input type="number" class="expected-input" value="11.53" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">9.56</span>
                                        <input type="number" class="actual-input" value="9.56" step="0.01">
                                    </td>
                                    <td>MWh</td>
                                    <td class="deviation" id="import-dev">-17.10%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>GHI</td>
                                    <td class="editable-field">
                                        <span class="display-value">7.36</span>
                                        <input type="number" class="expected-input" value="7.36" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">7.66</span>
                                        <input type="number" class="actual-input" value="7.66" step="0.01">
                                    </td>
                                    <td>kWh/m²</td>
                                    <td class="deviation" id="ghi-dev">4.13%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>GTI/POA</td>
                                    <td class="editable-field">
                                        <span class="display-value">8.96</span>
                                        <input type="number" class="expected-input" value="8.96" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">9.15</span>
                                        <input type="number" class="actual-input" value="9.15" step="0.01">
                                    </td>
                                    <td>kWh/m²</td>
                                    <td class="deviation" id="gti-dev">2.15%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Plant Availability</td>
                                    <td class="editable-field">
                                        <span class="display-value">100.00</span>
                                        <input type="number" class="expected-input" value="100" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">100.00</span>
                                        <input type="number" class="actual-input" value="100.0" step="0.01">
                                    </td>
                                    <td>%</td>
                                    <td class="deviation" id="avail-dev">0.00%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Performance Ratio</td>
                                    <td class="editable-field">
                                        <span class="display-value">82.60</span>
                                        <input type="number" class="expected-input" value="82.60" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">84.50</span>
                                        <input type="number" class="actual-input" value="84.50" step="0.01">
                                    </td>
                                    <td>%</td>
                                    <td class="deviation" id="perf-dev">1.90%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Module Temperature</td>
                                    <td class="editable-field">
                                        <span class="display-value">54.80</span>
                                        <input type="number" class="expected-input" value="54.80" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">48.75</span>
                                        <input type="number" class="actual-input" value="48.75" step="0.01">
                                    </td>
                                    <td>°C</td>
                                    <td class="deviation" id="modtemp-dev">-11.05%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Ambient Temperature</td>
                                    <td class="editable-field">
                                        <span class="display-value">33.49</span>
                                        <input type="number" class="expected-input" value="33.49" step="0.01">
                                    </td>
                                    <td class="editable-field">
                                        <span class="display-value">37.03</span>
                                        <input type="number" class="actual-input" value="37.03" step="0.01">
                                    </td>
                                    <td>°C</td>
                                    <td class="deviation" id="ambtemp-dev">10.58%</td>
                                    <td class="editable-field remark-cell">
                                        <span class="display-value">-</span>
                                        <input type="text" class="remarks-input" placeholder="Enter remarks">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Weather & Environmental Data -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-cloud-sun"></i> Weather Station & Environmental Summary</h3>
                    </div>
                    <div class="card-body">

                        <div>
                            <h4>Weather Stations Data</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th>Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Max Peak Power</td>
                                        <td class="editable-field">
                                            <span class="display-value">301.09</span>
                                            <input type="number" value="301.09" step="0.01"> MWh
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Max Irradiance</td>
                                        <td class="editable-field">
                                            <span class="display-value">1,011.33</span>
                                            <input type="number" value="1011.33" step="0.01"> W/m²
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Max Wind Speed</td>
                                        <td class="editable-field">
                                            <span class="display-value">19.68</span>
                                            <input type="number" value="19.68" step="0.01"> m/s
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Max Module Temperature</td>
                                        <td class="editable-field">
                                            <span class="display-value">55.01</span>
                                            <input type="number" value="55.01" step="0.01"> °C
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Max Ambient Temperature</td>
                                        <td class="editable-field">
                                            <span class="display-value">41.40</span>
                                            <input type="number" value="41.40" step="0.01"> °C
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <h4>Soiling Losses</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Location</th>
                                        <th>Expected</th>
                                        <th>Actual</th>
                                        <th>Deviation</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-1_B-03</span>
                                            <input type="text" value="WMS-1_B-03">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.80</span>
                                            <input type="number" class="soiling-expected" value="0.8" step="0.01">%
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1.38</span>
                                            <input type="number" class="soiling-actual" value="1.38" step="0.01">%
                                        </td>
                                        <td class="soiling-deviation">0.58%</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-2_B-16</span>
                                            <input type="text" value="WMS-2_B-16">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.80</span>
                                            <input type="number" class="soiling-expected" value="0.8" step="0.01">%
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.00</span>
                                            <input type="number" class="soiling-actual" value="0" step="0.01">%
                                        </td>
                                        <td class="soiling-deviation">-</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-3_B-22</span>
                                            <input type="text" value="WMS-3_B-22">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.80</span>
                                            <input type="number" class="soiling-expected" value="0.8" step="0.01">%
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.79</span>
                                            <input type="number" class="soiling-actual" value="0.79" step="0.01">%
                                        </td>
                                        <td class="soiling-deviation">-0.01%</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-4_B-25</span>
                                            <input type="text" value="WMS-4_B-25">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.80</span>
                                            <input type="number" class="soiling-expected" value="0.8" step="0.01">%
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1.42</span>
                                            <input type="number" class="soiling-actual" value="1.42" step="0.01">%
                                        </td>
                                        <td class="soiling-deviation">0.62%</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-5_B-38</span>
                                            <input type="text" value="WMS-5_B-38">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.80</span>
                                            <input type="number" class="soiling-expected" value="0.8" step="0.01">%
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1.42</span>
                                            <input type="number" class="soiling-actual" value="1.42" step="0.01">%
                                        </td>
                                        <td class="soiling-deviation">0.62%</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-6_B-40</span>
                                            <input type="text" value="WMS-6_B-40">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0.80</span>
                                            <input type="number" class="soiling-expected" value="0.8" step="0.01">%
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1.42</span>
                                            <input type="number" class="soiling-actual" value="1.42" step="0.01">%
                                        </td>
                                        <td class="soiling-deviation">0.62%</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>

                <!-- Weather & Environmental Data -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-cloud-sun"></i> Daily Irradiance & GHI Summary</h3>
                    </div>
                    <div class="card-body">
                        <!-- Weather Data Input -->
                        <h4>GHI Data (W/m²)</h4>
                        <div class="compact-table-container">
                            <table class="compact-table" id="ghi-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>04:00</th>
                                        <th>05:00</th>
                                        <th>06:00</th>
                                        <th>07:00</th>
                                        <th>08:00</th>
                                        <th>09:00</th>
                                        <th>10:00</th>
                                        <th>11:00</th>
                                        <th>12:00</th>
                                        <th>13:00</th>
                                        <th>14:00</th>
                                        <th>15:00</th>
                                        <th>16:00</th>
                                        <th>17:00</th>
                                        <th>18:00</th>
                                        <th>19:00</th>
                                        <th>20:00</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>GHI</td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">200</span>
                                            <input type="number" value="200" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">600</span>
                                            <input type="number" value="600" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">800</span>
                                            <input type="number" value="800" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">800</span>
                                            <input type="number" value="800" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">600</span>
                                            <input type="number" value="600" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">100</span>
                                            <input type="number" value="100" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="1">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="compact-table-container">
                            <h4>POA Data (W/m²)</h4>
                            <table class="compact-table" id="poa-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>04:00</th>
                                        <th>05:00</th>
                                        <th>06:00</th>
                                        <th>07:00</th>
                                        <th>08:00</th>
                                        <th>09:00</th>
                                        <th>10:00</th>
                                        <th>11:00</th>
                                        <th>12:00</th>
                                        <th>13:00</th>
                                        <th>14:00</th>
                                        <th>15:00</th>
                                        <th>16:00</th>
                                        <th>17:00</th>
                                        <th>18:00</th>
                                        <th>19:00</th>
                                        <th>20:00</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>POA</td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">200</span>
                                            <input type="number" value="200" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">600</span>
                                            <input type="number" value="600" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">800</span>
                                            <input type="number" value="800" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">1000</span>
                                            <input type="number" value="1000" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">800</span>
                                            <input type="number" value="800" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">600</span>
                                            <input type="number" value="600" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">100</span>
                                            <input type="number" value="100" step="1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="1">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="compact-table-container">
                            <h4>Daily Energy Generation (MWh) Data</h4>
                            <table class="compact-table" id="hourly-energy-table">
                                <thead>
                                    <tr>
                                        <th>Hour</th>
                                        <th>04:00</th>
                                        <th>05:00</th>
                                        <th>06:00</th>
                                        <th>07:00</th>
                                        <th>08:00</th>
                                        <th>09:00</th>
                                        <th>10:00</th>
                                        <th>11:00</th>
                                        <th>12:00</th>
                                        <th>13:00</th>
                                        <th>14:00</th>
                                        <th>15:00</th>
                                        <th>16:00</th>
                                        <th>17:00</th>
                                        <th>18:00</th>
                                        <th>19:00</th>
                                        <th>20:00</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Energy</td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">5</span>
                                            <input type="number" value="5" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">50</span>
                                            <input type="number" value="50" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">120</span>
                                            <input type="number" value="120" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">200</span>
                                            <input type="number" value="200" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">250</span>
                                            <input type="number" value="250" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">280</span>
                                            <input type="number" value="280" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">300</span>
                                            <input type="number" value="300" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">290</span>
                                            <input type="number" value="290" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">280</span>
                                            <input type="number" value="280" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">260</span>
                                            <input type="number" value="260" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">220</span>
                                            <input type="number" value="220" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">160</span>
                                            <input type="number" value="160" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">80</span>
                                            <input type="number" value="80" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">20</span>
                                            <input type="number" value="20" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">0</span>
                                            <input type="number" value="0" step="0.1">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="compact-table-container">
                            <h4>Performance Ratio Data</h4>
                            <table class="compact-table" id="pr-trend-table">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Sat</th>
                                        <th>Sun</th>
                                        <th>Mon</th>
                                        <th>Tue</th>
                                        <th>Wed</th>
                                        <th>Thu</th>
                                        <th>Fri</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>PR %</td>
                                        <td class="editable-field">
                                            <span class="display-value">82.1</span>
                                            <input type="number" value="82.1" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">83.5</span>
                                            <input type="number" value="83.5" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">84.0</span>
                                            <input type="number" value="84.0" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">83.8</span>
                                            <input type="number" value="83.8" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">84.5</span>
                                            <input type="number" value="84.5" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">84.2</span>
                                            <input type="number" value="84.2" step="0.1">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">84.0</span>
                                            <input type="number" value="84.0" step="0.1">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Performance Visualization -->
                <div class="chart-card">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Performance Visualization</h3>
                        </div>
                        <div class="card-body">
                            <!-- Main Performance Chart -->
                            <div class="chart-card">
                                <div class="chart-container">
                                    <canvas id="performanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Gauge Charts -->
                        <div class="chart-card">
                            <div class="card-body">
                                <div class="gauge-container">
                                    <div class="gauge-card">
                                        <div class="gauge-title">Plant Availability</div>
                                        <div class="gauge-chart">
                                            <canvas id="availabilityGauge"></canvas>
                                        </div>
                                    </div>
                                    <div class="gauge-card">
                                        <div class="gauge-title">Performance Ratio</div>
                                        <div class="gauge-chart">
                                            <canvas id="prGauge"></canvas>
                                        </div>
                                    </div>
                                    <div class="gauge-card">
                                        <div class="gauge-title">Soiling Loss</div>
                                        <div class="gauge-chart">
                                            <canvas id="soilingGauge"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Energy Flow and Weather Charts -->
                        <div class="card-body">
                            <div class="chart-row">
                                <div class="chart-card">
                                    <div class="chart-card">
                                        <h4>Energy Flow</h4>
                                        <div class="mini-chart-container">
                                            <canvas id="energyFlowChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-card">
                                    <div class="chart-card">
                                        <h4>Performance Ratio Trend</h4>
                                        <div class="mini-chart-container" style="margin-top: 20px;">
                                            <canvas id="prTrendChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Daily Generation Overview</h3>
                    </div>
                    <div class="card-body">
                        <!-- Daily Energy and PR Trend Charts -->
                        <h4>Daily Energy Generation</h4>
                        <div class="chart-container">
                            <canvas id="dailyEnergyChart"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Equipment & Maintenance -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-cogs"></i> Power Transformer Performance & ACRS Operation Summary</h3>
                    </div>
                    <div class="card-body">

                        <div>
                            <!-- Equipment performance table remains unchanged -->
                            <h4>Major Equipment Performance</h4>
                            <table class="data-table" id="equipment-performance-table">
                                <thead>
                                    <tr>
                                        <th>Equipment</th>
                                        <th>Generation (MWh)</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>PTR – 1</td>
                                        <td class="editable-field">
                                            <span class="display-value">1,547.58</span>
                                            <input type="number" value="1547.58" step="0.01">
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>PTR – 2</td>
                                        <td class="editable-field">
                                            <span class="display-value">1,507.73</span>
                                            <input type="number" value="1507.73" step="0.01">
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class="chart-card">
                                <h4>Equipment Performance Comparison</h4>
                                <div class="mini-chart-container">
                                    <canvas id="equipmentChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4>ACRS Robots Operation</h4>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Total No. of Robots</td>
                                        <td class="editable-field">
                                            <span class="display-value">308</span>
                                            <input type="number" id="total-robots" value="308">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>No. of Robots Started</td>
                                        <td class="editable-field">
                                            <span class="display-value">299</span>
                                            <input type="number" id="started-robots" value="299">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>No. of Robots Not Started</td>
                                        <td id="not-started-robots">9</td>
                                    </tr>
                                    <tr>
                                        <td>Robots Working Percentage</td>
                                        <td id="robots-working-percent">97.1%</td>
                                    </tr>
                                    <tr>
                                        <td>Remarks</td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="chart-card">
                                <h4>Robot Operational Status</h4>
                                <div class="mini-chart-container">
                                    <canvas id="robotStatusChart"></canvas>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- Maintenance Activities -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-tools"></i> Plant Maintenance Activities</h3>
                    </div>
                    <div class="card-body">
                        <!-- Preventive Maintenance Section -->
                        <div style="margin-bottom: 30px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4>Preventive Maintenance</h4>
                                <button class="btn btn-success add-row-btn" id="add-preventive-row">
                                    <i class="fas fa-plus"></i> Add Activity
                                </button>
                            </div>
                            <table class="data-table" id="preventive-maintenance-table">
                                <thead>
                                    <tr>
                                        <th>Activity</th>
                                        <th>Location</th>
                                        <th>Status</th>
                                        <th>Frequency</th>
                                        <th>Remarks</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">Substation Inspection</span>
                                            <input type="text" value="Substation Inspection">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">Main Substation</span>
                                            <input type="text" value="Main Substation">
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value status-display completed">Completed</span>
                                                <select class="status-select" style="display: none;" disabled>
                                                    <option value="completed" selected>Completed</option>
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value">Monthly</span>
                                                <select class="frequency-select" style="display: none;">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly" selected>Monthly</option>
                                                    <option value="quarterly">Quarterly</option>
                                                    <option value="bi-annually">Bi-Annually</option>
                                                    <option value="annually">Annually</option>
                                                    <option value="two-yearly">Two-Yearly</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">Weather Station Cleaning</span>
                                            <input type="text" value="Weather Station Cleaning">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">WMS-1</span>
                                            <input type="text" value="WMS-1">
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value status-display completed">Completed</span>
                                                <select class="status-select" style="display: none;" disabled>
                                                    <option value="completed" selected>Completed</option>
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value">Monthly</span>
                                                <select class="frequency-select" style="display: none;">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly" selected>Monthly</option>
                                                    <option value="quarterly">Quarterly</option>
                                                    <option value="bi-annually">Bi-Annually</option>
                                                    <option value="annually">Annually</option>
                                                    <option value="two-yearly">Two-Yearly</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">Manual Backside Modules Cleaning</span>
                                            <input type="text" value="Manual Backside Modules Cleaning">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">B03_T15</span>
                                            <input type="text" value="B03_T15">
                                        </td>

                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value status-display completed">Completed</span>
                                                <select class="status-select" style="display: none;" disabled>
                                                    <option value="completed" selected>Completed</option>
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value">Monthly</span>
                                                <select class="frequency-select">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly" selected>Monthly</option>
                                                    <option value="quarterly">Quarterly</option>
                                                    <option value="bi-annually">Bi-Annually</option>
                                                    <option value="annually">Annually</option>
                                                    <option value="two-yearly">Two-Yearly</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">ACRS Cleaning</span>
                                            <input type="text" value="ACRS Cleaning">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">All robots</span>
                                            <input type="text" value="All robots">
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value status-display completed">Completed</span>
                                                <select class="status-select" style="display: none;" disabled>
                                                    <option value="completed" selected>Completed</option>
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value">Monthly</span>
                                                <select class="frequency-select" style="display: none;">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly">Weekly</option>
                                                    <option value="monthly" selected>Monthly</option>
                                                    <option value="quarterly">Quarterly</option>
                                                    <option value="bi-annually">Bi-Annually</option>
                                                    <option value="annually">Annually</option>
                                                    <option value="two-yearly">Two-Yearly</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Corrective Maintenance Section -->
                        <div style="margin-bottom: 30px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4>Corrective Maintenance</h4>
                                <button class="btn btn-success add-row-btn" id="add-corrective-row">
                                    <i class="fas fa-plus"></i> Add Issue
                                </button>
                            </div>
                            <table class="data-table" id="corrective-maintenance-table">
                                <thead>
                                    <tr>
                                        <th>Location</th>
                                        <th>Issue Description</th>
                                        <th>Action Taken</th>
                                        <th>Status</th>
                                        <th>Remarks</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">B03_T15_C28</span>
                                            <input type="text" value="B03_T15_C28">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">Faulty Dbox</span>
                                            <input type="text" value="Faulty Dbox">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">Dbox replaced</span>
                                            <input type="text" value="Dbox replaced">
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value status-display pending">Pending</span>
                                                <select class="status-select" style="display: none;" disabled>
                                                    <option value="pending" selected>Pending</option>
                                                    <option value="completed">Completed</option>
                                                    <option value="in-progress">In Progress</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">B05_T22_C15</span>
                                            <input type="text" value="B05_T22_C15">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">Inverter fault</span>
                                            <input type="text" value="Inverter fault">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">Reset performed</span>
                                            <input type="text" value="Reset performed">
                                        </td>
                                        <td>
                                            <div class="status-select-wrapper">
                                                <span class="display-value status-display completed">Completed</span>
                                                <select class="status-select" style="display: none;" disabled>
                                                    <option value="completed" selected>Completed</option>
                                                    <option value="pending">Pending</option>
                                                    <option value="in-progress">In Progress</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td class="editable-field remark-cell">
                                            <span class="display-value">-</span>
                                            <input type="text" class="remarks-input" placeholder="Enter remarks">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Charts Section -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="chart-card">
                                <h4>Maintenance Completion Status</h4>
                                <div class="mini-chart-container">
                                    <canvas id="maintenanceStatusChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-card">
                                <h4>Corrective Issues by Status</h4>
                                <div class="mini-chart-container">
                                    <canvas id="correctiveStatusChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Add this section before the Analysis & Recommendations card -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-plug"></i> Auxiliary Consumption</h3>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 15px;">
                            <button class="btn btn-success" id="addAuxRowBtn">
                                <i class="fas fa-plus"></i> Add New Row
                            </button>
                        </div>

                        <div class="table-container">
                            <table class="table" id="auxiliaryConsumptionTable">
                                <thead>
                                    <tr>
                                        <th>Description of Equipment</th>
                                        <th>OEM Name</th>
                                        <th>Old Serial Number</th>
                                        <th>New Serial Number</th>
                                        <th>Total Quantity</th>
                                        <th>Location</th>
                                        <th>Action</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Initial sample row -->
                                    <tr>
                                        <td class="editable-field">
                                            <span class="display-value">D-Box</span>
                                            <input type="text" value="D-Box">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">PVH</span>
                                            <input type="text" value="PVH">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">202111004852</span>
                                            <input type="text" value="202111004852">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">202111005672</span>
                                            <input type="text" value="202111005672">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">4</span>
                                            <input type="number" value="4">
                                        </td>
                                        <td class="editable-field">
                                            <span class="display-value">B22-C174-T17</span>
                                            <input type="number" value="B22-C174-T17">
                                        </td>
                                        <td>
                                            <button class="btn btn-danger remove-row-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Analysis & Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-robot"></i> Analysis & Recommendations</h3>
                    </div>
                    <div class="card-body">
                        <div id="ai-analysis">
                            <p><i class="fas fa-spinner fa-spin"></i> Analyzing plant performance data...</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="tab-content" id="history-tab">
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-history"></i> Report History</h3>
                </div>
                <div class="card-body">
                    <div id="report-history-list">
                        <!-- Reports will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Main application state
        const appState = {
            editMode: false,
            charts: {},
            weatherData: {
                ghi: [0, 0, 0, 0, 0, 200, 600, 800, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 800, 600, 300, 200, 50, 0, 0, 0],
                poa: [0, 0, 0, 0, 0, 200, 600, 800, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 800, 600, 300, 200, 50, 0, 0, 0]
            },

            performanceData: {
                dailyEnergy: [0, 0, 0, 0, 0, 5, 50, 120, 200, 250, 280, 300, 290, 280, 260, 220, 160, 80, 20, 0, 0, 0, 0, 0],
                prTrend: [82.1, 83.5, 84.0, 83.8, 84.5, 84.2, 84.0]
            }
        };

        // =============================================
        // UTILITY FUNCTIONS
        // =============================================

        /**
         * Format date as DD-MMM-YYYY
         * @param {Date|string} date - Date object or date string
         * @returns {string} Formatted date string
         */
        function formatReportDate(date) {
            if (typeof date === 'string') {
                date = new Date(date);
                if (isNaN(date.getTime())) return date; // Return original if invalid
            }

            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const day = date.getDate().toString().padStart(2, '0');
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }

        /**
         * Format value with appropriate unit
         * @param {number|string} value - The numeric value
         * @param {string} unit - The unit of measurement
         * @returns {string} Formatted value with unit
         */
        function formatValueWithUnit(value, unit) {
            if (unit === 'MWh' || unit === 'MWdc' || unit === 'MWac') {
                return parseFloat(value).toLocaleString('en-US', { maximumFractionDigits: 2 }) + ' ' + unit;
            }
            return value + ' ' + unit;
        }

        /**
         * Show alert message
         * @param {string} message - The message to display
         * @param {string} type - Type of alert ('success', 'error', 'warning', 'info')
         */
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.padding = '15px';
            alertDiv.style.borderRadius = '5px';
            alertDiv.style.zIndex = '10000';
            alertDiv.style.animation = 'fadeIn 0.3s';

            if (type === 'success') {
                alertDiv.style.backgroundColor = '#d4edda';
                alertDiv.style.color = '#155724';
                alertDiv.style.border = '1px solid #c3e6cb';
            } else {
                alertDiv.style.backgroundColor = '#f8d7da';
                alertDiv.style.color = '#721c24';
                alertDiv.style.border = '1px solid #f5c6cb';
            }

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.style.animation = 'fadeOut 0.3s';
                setTimeout(() => {
                    document.body.removeChild(alertDiv);
                }, 300);
            }, 3000);
        }

        /**
         * Debounce function to limit rapid calls
         * @param {Function} func - Function to debounce
         * @param {number} delay - Delay in milliseconds
         * @returns {Function} Debounced function
         */
        function debounce(func, delay) {
            let timeout;
            return function () {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        // =============================================
        // CALCULATION FUNCTIONS
        // =============================================

        /**
         * Calculate operational hours between start and end time
         */
        function calculateOperationalHours() {
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;

            if (startTime && endTime) {
                const [startHours, startMinutes] = startTime.split(':').map(Number);
                const [endHours, endMinutes] = endTime.split(':').map(Number);

                let totalMinutes = (endHours * 60 + endMinutes) - (startHours * 60 + startMinutes);
                if (totalMinutes < 0) totalMinutes += 24 * 60; // Handle overnight

                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;

                document.getElementById('total-hours').textContent =
                    `${hours}:${minutes.toString().padStart(2, '0')}`;
            }
        }

        /**
         * Calculate average soiling loss
         * @returns {number} Average soiling loss percentage
         */
        function calculateAverageSoiling() {
            const soilingValues = [];
            document.querySelectorAll('.soiling-actual').forEach(input => {
                const value = parseFloat(input.value);
                if (!isNaN(value)) soilingValues.push(value);
            });

            return soilingValues.length > 0 ?
                soilingValues.reduce((a, b) => a + b, 0) / soilingValues.length : 0;
        }

        /**
         * Calculate system losses
         * @returns {number} System losses in MWh
         */
        function calculateSystemLosses() {
            const exportActual = parseFloat(document.querySelector('input.actual-input').value) || 0;
            const expectedProduction = parseFloat(document.querySelector('input.expected-input').value) || 0;
            return Math.max(0, expectedProduction - exportActual);
        }

        /**
         * Get maintenance status counts
         * @returns {number[]} Array of [completed, pending, inProgress] counts
         */
        function getMaintenanceStatusCounts() {
            const counts = [0, 0, 0];
            document.querySelectorAll('#preventive-maintenance-table .status-select').forEach(select => {
                if (select.value === 'completed') counts[0]++;
                else if (select.value === 'pending') counts[1]++;
                else if (select.value === 'in-progress') counts[2]++;
            });
            return counts;
        }

        /**
         * Get corrective status counts
         * @returns {number[]} Array of [completed, pending, inProgress] counts
         */
        function getCorrectiveStatusCounts() {
            const counts = [0, 0, 0];
            document.querySelectorAll('#corrective-maintenance-table .status-select').forEach(select => {
                if (select.value === 'completed') counts[0]++;
                else if (select.value === 'pending') counts[1]++;
                else if (select.value === 'in-progress') counts[2]++;
            });
            return counts;
        }

        /**
         * Get equipment performance data
         * @returns {number[]} Array of equipment performance values
         */
        function getEquipmentPerformanceData() {
            return Array.from(document.querySelectorAll('#equipment-performance-table input'))
                .map(input => parseFloat(input.value) || 0);
        }

        // =============================================
        // CHART FUNCTIONS
        // =============================================

        /**
         * Update all charts with current data
         */
        // Update all charts when data changes
        function updateCharts() {
            // Performance Chart
            // In the updateCharts() function, update the performance chart data:
            if (appState.charts.performanceChart) {
                appState.charts.performanceChart.data.datasets[0].data = [
                    parseFloat(document.querySelector('input.expected-input').value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[1].value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[2].value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[3].value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[4].value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[5].value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[6].value) || 0,
                    parseFloat(document.querySelectorAll('input.expected-input')[7].value) || 0
                ];
                appState.charts.performanceChart.data.datasets[1].data = [
                    parseFloat(document.querySelector('input.actual-input').value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[1].value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[2].value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[3].value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[4].value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[5].value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[6].value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[7].value) || 0
                ];
                appState.charts.performanceChart.update();
            }
            // Energy Flow Chart
            if (appState.charts.energyFlowChart) {
                appState.charts.energyFlowChart.data.datasets[0].data = [
                    parseFloat(document.querySelector('input.actual-input').value) || 0,
                    parseFloat(document.querySelectorAll('input.actual-input')[1].value) || 0,
                    calculateSystemLosses()
                ];
                appState.charts.energyFlowChart.update();
            }

            // Weather data collection
            const ghiInputs = document.querySelectorAll('#ghi-table input');
            const poaInputs = document.querySelectorAll('#poa-table input');

            appState.weatherData.ghi = Array.from(ghiInputs).map(input => parseFloat(input.value) || 0);
            appState.weatherData.poa = Array.from(poaInputs).map(input => parseFloat(input.value) || 0);

            // Update weather chart if it exists
            if (appState.charts.weatherChart) {
                appState.charts.weatherChart.data.datasets[0].data = appState.weatherData.ghi;
                appState.charts.weatherChart.data.datasets[1].data = appState.weatherData.poa;
                appState.charts.weatherChart.update();
            }

            // Daily Energy Chart
            const energyInputs = document.querySelectorAll('#hourly-energy-table input');
            appState.performanceData.dailyEnergy = Array.from(energyInputs).map(input => parseFloat(input.value)) || 0;




            // PR Trend Chart
            const prInputs = document.querySelectorAll('#pr-trend-table input');
            appState.performanceData.prTrend = Array.from(prInputs).map(input => parseFloat(input.value)) || 0;

            if (appState.charts.dailyEnergyChart) {
                appState.charts.dailyEnergyChart.data.datasets[0].data = appState.performanceData.dailyEnergy;
                appState.charts.dailyEnergyChart.update();
            }

            if (appState.charts.prTrendChart) {
                appState.charts.prTrendChart.data.datasets[0].data = appState.performanceData.prTrend;
                appState.charts.prTrendChart.update();
            }


            // Availability Gauge
            if (appState.charts.availabilityGauge) {
                // Update availability based on Plant Capacity (AC) value
                const plantCapacityAC = parseFloat(document.querySelectorAll('.metric-card')[1].querySelector('input').value) || 0;
                const baseCapacity = 306.18; // MWac
                const availabilityPercent = Math.min(100, (plantCapacityAC / baseCapacity) * 100);

                appState.charts.availabilityGauge.data.datasets[0].data = [availabilityPercent, 100 - availabilityPercent];
                appState.charts.availabilityGauge.update();

                // Update the availability metric
                document.querySelectorAll('input.actual-input')[4].value = availabilityPercent.toFixed(2);
                if (!appState.editMode) {
                    document.querySelectorAll('input.actual-input')[4].dispatchEvent(new Event('change'));
                }
            }

            // PR Gauge
            if (appState.charts.prGauge) {
                const prValue = parseFloat(document.querySelectorAll('input.actual-input')[5].value) || 0;
                appState.charts.prGauge.data.datasets[0].data = [prValue, 100 - prValue];
                appState.charts.prGauge.update();
            }

            // Soiling Gauge
            if (appState.charts.soilingGauge) {
                const avgSoiling = calculateAverageSoiling();
                appState.charts.soilingGauge.data.datasets[0].data = [avgSoiling, 100 - avgSoiling];
                appState.charts.soilingGauge.update();
            }

            // Equipment Chart


            const equipmentData = getEquipmentPerformanceData();

            if (appState.charts.equipmentChart) {
                appState.charts.equipmentChart.data.datasets[0].data = equipmentData;
                appState.charts.equipmentChart.update();
            }


            // Helper function to get equipment performance data
            function getEquipmentPerformanceData() {
                const equipmentTable = document.querySelector('#equipment-performance-table tbody');
                const rows = equipmentTable.querySelectorAll('tr');
                const data = [];

                rows.forEach(row => {
                    const value = parseFloat(row.querySelector('input').value) || 0;
                    data.push(value);
                });

                return data;
            }


            // Robot Status Chart
            if (appState.charts.robotStatusChart) {
                const totalRobots = parseInt(document.getElementById('total-robots').value) || 0;
                const startedRobots = parseInt(document.getElementById('started-robots').value) || 0;
                appState.charts.robotStatusChart.data.datasets[0].data = [startedRobots, totalRobots - startedRobots];
                appState.charts.robotStatusChart.update();
            }

            // Update maintenance status charts
            updateMaintenanceCharts();
        }

        // Update maintenance status charts
        function updateMaintenanceCharts() {
            // Maintenance Status Chart
            if (appState.charts.maintenanceStatusChart) {
                appState.charts.maintenanceStatusChart.data.datasets[0].data = getMaintenanceStatusCounts();
                appState.charts.maintenanceStatusChart.update();
            }

            // Corrective Status Chart
            if (appState.charts.correctiveStatusChart) {
                appState.charts.correctiveStatusChart.data.datasets[0].data = getCorrectiveStatusCounts();
                appState.charts.correctiveStatusChart.update();
            }
        }
        // Replace debounced calculations with immediate updates for critical charts
        function setupRealTimeUpdates() {
            // Weather data inputs
            document.querySelectorAll('#ghi-table input, #ambient-temp-table input').forEach(input => {
                input.addEventListener('input', () => {
                    updateWeatherChartData();
                    calculateDeviations();
                });
            });

            // Performance data inputs
            document.querySelectorAll('#hourly-energy-table input, #pr-trend-table input').forEach(input => {
                input.addEventListener('input', () => {
                    updatePerformanceChartData();
                    calculateDeviations();
                });
            });

            // Other inputs can use debounced calculations
            document.querySelectorAll('input:not(#ghi-table input, #ambient-temp-table input, #hourly-energy-table input, #pr-trend-table input)').forEach(input => {
                input.addEventListener('input', debouncedCalculations);
            });
        }


        /**
         * Initialize all charts
         */
        // Initialize all charts
        function initCharts() {
            const isPDF = window.jsPDF !== undefined;
            const pixelRatio = isPDF ? 2 : 1; // Double DPI for PDF

            Chart.defaults.font.size = isPDF ? 12 : 10;
            Chart.defaults.color = '#333';
            // Performance Chart
            // Performance Chart - Updated version
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            appState.charts.performanceChart = new Chart(performanceCtx, {
                type: 'bar',
                data: {
                    labels: ['Export Energy', 'Import Energy', 'GHI', 'GTI/POA', 'Plant Availability', 'Performance Ratio', 'Module Temp', 'Ambient Temp'],
                    datasets: [
                        {
                            label: 'Expected',
                            data: [
                                parseFloat(document.querySelector('input.expected-input').value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[1].value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[2].value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[3].value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[4].value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[5].value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[6].value) || 0,
                                parseFloat(document.querySelectorAll('input.expected-input')[7].value) || 0
                            ],
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Actual',
                            data: [
                                parseFloat(document.querySelector('input.actual-input').value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[1].value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[2].value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[3].value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[4].value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[5].value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[6].value) || 0,
                                parseFloat(document.querySelectorAll('input.actual-input')[7].value) || 0
                            ],
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        // Different units for different parameters
                                        if (context.dataIndex <= 3) { // Energy and irradiance values
                                            label += context.parsed.y.toFixed(2) +
                                                (context.dataIndex <= 1 ? ' MWh' : ' kWh/m²');
                                        } else if (context.dataIndex === 4 || context.dataIndex === 5) { // Availability and PR
                                            label += context.parsed.y.toFixed(2) + '%';
                                        } else { // Temperature values
                                            label += context.parsed.y.toFixed(2) + '°C';
                                        }
                                    }
                                    return label;
                                },
                                afterLabel: function (context) {
                                    // Show deviation percentage for each parameter
                                    const dataset1 = context.chart.data.datasets[0].data[context.dataIndex];
                                    const dataset2 = context.chart.data.datasets[1].data[context.dataIndex];
                                    const deviation = dataset1 !== 0 ? ((dataset2 - dataset1) / dataset1 * 100) : 0;

                                    return `Deviation: ${deviation.toFixed(2)}%`;
                                }
                            }
                        },
                        datalabels: {
                            display: false
                        },
                        legend: {
                            position: 'top',
                            align: 'center'
                        }
                    }
                }
            });

            // Energy Flow Chart
            const energyFlowCtx = document.getElementById('energyFlowChart').getContext('2d');
            appState.charts.energyFlowChart = new Chart(energyFlowCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Export Energy', 'Import Energy', 'Energy Consumption'],
                    datasets: [{
                        data: [
                            parseFloat(document.querySelector('input.actual-input').value) || 0,
                            parseFloat(document.querySelectorAll('input.actual-input')[1].value) || 0,
                            calculateSystemLosses()
                        ],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(231, 76, 60, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(52, 152, 219, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value.toFixed(2)} MWh (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Daily Energy Chart - Modified to include GHI and POA data
            const dailyEnergyCtx = document.getElementById('dailyEnergyChart').getContext('2d');
            appState.charts.dailyEnergyChart = new Chart(dailyEnergyCtx, {
                type: 'bar',
                data: {
                    labels: ['04:00', '05:00', '06:00', '07:00', '08:00', '09:00', '10:00',
                        '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00',
                        '18:00', '19:00', '20:00'],
                    datasets: [
                        {
                            label: 'Energy Generation (MWh)',
                            data: appState.performanceData.dailyEnergy,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1,
                            type: 'bar',
                            yAxisID: 'y'
                        },
                        {
                            label: 'GHI (W/m²)',
                            data: appState.weatherData.ghi,
                            backgroundColor: 'rgba(241, 196, 15, 0.5)',
                            borderColor: 'rgba(241, 196, 15, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y1'
                        },
                        {
                            label: 'POA (W/m²)',
                            data: appState.weatherData.poa,
                            backgroundColor: 'rgba(46, 204, 113, 0.5)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1,
                            type: 'line',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Energy (MWh)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Irradiance (W/m²)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        if (context.datasetIndex === 0) { // Energy
                                            label += context.parsed.y.toFixed(2) + ' MWh';
                                        } else { // GHI/POA
                                            label += context.parsed.y.toFixed(2) + ' W/m²';
                                        }
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Add event listeners to GHI and POA inputs to update the chart
            document.querySelectorAll('#ghi-table input, #poa-table input').forEach(input => {
                input.addEventListener('input', debounce(() => {
                    // Update weather data
                    const ghiInputs = document.querySelectorAll('#ghi-table input');
                    appState.weatherData.ghi = Array.from(ghiInputs).map(input => parseFloat(input.value) || 0);

                    const poaInputs = document.querySelectorAll('#poa-table input');
                    appState.weatherData.poa = Array.from(poaInputs).map(input => parseFloat(input.value) || 0);

                    // Update chart
                    if (appState.charts.dailyEnergyChart) {
                        appState.charts.dailyEnergyChart.data.datasets[1].data = appState.weatherData.ghi;
                        appState.charts.dailyEnergyChart.data.datasets[2].data = appState.weatherData.poa;
                        appState.charts.dailyEnergyChart.update();
                    }
                }, 300));
            });

            // PR Trend Chart
            const prTrendCtx = document.getElementById('prTrendChart').getContext('2d');
            appState.charts.prTrendChart = new Chart(prTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Sat', 'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri'],
                    datasets: [{
                        label: 'Performance Ratio (%)',
                        data: appState.performanceData.prTrend,
                        borderColor: 'rgba(46, 204, 113, 1)',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 50,
                            max: 100
                        }
                    }
                }
            });

            // Availability Gauge
            const availabilityCtx = document.getElementById('availabilityGauge').getContext('2d');
            appState.charts.availabilityGauge = new Chart(availabilityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Available', 'Unavailable'],
                    datasets: [{
                        data: [100, 0],
                        backgroundColor: ['rgba(46, 204, 113, 0.7)', 'rgba(231, 76, 60, 0.7)'],
                        borderWidth: 0,
                        circumference: 270,
                        rotation: 225
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        },
                        datalabels: {
                            display: false
                        }
                    }
                },
                plugins: [{
                    id: 'gaugeText',
                    afterDraw(chart) {
                        const { ctx, chartArea: { width, height } } = chart;
                        ctx.restore();
                        const text = 'Plant Capacity';
                        const text2 = 'AC Availability';
                        ctx.font = 'bold 20px sans-serif';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = '#27ae60';
                        const textX = Math.round((width - ctx.measureText(text).width) / 2);
                        const textY = height / 2 - 10;
                        ctx.fillText(text, textX, textY);

                        ctx.font = '12px sans-serif';
                        ctx.fillStyle = '#7f8c8d';
                        const text2X = Math.round((width - ctx.measureText(text2).width) / 2);
                        const text2Y = height / 2 + 15;
                        ctx.fillText(text2, text2X, text2Y);
                        ctx.save();
                    }
                }]
            });

            // PR Gauge
            const prCtx = document.getElementById('prGauge').getContext('2d');

            appState.charts.prGauge = new Chart(prCtx, {
                type: 'doughnut',
                data: {
                    labels: ['PR', 'Remaining'],
                    datasets: [{
                        data: [84.5, 15.5],
                        backgroundColor: ['rgba(46, 204, 113, 0.7)', 'rgba(189, 195, 199, 0.3)'],
                        borderWidth: 0,
                        circumference: 270,
                        rotation: 225
                    }]
                },

                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        },
                        datalabels: {
                            display: false
                        }
                    }
                },
                plugins: [{
                    id: 'gaugeText',
                    afterDraw(chart) {
                        const { ctx, chartArea: { width, height } } = chart;
                        ctx.restore();
                        const text = 'Plant PR';
                        const text2 = 'Actual';
                        ctx.font = 'bold 20px sans-serif';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = '#27ae60';
                        const textX = Math.round((width - ctx.measureText(text).width) / 2);
                        const textY = height / 2 - 10;
                        ctx.fillText(text, textX, textY);

                        ctx.font = '12px sans-serif';
                        ctx.fillStyle = '#7f8c8d';
                        const text2X = Math.round((width - ctx.measureText(text2).width) / 2);
                        const text2Y = height / 2 + 15;
                        ctx.fillText(text2, text2X, text2Y);
                        ctx.save();
                    }
                }]
            });

            // Soiling Gauge
            const soilingCtx = document.getElementById('soilingGauge').getContext('2d');
            appState.charts.soilingGauge = new Chart(soilingCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Soiling', 'Remaining'],
                    datasets: [{
                        data: [calculateAverageSoiling(), 100 - calculateAverageSoiling()],
                        backgroundColor: ['rgba(231, 76, 60, 0.7)', 'rgba(189, 195, 199, 0.3)'],
                        borderWidth: 0,
                        circumference: 270,
                        rotation: 225
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        },
                        datalabels: {
                            display: false
                        }
                    }
                },
                plugins: [{
                    id: 'gaugeText',
                    afterDraw(chart) {
                        const { ctx, chartArea: { width, height } } = chart;
                        ctx.restore();
                        const text = calculateAverageSoiling().toFixed(2) + '%';
                        const text2 = 'Soiling Loss';
                        ctx.font = 'bold 20px sans-serif';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = '#e74c3c';
                        const textX = Math.round((width - ctx.measureText(text).width) / 2);
                        const textY = height / 2 - 10;
                        ctx.fillText(text, textX, textY);

                        ctx.font = '12px sans-serif';
                        ctx.fillStyle = '#7f8c8d';
                        const text2X = Math.round((width - ctx.measureText(text2).width) / 2);
                        const text2Y = height / 2 + 15;
                        ctx.fillText(text2, text2X, text2Y);
                        ctx.save();
                    }
                }]
            });
            // Equipment Chart
            const equipmentCtx = document.getElementById('equipmentChart').getContext('2d');
            appState.charts.equipmentChart = new Chart(equipmentCtx, {
                type: 'bar',
                data: {
                    labels: ['PTR-1', 'PTR-2'],
                    datasets: [{
                        label: 'Energy Generation (MWh)',
                        data: getEquipmentPerformanceData(),
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ],
                        borderColor: [
                            'rgba(52, 152, 219, 1)',
                            'rgba(155, 89, 182, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Energy (MWh)'
                            }
                        }
                    }
                }
            });
            function getEquipmentPerformanceData() {
                const equipmentTable = document.querySelector('#equipment-performance-table tbody');
                const rows = equipmentTable.querySelectorAll('tr');
                const data = [];

                rows.forEach(row => {
                    const value = parseFloat(row.querySelector('input').value) || 0;
                    data.push(value);
                });

                return data;
            }
            // Add event listeners to equipment performance inputs
            document.querySelectorAll('#equipment-performance-table input').forEach(input => {
                input.addEventListener('input', () => {
                    if (appState.charts.equipmentChart) {
                        appState.charts.equipmentChart.data.datasets[0].data = getEquipmentPerformanceData();
                        appState.charts.equipmentChart.update();
                    }
                });
            });



            // Robot Status Chart
            const robotStatusCtx = document.getElementById('robotStatusChart').getContext('2d');
            const totalRobots = parseInt(document.getElementById('total-robots').value) || 0;
            const startedRobots = parseInt(document.getElementById('started-robots').value) || 0;
            const notStartedRobots = Math.max(0, totalRobots - startedRobots);

            appState.charts.robotStatusChart = new Chart(robotStatusCtx, {
                type: 'pie',
                data: {
                    labels: ['Operational', 'Not Operational'],
                    datasets: [{
                        data: [startedRobots, notStartedRobots],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(231, 76, 60, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Maintenance Status Chart
            const maintenanceStatusCtx = document.getElementById('maintenanceStatusChart').getContext('2d');
            appState.charts.maintenanceStatusChart = new Chart(maintenanceStatusCtx, {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Pending', 'In Progress'],
                    datasets: [{
                        data: getMaintenanceStatusCounts(),
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(241, 196, 15, 0.7)',
                            'rgba(52, 152, 219, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(241, 196, 15, 1)',
                            'rgba(52, 152, 219, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });

            // Corrective Status Chart
            const correctiveStatusCtx = document.getElementById('correctiveStatusChart').getContext('2d');
            appState.charts.correctiveStatusChart = new Chart(correctiveStatusCtx, {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Pending', 'In Progress'],
                    datasets: [{
                        data: getCorrectiveStatusCounts(),
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(241, 196, 15, 0.7)',
                            'rgba(52, 152, 219, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(241, 196, 15, 1)',
                            'rgba(52, 152, 219, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }


        // =============================================
        // REPORT MANAGEMENT FUNCTIONS
        // =============================================

        /**
         * Save report to localStorage
         * @param {string} date - Report date
         * @param {object} data - Report data
         * @param {boolean} published - Whether report is published
         */
        function saveReport(date, data, published = false) {
            try {
                const reports = JSON.parse(localStorage.getItem('solarReports')) || {};
                reports[date] = {
                    data: data,
                    published: published,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('solarReports', JSON.stringify(reports));
            } catch (error) {
                console.error('Failed to save report:', error);
                showAlert('Failed to save report. Please try again.', 'error');
            }
        }

        /**
         * Load report from localStorage
         * @param {string} date - Report date
         * @returns {object|null} Report data or null if not found
         */
        function loadReport(date) {
            try {
                const reports = JSON.parse(localStorage.getItem('solarReports')) || {};
                return reports[date] || null;
            } catch (error) {
                console.error('Failed to load report:', error);
                return null;
            }
        }

        /**
         * Collect all report data from the form
         * @returns {object} Report data object
         */
        function collectReportData() {
            const reportData = {
                date: document.getElementById('report-of-date').textContent,
                metrics: {},
                performance: {},
                weather: {},
                maintenance: {
                    preventive: [],
                    corrective: []
                },
                equipment: {},
                charts: {
                    performanceData: appState.performanceData,
                    weatherData: appState.weatherData
                },
                tables: {}
            };

            // Collect metrics
            document.querySelectorAll('.metric-card').forEach(card => {
                const title = card.querySelector('.metric-title').textContent.trim();
                const value = card.querySelector('.metric-value .display-value').textContent.trim();
                const input = card.querySelector('.metric-value input');
                reportData.metrics[title] = {
                    display: value,
                    value: input ? input.value : null,
                    unit: input ? input.getAttribute('data-unit') : null
                };
            });

            // Collect all table data
            document.querySelectorAll('table').forEach(table => {
                const tableId = table.id || table.closest('.card')?.querySelector('.card-header h3')?.textContent.trim() || 'table_' + Date.now();
                reportData.tables[tableId] = {
                    headers: [],
                    rows: []
                };

                // Get headers
                const headers = table.querySelectorAll('th');
                headers.forEach(header => {
                    reportData.tables[tableId].headers.push(header.textContent.trim());
                });

                // Get rows with all data
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const rowData = {};
                    const cells = row.querySelectorAll('td');

                    cells.forEach((cell, index) => {
                        const header = reportData.tables[tableId].headers[index];
                        if (header) {
                            const displayValue = cell.querySelector('.display-value');
                            const input = cell.querySelector('input');
                            const select = cell.querySelector('select');

                            rowData[header] = {
                                display: displayValue ? displayValue.textContent.trim() : cell.textContent.trim(),
                                value: input ? input.value : null,
                                selected: select ? select.value : null
                            };
                        }
                    });

                    reportData.tables[tableId].rows.push(rowData);
                });
            });

            // Collect maintenance data
            document.querySelectorAll('#preventive-maintenance-table tbody tr').forEach(row => {
                reportData.maintenance.preventive.push({
                    activity: getCellData(row, 1),
                    location: getCellData(row, 2),
                    status: getSelectValue(row, 3),
                    frequency: getSelectValue(row, 4),
                    remarks: getCellData(row, 5)
                });
            });

            document.querySelectorAll('#corrective-maintenance-table tbody tr').forEach(row => {
                reportData.maintenance.corrective.push({
                    location: getCellData(row, 1),
                    issue: getCellData(row, 2),
                    action: getCellData(row, 3),
                    status: getSelectValue(row, 4),
                    remarks: getCellData(row, 5)
                });
            });

            return reportData;
        }

        /**
         * Helper function to get cell data
         * @param {HTMLElement} row - Table row element
         * @param {number} cellIndex - Cell index (1-based)
         * @returns {object} Cell data object
         */
        function getCellData(row, cellIndex) {
            const cell = row.querySelector(`td:nth-child(${cellIndex})`);
            if (!cell) return null;

            const display = cell.querySelector('.display-value');
            const input = cell.querySelector('input');

            return {
                display: display ? display.textContent.trim() : cell.textContent.trim(),
                value: input ? input.value : null
            };
        }

        /**
         * Helper function to get select value
         * @param {HTMLElement} row - Table row element
         * @param {number} cellIndex - Cell index (1-based)
         * @returns {object} Select value object
         */
        function getSelectValue(row, cellIndex) {
            const cell = row.querySelector(`td:nth-child(${cellIndex})`);
            if (!cell) return null;

            const select = cell.querySelector('select');
            const display = cell.querySelector('.display-value');

            return {
                display: display ? display.textContent.trim() : null,
                value: select ? select.value : null
            };
        }

        /**
         * Load report data into the view
         * @param {object} reportData - Report data to load
         */
        function loadReportIntoView(reportData) {
            if (!reportData) return;

            // Disable edit mode if active
            if (appState.editMode) {
                toggleEditMode();
            }

            // Update metrics
            if (reportData.metrics) {
                Object.keys(reportData.metrics).forEach(key => {
                    const card = [...document.querySelectorAll('.metric-card')].find(c =>
                        c.querySelector('.metric-title').textContent.trim() === key);
                    if (card) {
                        const display = card.querySelector('.display-value');
                        const input = card.querySelector('input');

                        if (display) {
                            display.textContent = reportData.metrics[key].display || '';
                        }

                        if (input && reportData.metrics[key].value !== null) {
                            input.value = reportData.metrics[key].value;
                            if (reportData.metrics[key].unit) {
                                input.setAttribute('data-unit', reportData.metrics[key].unit);
                            }
                        }
                    }
                });
            }

            // Update tables
            if (reportData.tables) {
                Object.keys(reportData.tables).forEach(tableKey => {
                    const table = document.getElementById(tableKey) ||
                        [...document.querySelectorAll('table')].find(t =>
                            t.closest('.card')?.querySelector('.card-header h3')?.textContent.trim() === tableKey);

                    if (table) {
                        const rows = table.querySelectorAll('tbody tr');
                        const tableData = reportData.tables[tableKey];

                        rows.forEach((row, rowIndex) => {
                            if (tableData.rows[rowIndex]) {
                                const cells = row.querySelectorAll('td');
                                Object.entries(tableData.rows[rowIndex]).forEach(([header, cellData], cellIndex) => {
                                    if (cells[cellIndex]) {
                                        const display = cells[cellIndex].querySelector('.display-value') || cells[cellIndex];
                                        const input = cells[cellIndex].querySelector('input');
                                        const select = cells[cellIndex].querySelector('select');

                                        // Update display value
                                        if (display && cellData.display !== undefined) {
                                            display.textContent = cellData.display;
                                        }

                                        // Update input value if exists
                                        if (input && cellData.value !== null) {
                                            input.value = cellData.value;
                                        }

                                        // Update select value if exists
                                        if (select && cellData.selected !== null) {
                                            select.value = cellData.selected;
                                        }
                                    }
                                });
                            }
                        });
                    }
                });
            }

            // Update maintenance tables
            if (reportData.maintenance) {
                // Preventive maintenance
                if (reportData.maintenance.preventive) {
                    const preventiveTable = document.querySelector('#preventive-maintenance-table tbody');
                    preventiveTable.innerHTML = '';

                    reportData.maintenance.preventive.forEach(item => {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                        <td class="editable-field">
                            <span class="display-value">${item.activity?.display || ''}</span>
                            <input type="text" value="${item.activity?.value || ''}">
                        </td>
                        <td class="editable-field">
                            <span class="display-value">${item.location?.display || ''}</span>
                            <input type="text" value="${item.location?.value || ''}">
                        </td>
                        <td>
                            <div class="status-select-wrapper">
                                <span class="display-value status-display ${item.status?.value || 'pending'}">
                                    ${item.status?.display || 'Pending'}
                                </span>
                                <select class="status-select" style="display: none;" disabled>
                                    <option value="completed" ${item.status?.value === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="pending" ${item.status?.value === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="in-progress" ${item.status?.value === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                </select>
                            </div>
                        </td>
                        <td>
                            <div class="status-select-wrapper">
                                <span class="display-value">${item.frequency?.display || 'Monthly'}</span>
                                <select class="frequency-select" style="display: none;" disabled>
                                    <option value="daily" ${item.frequency?.value === 'daily' ? 'selected' : ''}>Daily</option>
                                    <option value="weekly" ${item.frequency?.value === 'weekly' ? 'selected' : ''}>Weekly</option>
                                    <option value="monthly" ${item.frequency?.value === 'monthly' ? 'selected' : ''}>Monthly</option>
                                    <option value="quarterly" ${item.frequency?.value === 'quarterly' ? 'selected' : ''}>Quarterly</option>
                                    <option value="bi-annually" ${item.frequency?.value === 'bi-annually' ? 'selected' : ''}>Bi-Annually</option>
                                    <option value="annually" ${item.frequency?.value === 'annually' ? 'selected' : ''}>Annually</option>
                                    <option value="two-yearly" ${item.frequency?.value === 'two-yearly' ? 'selected' : ''}>Two-Yearly</option>
                                </select>
                            </div>
                        </td>
                        <td class="editable-field remark-cell">
                            <span class="display-value">${item.remarks?.display || ''}</span>
                            <input type="text" value="${item.remarks?.value || ''}">
                        </td>
                        <td>
                            <button class="btn btn-danger remove-row-btn">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                        preventiveTable.appendChild(newRow);
                    });
                }

                // Corrective maintenance
                if (reportData.maintenance.corrective) {
                    const correctiveTable = document.querySelector('#corrective-maintenance-table tbody');
                    correctiveTable.innerHTML = '';

                    reportData.maintenance.corrective.forEach(item => {
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                        <td class="editable-field">
                            <span class="display-value">${item.location?.display || ''}</span>
                            <input type="text" value="${item.location?.value || ''}">
                        </td>
                        <td class="editable-field">
                            <span class="display-value">${item.issue?.display || ''}</span>
                            <input type="text" value="${item.issue?.value || ''}">
                        </td>
                        <td class="editable-field">
                            <span class="display-value">${item.action?.display || ''}</span>
                            <input type="text" value="${item.action?.value || ''}">
                        </td>
                        <td>
                            <div class="status-select-wrapper">
                                <span class="display-value status-display ${item.status?.value || 'pending'}">
                                    ${item.status?.display || 'Pending'}
                                </span>
                                <select class="status-select" style="display: none;" disabled>
                                    <option value="completed" ${item.status?.value === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="pending" ${item.status?.value === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="in-progress" ${item.status?.value === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                </select>
                            </div>
                        </td>
                        <td class="editable-field remark-cell">
                            <span class="display-value">${item.remarks?.display || ''}</span>
                            <input type="text" value="${item.remarks?.value || ''}">
                        </td>
                        <td>
                            <button class="btn btn-danger remove-row-btn">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                        correctiveTable.appendChild(newRow);
                    });
                }

                // Reinitialize event listeners for new rows
                initializeMaintenanceTableEvents();
            }

            // Update charts data if available
            if (reportData.charts) {
                if (reportData.charts.performanceData) {
                    appState.performanceData = reportData.charts.performanceData;
                }
                if (reportData.charts.weatherData) {
                    appState.weatherData = reportData.charts.weatherData;
                }
            }

            // Update the report date display
            if (reportData.date) {
                document.getElementById('report-of-date').textContent = reportData.date;
                try {
                    document.getElementById('report-date-input').valueAsDate = new Date(reportData.date);
                } catch (e) {
                    console.error('Error parsing report date:', e);
                }
            }

            // Recalculate and update charts
            calculateDeviations();
            updateCharts();
            updateStatusDisplays();
        }
        /**
         * Render report history list
         */
        function renderReportHistory() {
            try {
                const reports = JSON.parse(localStorage.getItem('solarReports')) || {};
                const historyList = document.getElementById('report-history-list');
                historyList.innerHTML = '';

                if (Object.keys(reports).length === 0) {
                    historyList.innerHTML = '<div class="report-history-item" style="justify-content: center;">No reports found in history.</div>';
                    return;
                }

                // Sort reports by date (newest first)
                const sortedDates = Object.keys(reports).sort((a, b) =>
                    new Date(reports[b].timestamp) - new Date(reports[a].timestamp));

                sortedDates.forEach(date => {
                    const report = reports[date];
                    const formattedDate = formatReportDate(date);
                    const item = document.createElement('div');
                    item.className = 'report-history-item';

                    item.innerHTML = `
                    <div>
                        <strong>${formattedDate}</strong>
                        <span class="${report.published ? 'published-badge' : 'draft-badge'}">
                            ${report.published ? 'Published' : 'Draft'}
                        </span>
                        <small>Saved: ${new Date(report.timestamp).toLocaleString()}</small>
                    </div>
                    <div class="history-actions">
                        <button class="btn btn-primary view-report" data-date="${date}" title="View this report">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-secondary edit-report" data-date="${date}" title="Edit this report">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger delete-report" data-date="${date}" title="Delete this report">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;

                    historyList.appendChild(item);
                });

                // Add event listeners to all action buttons
                addHistoryButtonEventListeners();
            } catch (error) {
                console.error('Failed to render report history:', error);
                showAlert('Failed to load report history. Please try again.', 'error');
            }
        }

        /**
         * Add event listeners to history buttons
         */
        function addHistoryButtonEventListeners() {
            // View report
            document.querySelectorAll('.view-report').forEach(btn => {
                btn.addEventListener('click', function () {
                    const date = this.getAttribute('data-date');
                    const report = loadReport(date);
                    if (report) {
                        // Clear any existing edit mode
                        if (appState.editMode) {
                            toggleEditMode();
                        }

                        // Load the report data
                        loadReportIntoView(report.data);

                        // Update the date display
                        document.getElementById('report-date-input').valueAsDate = new Date(date);
                        document.getElementById('report-of-date').textContent = formatReportDate(date);

                        // Switch to dashboard tab and scroll to top
                        document.querySelector('.tab-btn[data-tab="dashboard"]').click();
                        window.scrollTo(0, 0);

                        // Show success message
                        showAlert(`Report for ${formatReportDate(date)} loaded successfully`, 'success');

                        // Disable edit mode explicitly
                        document.querySelectorAll('.editable-field input, .editable-field select').forEach(el => {
                            el.style.display = 'none';
                        });
                        document.querySelectorAll('.editable-field .display-value').forEach(el => {
                            el.style.display = 'inline-block';
                        });
                    }
                });
            });

            // Edit report
            document.querySelectorAll('.edit-report').forEach(btn => {
                btn.addEventListener('click', function () {
                    const date = this.getAttribute('data-date');
                    const report = loadReport(date);
                    if (report) {
                        // Load the report data
                        loadReportIntoView(report.data);

                        // Update the date display
                        document.getElementById('report-date-input').valueAsDate = new Date(date);
                        document.getElementById('report-of-date').textContent = formatReportDate(date);

                        // Switch to dashboard tab and enable edit mode
                        document.querySelector('.tab-btn[data-tab="dashboard"]').click();
                        if (!appState.editMode) {
                            toggleEditMode();
                        }

                        // Ensure all inputs are properly initialized
                        initializeEditModeFields();

                        // Scroll to top
                        window.scrollTo(0, 0);

                        // Show success message
                        showAlert(`Editing report for ${formatReportDate(date)}`, 'info');
                    }
                });
            });

            // Delete report
            document.querySelectorAll('.delete-report').forEach(btn => {
                btn.addEventListener('click', function () {
                    const date = this.getAttribute('data-date');
                    const formattedDate = formatReportDate(date);

                    if (confirm(`Are you sure you want to delete the report for ${formattedDate}? This action cannot be undone.`)) {
                        try {
                            const reports = JSON.parse(localStorage.getItem('solarReports')) || {};
                            delete reports[date];
                            localStorage.setItem('solarReports', JSON.stringify(reports));
                            renderReportHistory();
                            showAlert(`Report for ${formattedDate} deleted successfully`, 'success');
                        } catch (error) {
                            console.error('Failed to delete report:', error);
                            showAlert('Failed to delete report. Please try again.', 'error');
                        }
                    }
                });
            });
        }

        // =============================================
        // EDIT MODE FUNCTIONS
        // =============================================

        /**
         * Toggle edit mode on/off
         */
        function toggleEditMode() {
            appState.editMode = !appState.editMode;
            document.body.classList.toggle('edit-mode', appState.editMode);

            const toggleBtn = document.getElementById('toggleEdit');
            if (toggleBtn) {
                toggleBtn.innerHTML = appState.editMode
                    ? '<i class="fas fa-save"></i> Save Changes'
                    : '<i class="fas fa-edit"></i> Edit Mode';
            }

            // Toggle input visibility, including status selects
            document.querySelectorAll('.editable-field, .status-select-wrapper').forEach(field => {
                const displayValue = field.querySelector('.display-value');
                const input = field.querySelector('input:not(.status-select), textarea, select');

                if (appState.editMode) {
                    if (displayValue) displayValue.style.display = 'none';
                    if (input) input.style.display = 'inline-block';

                    // Special handling for status selects
                    const statusSelect = field.querySelector('.status-select');
                    if (statusSelect) {
                        statusSelect.style.display = 'inline-block';
                        statusSelect.disabled = false;
                    }

                    // Update input value from display value if needed
                    if (input && input.tagName === 'INPUT' && input.value === '' && displayValue && displayValue.textContent) {
                        input.value = displayValue.textContent.replace(/[^\d.-]/g, '');
                    }
                } else {
                    if (displayValue) displayValue.style.display = 'inline-block';
                    if (input) input.style.display = 'none';

                    // Special handling for status selects
                    const statusSelect = field.querySelector('.status-select');
                    if (statusSelect) {
                        statusSelect.style.display = 'none';
                        statusSelect.disabled = true;
                    }

                    // Update display value from input
                    if (input && input.value !== '' && displayValue) {
                        if (input.hasAttribute('data-unit')) {
                            displayValue.textContent = formatValueWithUnit(input.value, input.getAttribute('data-unit'));
                        } else {
                            displayValue.textContent = input.value;
                        }
                    }
                }
            });

            if (!appState.editMode) {
                // Recalculate all values when exiting edit mode
                calculateOperationalHours();
                calculateDeviations();
            }
        }

        /**
         * Initialize edit mode fields
         */
        function initializeEditModeFields() {
            // Initialize all editable fields
            document.querySelectorAll('.editable-field').forEach(field => {
                const displayValue = field.querySelector('.display-value');
                const input = field.querySelector('input, select, textarea');

                if (input) {
                    if (input.tagName === 'INPUT' && displayValue) {
                        // Extract numeric value from display text for inputs
                        const numericValue = displayValue.textContent.replace(/[^\d.-]/g, '');
                        if (numericValue !== '') {
                            input.value = numericValue;
                        }
                    }
                    input.style.display = 'inline-block';
                }

                if (displayValue) {
                    displayValue.style.display = 'none';
                }
            });

            // Initialize status selects
            document.querySelectorAll('.status-select-wrapper').forEach(wrapper => {
                const select = wrapper.querySelector('.status-select');
                const display = wrapper.querySelector('.status-display');

                if (select && display) {
                    select.style.display = 'inline-block';
                    select.disabled = false;

                    // Set the select value based on display text
                    if (display.textContent.includes('Completed')) {
                        select.value = 'completed';
                    } else if (display.textContent.includes('Pending')) {
                        select.value = 'pending';
                    } else if (display.textContent.includes('Progress')) {
                        select.value = 'in-progress';
                    }
                }
            });
        }

        /**
         * Update status displays based on select values
         */
        function updateStatusDisplays() {
            document.querySelectorAll('.status-select').forEach(select => {
                const wrapper = select.closest('.status-select-wrapper');
                if (wrapper) {
                    const display = wrapper.querySelector('.status-display');
                    if (display) {
                        let displayText = '';
                        if (select.value === 'completed') {
                            displayText = 'Completed';
                            display.className = 'display-value status-display completed';
                        } else if (select.value === 'pending') {
                            displayText = 'Pending';
                            display.className = 'display-value status-display pending';
                        } else if (select.value === 'in-progress') {
                            displayText = 'In Progress';
                            display.className = 'display-value status-display in-progress';
                        }
                        display.textContent = displayText;
                    }
                }
            });
        }

        /**
         * Initialize maintenance table events
         */
        function initializeMaintenanceTableEvents() {
            // Add event listeners to all remove buttons
            document.querySelectorAll('.remove-row-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const row = this.closest('tr');
                    row.parentNode.removeChild(row);
                    updateMaintenanceCharts();
                });
            });

            // Add event listeners to status selects
            document.querySelectorAll('.status-select').forEach(select => {
                select.addEventListener('change', function () {
                    updateStatusDisplays();
                    updateMaintenanceCharts();
                });
            });

            // Add event listeners to frequency selects
            document.querySelectorAll('.frequency-select').forEach(select => {
                select.addEventListener('change', updateFrequencyDisplays);
            });
        }

        /**
         * Update frequency displays based on select values
         */
        function updateFrequencyDisplays() {
            document.querySelectorAll('.frequency-select').forEach(select => {
                const wrapper = select.closest('.status-select-wrapper');
                if (wrapper) {
                    const display = wrapper.querySelector('.display-value:not(.status-display)');
                    if (display) {
                        // Capitalize first letter for display
                        const value = select.value;
                        const displayText = value.charAt(0).toUpperCase() + value.slice(1);
                        display.textContent = displayText;
                    }
                }
            });
        }

        // =============================================
        // DEVIATION CALCULATION & AI RECOMMENDATIONS
        // =============================================

        /**
         * Calculate all deviations and update displays
         */
        function calculateDeviations() {
            // Performance deviations
            document.querySelectorAll('.expected-input, .actual-input').forEach(input => {
                const row = input.closest('tr');
                if (row) {
                    const expected = parseFloat(row.querySelector('.expected-input').value) || 0;
                    const actual = parseFloat(row.querySelector('.actual-input').value) || 0;
                    let deviation = 0;

                    if (expected !== 0) {
                        deviation = ((actual - expected) / expected) * 100;
                    }

                    const deviationCell = row.querySelector('.deviation');
                    if (deviationCell) {
                        deviationCell.textContent = deviation.toFixed(2) + '%';

                        // Color coding
                        if (deviation > 0) {
                            deviationCell.className = 'deviation positive';
                        } else if (deviation < 0) {
                            deviationCell.className = 'deviation negative';
                        } else {
                            deviationCell.className = 'deviation';
                        }
                    }
                }
            });


            // Update Plant Capacity (AC) metric card with Plant Availability data
            const availActual = parseFloat(document.querySelectorAll('input.actual-input')[4].value) || 0;
            const availExpected = parseFloat(document.querySelectorAll('input.expected-input')[4].value) || 0;
            const availDeviation = availExpected !== 0 ? ((availActual - availExpected) / availExpected * 100) : 0;

            // Update the metric card
            const metricChangeDiv = document.querySelector('.metric-card:nth-child(2) .metric-change');
            if (metricChangeDiv) {
                metricChangeDiv.innerHTML = `<i class="fas fa-${availDeviation >= 0 ? 'check-circle' : 'exclamation-circle'}"></i> ${availActual.toFixed(2)}% Availability`;
                metricChangeDiv.className = `metric-change ${availDeviation >= 0 ? 'positive' : 'negative'}`;
            }

            // Update metric cards
            const exportActual = parseFloat(document.querySelector('input.actual-input').value) || 0;
            const exportExpected = parseFloat(document.querySelector('input.expected-input').value) || 0;
            const exportDeviation = exportExpected !== 0 ? ((exportActual - exportExpected) / exportExpected * 100) : 0;

            document.getElementById('export-energy').querySelector('.display-value').textContent =
                exportActual.toLocaleString('en-US', { maximumFractionDigits: 2 }) + ' MWh';
            document.getElementById('export-deviation').innerHTML = `<i class="fas fa-arrow-${exportDeviation >= 0 ? 'up' : 'down'}"></i> ${Math.abs(exportDeviation).toFixed(2)}% vs Expected`;
            document.getElementById('export-deviation').className = `metric-change ${exportDeviation >= 0 ? 'positive' : 'negative'}`;

            // Update highlights
            document.getElementById('highlight-export').textContent = exportActual.toLocaleString('en-US', { maximumFractionDigits: 2 }) + ' MWh';
            document.getElementById('highlight-pr').textContent = parseFloat(document.querySelectorAll('input.actual-input')[5].value || 0).toFixed(2) + '%';
            document.getElementById('highlight-ghi').textContent = parseFloat(document.querySelectorAll('input.actual-input')[2].value || 0).toFixed(2) + ' kWh/m²';

            const perfActual = parseFloat(document.querySelectorAll('input.actual-input')[5].value) || 0;
            const perfExpected = parseFloat(document.querySelectorAll('input.expected-input')[5].value) || 0;
            const perfDeviation = perfExpected !== 0 ? ((perfActual - perfExpected) / perfExpected * 100) : 0;

            document.getElementById('performance-ratio').querySelector('.display-value').textContent = perfActual.toFixed(2) + '%';
            document.getElementById('performance-deviation').innerHTML = `<i class="fas fa-arrow-${perfDeviation >= 0 ? 'up' : 'down'}"></i> ${Math.abs(perfDeviation).toFixed(2)}% vs Target`;
            document.getElementById('performance-deviation').className = `metric-change ${perfDeviation >= 0 ? 'positive' : 'negative'}`;

            // Robot calculations
            const totalRobots = parseInt(document.getElementById('total-robots').value) || 0;
            const startedRobots = parseInt(document.getElementById('started-robots').value) || 0;
            const notStartedRobots = Math.max(0, totalRobots - startedRobots);
            const workingPercentage = totalRobots > 0 ? (startedRobots / totalRobots * 100) : 0;

            document.getElementById('not-started-robots').textContent = notStartedRobots;
            document.getElementById('robots-working-percent').textContent = workingPercentage.toFixed(1) + '%';

            // Update robot status chart if it exists
            if (appState.charts.robotStatusChart) {
                appState.charts.robotStatusChart.data.datasets[0].data = [startedRobots, notStartedRobots];
                appState.charts.robotStatusChart.update();
            }

            // Soiling losses
            document.querySelectorAll('.soiling-expected, .soiling-actual').forEach(input => {
                const row = input.closest('tr');
                if (row) {
                    const expected = parseFloat(row.querySelector('.soiling-expected').value) || 0;
                    const actual = parseFloat(row.querySelector('.soiling-actual').value) || 0;
                    const deviation = actual - expected;

                    const deviationCell = row.querySelector('.soiling-deviation');
                    if (deviationCell) {
                        if (isNaN(deviation)) {
                            deviationCell.textContent = '-';
                        } else {
                            deviationCell.textContent = deviation.toFixed(2) + '%';

                            // Color coding
                            if (deviation > 0) {
                                deviationCell.className = 'soiling-deviation negative';
                            } else if (deviation < 0) {
                                deviationCell.className = 'soiling-deviation positive';
                            } else {
                                deviationCell.className = 'soiling-deviation';
                            }
                        }
                    }
                }
            });

            // Update charts with new data
            updateCharts();

            // Generate AI recommendations
            generateAIRecommendations();
        }

        /**
         * Generate AI recommendations based on current data
         */
        function generateAIRecommendations() {
            const analysisDiv = document.getElementById('ai-analysis');
            analysisDiv.innerHTML = '';

            // Get current values
            const exportActual = parseFloat(document.querySelector('input.actual-input').value) || 0;
            const exportExpected = parseFloat(document.querySelector('input.expected-input').value) || 0;
            const exportDeviation = exportExpected !== 0 ? ((exportActual - exportExpected) / exportExpected * 100) : 0;

            const perfActual = parseFloat(document.querySelectorAll('input.actual-input')[5].value) || 0;
            const perfExpected = parseFloat(document.querySelectorAll('input.expected-input')[5].value) || 0;
            const perfDeviation = perfExpected !== 0 ? ((perfActual - perfExpected) / perfExpected * 100) : 0;

            const modTempExpected = parseFloat(document.querySelectorAll('input.expected-input')[6].value) || 0;
            const modTempActual = parseFloat(document.querySelectorAll('input.actual-input')[6].value) || 0;

            const ambTempExpected = parseFloat(document.querySelectorAll('input.expected-input')[7].value) || 0;
            const ambTempActual = parseFloat(document.querySelectorAll('input.actual-input')[7].value) || 0;

            const totalRobots = parseInt(document.getElementById('total-robots').value) || 0;
            const startedRobots = parseInt(document.getElementById('started-robots').value) || 0;
            const robotWorkingPercent = totalRobots > 0 ? (startedRobots / totalRobots * 100) : 0;

            // Create recommendations
            const recommendations = [];

            // Performance recommendations
            if (exportDeviation > 5) {
                recommendations.push({
                    icon: 'fa-bolt',
                    color: 'success',
                    text: `Energy export exceeded expectations by ${exportDeviation.toFixed(2)}%. This excellent performance may be due to favorable weather conditions or improved system efficiency. Consider analyzing tracking patterns to replicate this success.`
                });
            } else if (exportDeviation < -5) {
                recommendations.push({
                    icon: 'fa-exclamation-triangle',
                    color: 'danger',
                    text: `Energy export is ${Math.abs(exportDeviation).toFixed(2)}% below expectations. Investigate potential issues with inverters, tracking systems, or module performance. Check for any maintenance activities that may have affected production.`
                });
            }

            if (perfDeviation > 2) {
                recommendations.push({
                    icon: 'fa-thumbs-up',
                    color: 'success',
                    text: `Performance ratio is ${perfDeviation.toFixed(2)}% above target, indicating efficient plant operation. Review recent maintenance activities to identify practices contributing to this improvement.`
                });
            } else if (perfDeviation < -2) {
                recommendations.push({
                    icon: 'fa-search',
                    color: 'warning',
                    text: `Performance ratio is ${Math.abs(perfDeviation).toFixed(2)}% below target. Conduct a detailed system inspection focusing on DC/AC conversion efficiency and potential losses.`
                });
            }

            // Temperature analysis
            if (modTempActual < modTempExpected && ambTempActual > ambTempExpected) {
                recommendations.push({
                    icon: 'fa-temperature-low',
                    color: 'info',
                    text: `Module temperatures are lower than expected (${modTempActual}°C vs expected ${modTempExpected}°C) despite higher ambient temperatures (${ambTempActual}°C vs expected ${ambTempExpected}°C). This suggests effective cooling or possible issues with temperature sensors. Verify sensor accuracy and tracker angles.`
                });
            }

            // Robot maintenance
            if (robotWorkingPercent < 95) {
                recommendations.push({
                    icon: 'fa-robot',
                    color: 'warning',
                    text: `Robot working percentage is ${robotWorkingPercent.toFixed(1)}%, below the optimal 95% target. Focus maintenance efforts on the ${totalRobots - startedRobots} non-operational robots, particularly checking power systems and communication links.`
                });
            }

            // Soiling losses
            const soilingDeviations = Array.from(document.querySelectorAll('.soiling-deviation'))
                .filter(el => el.textContent !== '-')
                .map(el => parseFloat(el.textContent));

            if (soilingDeviations.length > 0) {
                const avgSoilingDev = soilingDeviations.reduce((a, b) => a + b, 0) / soilingDeviations.length;
                if (avgSoilingDev > 0.2) {
                    recommendations.push({
                        icon: 'fa-wind',
                        color: 'warning',
                        text: `Average soiling loss deviation is ${avgSoilingDev.toFixed(2)}%, higher than expected. Consider increasing cleaning frequency or investigating environmental factors contributing to faster soiling.`
                    });
                }
            }

            // Default recommendation if no specific issues
            if (recommendations.length === 0) {
                recommendations.push({
                    icon: 'fa-check-circle',
                    color: 'success',
                    text: 'Plant is operating within expected parameters. Continue current maintenance schedule and monitor for any deviations.'
                });
            }

            // Display recommendations
            const list = document.createElement('ul');
            list.style.paddingLeft = '20px';

            recommendations.forEach(rec => {
                const item = document.createElement('li');
                item.style.marginBottom = '15px';
                item.style.listStyleType = 'none';
                item.style.position = 'relative';
                item.style.paddingLeft = '25px';

                const icon = document.createElement('i');
                icon.className = `fas ${rec.icon} text-${rec.color}`;
                icon.style.position = 'absolute';
                icon.style.left = '0';
                icon.style.top = '3px';

                const text = document.createElement('span');
                text.textContent = rec.text;

                item.appendChild(icon);
                item.appendChild(text);
                list.appendChild(item);
            });

            analysisDiv.appendChild(list);
        }

        // =============================================
        // TABLE MANAGEMENT FUNCTIONS
        // =============================================

        /**
         * Add row to preventive maintenance table
         */
        function addPreventiveRow() {
            const table = document.querySelector('#preventive-maintenance-table tbody');
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
            <td class="editable-field">
                <span class="display-value">New Activity</span>
                <input type="text" placeholder="Enter activity">
            </td>
            <td class="editable-field">
                <span class="display-value">Location</span>
                <input type="text" placeholder="Enter location">
            </td>
            <td>
                  <div class="status-select-wrapper">
                    <span class="display-value status-display pending">Pending</span>
                    <select class="status-select">
                        <option value="pending" selected>Pending</option>
                        <option value="completed">Completed</option>
                        <option value="in-progress">In Progress</option>
                    </select>
                </div>
                </div>
            </td>
            <td>
                <div class="status-select-wrapper">
                    <span class="display-value">Monthly</span>
                    <select class="frequency-select">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="bi-annually">Bi-Annually</option>
                        <option value="annually">Annually</option>
                        <option value="two-yearly">Two-Yearly</option>
                    </select>
                </div>
            </td>
            <td class="editable-field remark-cell">
                <span class="display-value">-</span>
                <input type="text" placeholder="Enter remarks">
            </td>
            <td>
                <button class="btn btn-danger remove-row-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;

            table.appendChild(newRow);

            // Add event listener to the new remove button
            newRow.querySelector('.remove-row-btn').addEventListener('click', function () {
                table.removeChild(newRow);
                updateMaintenanceCharts();
            });

            // Add event listener to the status select
            const statusSelect = newRow.querySelector('.status-select');
            statusSelect.addEventListener('change', function () {
                updateStatusDisplays();
                updateMaintenanceCharts();
            });

            // Add event listener to the frequency select
            const frequencySelect = newRow.querySelector('.frequency-select');
            frequencySelect.addEventListener('change', function () {
                updateFrequencyDisplays();
            });

            // Initialize the displays
            updateStatusDisplays();
            updateFrequencyDisplays();
            updateMaintenanceCharts();
        }
        /**
         * Add row to corrective maintenance table
         */
        function addCorrectiveRow() {
            const table = document.querySelector('#corrective-maintenance-table tbody');
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
            <td class="editable-field">
                <span class="display-value">New Location</span>
                <input type="text" placeholder="Enter location">
            </td>
            <td class="editable-field">
                <span class="display-value">Issue Description</span>
                <input type="text" placeholder="Enter issue">
            </td>
            <td class="editable-field">
                <span class="display-value">Action Taken</span>
                <input type="text" placeholder="Enter action">
            </td>
            <td>
                <div class="status-select-wrapper">
                    <span class="display-value status-display pending">Pending</span>
                    <select class="status-select">
                        <option value="pending" selected>Pending</option>
                        <option value="completed">Completed</option>
                        <option value="in-progress">In Progress</option>
                    </select>
                </div>
            </td>
            <td class="editable-field remark-cell">
                <span class="display-value">-</span>
                <input type="text" placeholder="Enter remarks">
            </td>
            <td>
                <button class="btn btn-danger remove-row-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;

            table.appendChild(newRow);

            // Add event listener to the new remove button
            newRow.querySelector('.remove-row-btn').addEventListener('click', function () {
                table.removeChild(newRow);
                updateMaintenanceCharts();
            });

            // Add event listener to the status select
            const statusSelect = newRow.querySelector('.status-select');
            statusSelect.addEventListener('change', function () {
                updateStatusDisplays();
                updateMaintenanceCharts();
            });

            // Initialize the status display
            updateStatusDisplays();
            updateMaintenanceCharts();
        }
        // Add event listeners to existing remove buttons
        document.querySelectorAll('.remove-row-btn').forEach(button => {
            button.addEventListener('click', function () {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
                updateMaintenanceCharts();
            });
        });

        // Add event listeners to status selects
        document.querySelectorAll('.status-select').forEach(select => {
            select.addEventListener('change', function () {
                updateMaintenanceCharts();
            });
        });

        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', function () {
                const tabId = this.getAttribute('data-tab');

                // Remove active class from all buttons and content
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Add active class to clicked button and corresponding content
                this.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        /**
         * Add row to auxiliary consumption table
         */
        function addAuxiliaryRow() {
            const tbody = document.querySelector('#auxiliaryConsumptionTable tbody');
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
            <td class="editable-field">
                <span class="display-value"></span>
                <input type="text" placeholder="Enter description">
            </td>
            <td class="editable-field">
                <span class="display-value"></span>
                <input type="text" placeholder="Enter OEM">
            </td>
            <td class="editable-field">
                <span class="display-value"></span>
                <input type="text" placeholder="Old serial">
            </td>
            <td class="editable-field">
                <span class="display-value"></span>
                <input type="text" placeholder="New serial">
            </td>
            <td class="editable-field">
                <span class="display-value"></span>
                <input type="number" placeholder="Quantity">
            </td>
            <td class="editable-field">
                <span class="display-value"></span>
                <input type="number" placeholder="Consumption">
            </td>
            <td>
                <button class="btn btn-danger remove-row-btn">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;

            tbody.appendChild(newRow);

            // Add event listener to the new remove button
            newRow.querySelector('.remove-row-btn').addEventListener('click', function () {
                tbody.removeChild(newRow);
            });

            // Initialize the row for edit mode if needed
            if (appState.editMode) {
                newRow.querySelectorAll('.editable-field input').forEach(input => {
                    input.style.display = 'inline-block';
                });
                newRow.querySelectorAll('.editable-field .display-value').forEach(span => {
                    span.style.display = 'none';
                });

            }
        }
        // Add event listeners to existing remove buttons in auxiliary table
        document.querySelectorAll('#auxiliaryConsumptionTable .remove-row-btn').forEach(button => {
            button.addEventListener('click', function () {
                const row = this.closest('tr');
                row.parentNode.removeChild(row);
            });
        });
        // =============================================
        // INITIALIZATION & EVENT LISTENERS
        // =============================================

        /**
         * Initialize all event listeners
         */
        function initializeEventListeners() {
            // Date input change
            const dateInput = document.getElementById('report-date-input');
            const dateDisplay = document.getElementById('report-of-date');
            if (dateInput && dateDisplay) {
                dateInput.addEventListener('change', function () {
                    const selectedDate = new Date(this.value);
                    dateDisplay.textContent = formatReportDate(selectedDate);
                });

                // Set initial date
                const today = new Date();
                dateInput.valueAsDate = today;
                dateDisplay.textContent = formatReportDate(today);
            }

            // Time calculation inputs
            document.getElementById('start-time')?.addEventListener('change', calculateOperationalHours);
            document.getElementById('end-time')?.addEventListener('change', calculateOperationalHours);

            // Robot inputs
            document.getElementById('total-robots')?.addEventListener('input', calculateDeviations);
            document.getElementById('started-robots')?.addEventListener('input', calculateDeviations);

            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const tabId = this.getAttribute('data-tab');

                    // Remove active class from all buttons and content
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });

                    // Add active class to clicked button and corresponding content
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });

            // Edit mode toggle
            document.getElementById('toggleEdit')?.addEventListener('click', toggleEditMode);

            // Submit report button
            document.getElementById('submitReport')?.addEventListener('click', function () {
                try {
                    const reportData = collectReportData();
                    const reportDate = document.getElementById('report-of-date').textContent;

                    if (!validateReport(reportData)) {
                        return;
                    }

                    saveReport(reportDate, reportData, true);
                    renderReportHistory();

                    // Show success message
                    showAlert('Report submitted and published successfully!', 'success');

                    // Disable edit mode if active
                    if (appState.editMode) {
                        toggleEditMode();
                    }
                } catch (error) {
                    console.error('Failed to submit report:', error);
                    showAlert('Failed to submit report. Please try again.', 'error');
                }
            });

            // PDF export button
            document.getElementById('exportPdf')?.addEventListener('click', exportToPDF);

            // Add row buttons
            document.getElementById('add-preventive-row')?.addEventListener('click', addPreventiveRow);
            document.getElementById('add-corrective-row')?.addEventListener('click', addCorrectiveRow);
            document.getElementById('addAuxRowBtn')?.addEventListener('click', addAuxiliaryRow);

            // Input validation
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('blur', function () {
                    if (isNaN(this.value)) {
                        this.value = 0;
                        showAlert('Please enter a valid number', 'error');
                    }
                });
            });

            // Debounced calculations for inputs
            const debouncedCalculations = debounce(() => {
                calculateOperationalHours();
                calculateDeviations();
            }, 300);

            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', debouncedCalculations);
                input.addEventListener('input', debouncedCalculations);
            });
        }

        /**
         * Validate report data before submission
         * @param {object} reportData - Report data to validate
         * @returns {boolean} True if valid, false otherwise
         */
        function validateReport(reportData) {
            // Check required metrics - update these to match your actual metric titles
            const requiredMetrics = ['Plant Capacity (DC)', 'Plant Capacity (AC)'];
            for (const metric of requiredMetrics) {
                if (!reportData.metrics[metric] || reportData.metrics[metric].display.trim() === '') {
                    showAlert(`Please fill in the ${metric} field`, 'error');
                    return false;
                }
            }
            return true;
        }

        /**
         * Export report to PDF
         */
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;

            // Premium loading overlay with detailed progress
            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'pdf-loading-overlay';
            loadingOverlay.innerHTML = `
            <div class="pdf-loading-content">
                <div class="pdf-loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>
                <div class="pdf-loading-text">Generating Premium Quality PDF Report</div>
                <div class="pdf-loading-subtext">Preparing print-ready document with 300 DPI resolution</div>
                <div class="pdf-loading-progress-container">
                    <div class="pdf-loading-progress-bar" style="width: 0%"></div>
                </div>
                <div class="pdf-loading-details">
                    <div class="pdf-loading-step"><i class="fas fa-check-circle"></i> Initializing PDF engine</div>
                    <div class="pdf-loading-step"><i class="far fa-circle"></i> Optimizing content layout</div>
                    <div class="pdf-loading-step"><i class="far fa-circle"></i> Rendering high-resolution charts</div>
                    <div class="pdf-loading-step"><i class="far fa-circle"></i> Applying professional styling</div>
                    <div class="pdf-loading-step"><i class="far fa-circle"></i> Finalizing document</div>
                </div>
                <div class="pdf-loading-estimate">Estimated time remaining: <span class="pdf-loading-time">about 30 seconds</span></div>
            </div>
        `;
            document.body.appendChild(loadingOverlay);

            try {
                // Create PDF with premium settings
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'pt',
                    format: 'a4',
                    compress: false,
                    putOnlyUsedFonts: true,
                    hotfixes: ["px_scaling"],
                    precision: 16
                });

                // Enhanced PDF metadata
                pdf.setProperties({
                    title: 'SJN Solar Plant - Comprehensive Daily Performance Report',
                    subject: 'Detailed analysis of daily solar energy production and system performance',
                    author: 'SJN Solar Plant Monitoring System',
                    keywords: 'solar energy, photovoltaic, performance report, daily metrics, renewable energy, SJN plant',
                    creator: 'SJN Solar Plant Automated Reporting System v2.0',
                    producer: 'Premium PDF Generator (jsPDF + html2canvas)'
                });

                // Store original styles for restoration
                const originalStyles = {};
                const elementsToOptimize = document.querySelectorAll('body, .container, .card, .chart-container, table, .metric-card, .data-table, .header-content');

                // Apply premium PDF styles
                elementsToOptimize.forEach(el => {
                    originalStyles[el] = {
                        boxShadow: el.style.boxShadow,
                        backgroundColor: el.style.backgroundColor,
                        border: el.style.border,
                        fontSize: el.style.fontSize,
                        margin: el.style.margin,
                        padding: el.style.padding,
                        fontFamily: el.style.fontFamily,
                        color: el.style.color,
                        lineHeight: el.style.lineHeight
                    };

                    el.style.boxShadow = 'none';
                    el.style.backgroundColor = '#ffffff';
                    el.style.border = '1px solid #e8e8e8';
                    el.style.fontSize = '12pt';
                    el.style.margin = '6px 0';
                    el.style.padding = '10px';
                    el.style.fontFamily = '"Segoe UI", Arial, sans-serif';
                    el.style.color = '#2d3748';
                    el.style.lineHeight = '1.5';
                });

                // Premium card header styling
                document.querySelectorAll('.card-header').forEach(header => {
                    originalStyles[header] = {
                        color: header.style.color,
                        backgroundColor: header.style.backgroundColor,
                        fontWeight: header.style.fontWeight,
                        fontSize: header.style.fontSize,
                        padding: header.style.padding
                    };
                    header.style.color = '#ffffff';
                    header.style.backgroundColor = '#1a365d';
                    header.style.fontWeight = '600';
                    header.style.fontSize = '14pt';
                    header.style.padding = '12px 15px';
                });

                // Chart optimization for print quality
                document.querySelectorAll('.chart-container').forEach(container => {
                    container.style.height = '650px';
                    container.style.width = '100%';
                    container.style.backgroundColor = '#ffffff';
                    container.style.borderRadius = '4px';
                });

                document.querySelectorAll('.mini-chart-container').forEach(container => {
                    container.style.height = '420px';
                    container.style.width = '100%';
                    container.style.backgroundColor = '#ffffff';
                    container.style.borderRadius = '4px';
                });

                // Table styling enhancements
                document.querySelectorAll('table').forEach(table => {
                    table.style.borderCollapse = 'collapse';
                    table.style.width = '100%';
                });

                document.querySelectorAll('th').forEach(th => {
                    th.style.backgroundColor = '#f7fafc';
                    th.style.color = '#2d3748';
                    th.style.fontWeight = '600';
                });

                document.querySelectorAll('td, th').forEach(cell => {
                    cell.style.border = '1px solid #e2e8f0';
                    cell.style.padding = '10px 12px';
                    cell.style.fontSize = '11pt';
                });

                // Hide non-essential elements
                document.querySelectorAll('.btn, .editable-field::after, .tooltip, .tab-buttons, .history-actions, .solar-animation, .refresh-btn, .export-options').forEach(el => {
                    el.style.display = 'none';
                });

                // PDF layout constants
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 45;
                const headerHeight = 60;
                const footerHeight = 45;
                const contentWidth = pageWidth - 2 * margin;
                const contentStartY = margin + headerHeight;
                const contentEndY = pageHeight - margin - footerHeight;
                const primaryColor = '#1a365d';
                const secondaryColor = '#2c5282';
                const accentColor = '#4299e1';

                let currentY = contentStartY;
                let totalElements = document.querySelectorAll('.header-content, .time-bar, .metric-grid, .card').length;
                let processedElements = 0;

                // Enhanced progress tracking
                const updateProgress = (progress, step) => {
                    const progressBar = document.querySelector('.pdf-loading-progress-bar');
                    const steps = document.querySelectorAll('.pdf-loading-step i');
                    const timeEstimate = document.querySelector('.pdf-loading-time');

                    if (progressBar) {
                        progressBar.style.width = `${Math.min(100, Math.round(progress * 100))}%`;
                    }

                    // Update step indicators
                    if (steps && step) {
                        const stepIndex = {
                            'Initializing': 0,
                            'Optimizing': 1,
                            'Rendering': 2,
                            'Applying': 3,
                            'Finalizing': 4
                        }[step.split(' ')[0]] || -1;

                        if (stepIndex >= 0) {
                            steps.forEach((icon, i) => {
                                if (i < stepIndex) {
                                    icon.className = 'fas fa-check-circle';
                                } else if (i === stepIndex) {
                                    icon.className = 'fas fa-spinner fa-spin';
                                } else {
                                    icon.className = 'far fa-circle';
                                }
                            });
                        }
                    }

                    // Update time estimate
                    if (timeEstimate) {
                        const remaining = Math.max(5, Math.round((1 - progress) * 30));
                        timeEstimate.textContent = `about ${remaining} seconds`;
                    }
                };

                // Prepare charts at high resolution
                updateProgress(0.1, 'Initializing high-resolution chart rendering...');
                await prepareChartsForPDF();

                // =============================================
                // PROFESSIONAL TITLE PAGE WITH CORPORATE DESIGN
                // =============================================
                updateProgress(0.15, 'Creating premium title page...');

                // Background design element
                pdf.setFillColor(240, 245, 249);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                // Decorative header stripe
                pdf.setFillColor(primaryColor);
                pdf.rect(0, 0, pageWidth, 80, 'F');

                // Professional project title - centered
                pdf.setTextColor(255, 255, 255);
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(16);

                // Use exact center positioning
                pdf.text(
                    'SOUTH JEDDAH NOOR 300MWAC PV SOLAR PLANT',
                    pageWidth / 2,
                    55,
                    { align: 'center' }
                );

                // Main title
                pdf.setFontSize(28);
                pdf.setTextColor(primaryColor);
                pdf.setFont('helvetica', 'bold');

                const titleText = 'DAILY PERFORMANCE REPORT';
                const titleY = 180;
                pdf.text(titleText, pageWidth / 2, titleY, { align: 'center' });

                // Report date
                const reportDate = document.getElementById('report-of-date').textContent;
                pdf.setFontSize(16);
                pdf.setTextColor(100, 100, 100);
                pdf.text(reportDate, pageWidth / 2, titleY + 40, { align: 'center' });

                // Decorative separator
                pdf.setDrawColor(accentColor);
                pdf.setLineWidth(2);
                pdf.line(pageWidth / 2 - 60, titleY + 70, pageWidth / 2 + 60, titleY + 70);

                // Version and document info
                pdf.setFontSize(10);
                pdf.setTextColor(120);
                pdf.text('Document Version: 2.1 | Report ID: ' + generateReportId(), pageWidth / 2, titleY + 100, { align: 'center' });

                // Footer note
                // Footer border

                pdf.setLineWidth(1);
                pdf.line(margin, pageHeight - 60, pageWidth - margin, pageHeight - 60);

                pdf.setFontSize(9);
                pdf.setTextColor(150);
                pdf.text('CONFIDENTIAL - For authorized personnel only', margin, pageHeight - 40);
                pdf.text('© ' + new Date().getFullYear() + ' SJN Solar Plant - All Rights Reserved', pageWidth - margin, pageHeight - 40, { align: 'right' });
                pdf.addPage();

                // =============================================
                // DOCUMENT CONTENT PAGES
                // =============================================
                const sections = [
                    '.header-content',
                    '.time-bar',
                    '.metric-grid',
                    '.card'
                ];

                for (const selector of sections) {
                    const elements = document.querySelectorAll(selector);

                    for (const element of elements) {
                        if (element.offsetHeight === 0) {
                            processedElements++;
                            updateProgress(processedElements / totalElements, `Skipping empty element: ${selector}`);
                            continue;
                        }

                        try {
                            updateProgress(processedElements / totalElements, `Processing ${selector}...`);

                            // Enhance element for PDF export
                            const originalElementStyles = {};
                            element.querySelectorAll('*').forEach(el => {
                                originalElementStyles[el] = {
                                    fontSize: window.getComputedStyle(el).fontSize,
                                    color: window.getComputedStyle(el).color,
                                    fontWeight: window.getComputedStyle(el).fontWeight,
                                    lineHeight: window.getComputedStyle(el).lineHeight
                                };

                                if (!el.closest('.card-header')) {
                                    const computedFontSize = parseInt(window.getComputedStyle(el).fontSize);
                                    el.style.fontSize = `${Math.max(11, computedFontSize)}px`;
                                    el.style.color = '#2d3748';
                                    el.style.lineHeight = '1.4';
                                }
                            });

                            // High-quality capture
                            const canvas = await html2canvas(element, {
                                scale: 2,
                                dpi: 300,
                                logging: false,
                                useCORS: true,
                                backgroundColor: '#ffffff',
                                letterRendering: true,
                                allowTaint: false,
                                removeContainer: true,
                                ignoreElements: (el) => {
                                    return el.classList.contains('btn') ||
                                        el.classList.contains('solar-animation') ||
                                        el.classList.contains('tab-buttons') ||
                                        el.classList.contains('no-export');
                                },
                                onclone: (clonedDoc) => {
                                    clonedDoc.querySelectorAll('.chart-container, .mini-chart-container').forEach(chart => {
                                        chart.style.backgroundColor = '#ffffff';
                                    });

                                    clonedDoc.querySelectorAll('*').forEach(el => {
                                        if (!el.closest('.card-header')) {
                                            const style = window.getComputedStyle(el);
                                            if (style.color && style.color !== 'rgba(0, 0, 0, 0)') {
                                                el.style.color = '#2d3748';
                                            }
                                        }
                                    });
                                }
                            });

                            // Restore original styles
                            Object.keys(originalElementStyles).forEach(el => {
                                if (el.style) {
                                    el.style.fontSize = originalElementStyles[el].fontSize;
                                    el.style.color = originalElementStyles[el].color;
                                    el.style.fontWeight = originalElementStyles[el].fontWeight;
                                    el.style.lineHeight = originalElementStyles[el].lineHeight;
                                }
                            });

                            // Add to PDF
                            const imgData = canvas.toDataURL('image/jpeg', 0.92);
                            const imgProps = pdf.getImageProperties(imgData);
                            const pdfWidth = contentWidth;
                            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                            // Page break logic
                            if (currentY + pdfHeight > contentEndY) {
                                pdf.addPage();
                                currentY = contentStartY;
                                addPremiumPageHeader(pdf, pageWidth, margin, reportDate, primaryColor, secondaryColor);
                            }

                            pdf.addImage(imgData, 'JPEG', margin, currentY, pdfWidth, pdfHeight, undefined, 'FAST');
                            currentY += pdfHeight + 25;

                            processedElements++;
                            updateProgress(processedElements / totalElements, `Completed ${selector}`);

                        } catch (error) {
                            console.error(`Error processing element ${selector}:`, error);
                            processedElements++;
                            updateProgress(processedElements / totalElements, `Error processing ${selector}`);
                            continue;
                        }
                    }
                }

                // Add professional headers/footers to all content pages
                updateProgress(0.95, 'Finalizing document formatting...');
                const totalPages = pdf.internal.getNumberOfPages();
                for (let i = 2; i <= totalPages; i++) {
                    pdf.setPage(i);
                    addPremiumPageHeader(pdf, pageWidth, margin, reportDate, primaryColor, secondaryColor);
                    addPremiumPageFooter(pdf, pageWidth, pageHeight, margin, i, totalPages);
                }

                // Final optimization
                updateProgress(0.98, 'Optimizing PDF file size...');
                if (typeof pdf.compress === 'function') {
                    pdf.compress(true);
                }

                // Save PDF
                const now = new Date();
                const timestamp = now.toISOString().slice(0, 10).replace(/-/g, '');
                pdf.save(`SJN_Report_${timestamp}.pdf`);

            } catch (error) {
                console.error('PDF generation error:', error);
                const errorOverlay = document.createElement('div');
                errorOverlay.className = 'pdf-error-overlay';
                errorOverlay.innerHTML = `
                <div class="pdf-error-content">
                    <div class="pdf-error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="pdf-error-title">PDF Generation Error</div>
                    <div class="pdf-error-message">${error.message || 'An unexpected error occurred'}</div>
                    <div class="pdf-error-suggestion">Please try again or contact technical support with the error details.</div>
                    <div class="pdf-error-code">Error code: PDF-${Date.now().toString().slice(-6)}</div>
                    <button class="pdf-error-close" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            `;
                document.body.appendChild(errorOverlay);
            } finally {
                // Restore all original styles
                Object.keys(originalStyles).forEach(el => {
                    if (el.style) {
                        el.style.boxShadow = originalStyles[el].boxShadow;
                        el.style.backgroundColor = originalStyles[el].backgroundColor;
                        el.style.border = originalStyles[el].border;
                        el.style.fontSize = originalStyles[el].fontSize;
                        el.style.margin = originalStyles[el].margin;
                        el.style.padding = originalStyles[el].padding;
                        el.style.fontFamily = originalStyles[el].fontFamily;
                        el.style.color = originalStyles[el].color;
                        el.style.lineHeight = originalStyles[el].lineHeight;
                    }
                });

                // Restore card headers
                document.querySelectorAll('.card-header').forEach(header => {
                    if (originalStyles[header]) {
                        header.style.color = originalStyles[header].color;
                        header.style.backgroundColor = originalStyles[header].backgroundColor;
                        header.style.fontWeight = originalStyles[header].fontWeight;
                        header.style.fontSize = originalStyles[header].fontSize;
                        header.style.padding = originalStyles[header].padding;
                    }
                });

                // Restore tables
                document.querySelectorAll('table').forEach(table => {
                    table.style.borderCollapse = '';
                    table.style.width = '';
                });

                document.querySelectorAll('th').forEach(th => {
                    th.style.backgroundColor = '';
                    th.style.color = '';
                    th.style.fontWeight = '';
                });

                document.querySelectorAll('td, th').forEach(cell => {
                    cell.style.border = '';
                    cell.style.padding = '';
                    cell.style.fontSize = '';
                });

                // Show hidden elements
                document.querySelectorAll('.btn, .editable-field::after, .tooltip, .tab-buttons, .history-actions, .refresh-btn, .export-options').forEach(el => {
                    el.style.display = '';
                });

                // Restore chart sizes
                restoreChartSizes();

                // Remove loading overlay
                if (document.body.contains(loadingOverlay)) {
                    document.body.removeChild(loadingOverlay);
                }
            }
        }

        /**
         * Prepare charts for PDF rendering
         */
        async function prepareChartsForPDF() {
            const charts = document.querySelectorAll('canvas');
            const promises = [];

            charts.forEach(chart => {
                const parent = chart.parentElement;
                const originalHeight = parent.style.height;
                const originalWidth = parent.style.width;

                // Set optimized fixed size for PDF rendering
                if (parent.classList.contains('chart-container')) {
                    parent.style.height = '450px'; // Main charts
                } else if (parent.classList.contains('mini-chart-container')) {
                    parent.style.height = '300px'; // Mini charts
                } else {
                    parent.style.height = '350px'; // Default for other charts
                }
                parent.style.width = '100%';

                // Create promise to wait for chart to render at high quality
                promises.push(new Promise(resolve => {
                    setTimeout(() => {
                        if (appState.charts[chart.id]) {
                            // Force high DPI rendering
                            appState.charts[chart.id].options.animation = false;
                            appState.charts[chart.id].options.devicePixelRatio = 3; // Triple DPI
                            appState.charts[chart.id].resize();
                            appState.charts[chart.id].render();
                        }
                        resolve();
                    }, 300); // Increased delay for complex charts
                }));
            });

            await Promise.all(promises);
        }

        /**
         * Restore chart sizes after PDF generation
         */
        function restoreChartSizes() {
            document.querySelectorAll('.chart-container').forEach(container => {
                container.style.height = '400px';
            });
            document.querySelectorAll('.mini-chart-container').forEach(container => {
                container.style.height = '250px';
            });

            // Update all charts with original settings
            Object.values(appState.charts).forEach(chart => {
                chart.options.animation = true;
                chart.options.devicePixelRatio = window.devicePixelRatio || 1;
                chart.resize();
                chart.render();
            });
        }

        /**
         * Initialize or retrieve the report counter from localStorage
         */
        let reportCounter = parseInt(localStorage.getItem('reportCounter')) || 1;

        /**
         * Generate sequential report ID
         * @returns {string} Generated report ID
         */
        function generateReportId() {
            const paddedNumber = String(reportCounter).padStart(4, '0');
            const reportId = `SJN-DPR-${paddedNumber}`;
            reportCounter++;
            localStorage.setItem('reportCounter', reportCounter);
            return reportId;
        }

        /**
         * Add premium page header to PDF
         */
        function addPremiumPageHeader(pdf, pageWidth, margin, reportDate, primaryColor, secondaryColor) {
            // Header background
            pdf.setFillColor(240, 245, 249);
            pdf.rect(0, 0, pageWidth, 60, 'F');

            // Header border
            pdf.setLineWidth(1);
            pdf.line(margin, 60, pageWidth - margin, 60);

            // Document title
            pdf.setFontSize(11);
            pdf.setTextColor(primaryColor);
            pdf.setFont('helvetica', 'bold');
            pdf.text('SJNPV Plant Performance Report', margin, 40);

            // Report date
            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.setFont('helvetica', 'normal');
            pdf.text(reportDate, pageWidth - margin, 40, { align: 'right' });
        }

        /**
         * Add premium page footer to PDF
         */
        function addPremiumPageFooter(pdf, pageWidth, pageHeight, margin, currentPage, totalPages) {
            // Footer background
            pdf.setFillColor(240, 245, 249);
            pdf.rect(0, pageHeight - 60, pageWidth, 60, 'F');

            // Footer border

            pdf.setLineWidth(1);
            pdf.line(margin, pageHeight - 60, pageWidth - margin, pageHeight - 60);

            // Footer text
            pdf.setFontSize(9);
            pdf.setTextColor(100);
            pdf.setFont('helvetica', 'normal');

            // Left-aligned text
            pdf.text('CONFIDENTIAL - For authorized personnel only', margin, pageHeight - 30);
            // Page number (if you want it in footer instead of header)
            pdf.setTextColor(150);
            pdf.text(`Page ${currentPage} of ${totalPages}`, pageWidth / 2, pageHeight - 30, { align: 'center' });
            // Right-aligned text
            pdf.text('© ' + new Date().getFullYear() + ' SJN Solar Plant - All Rights Reserved', pageWidth - margin, pageHeight - 30, { align: 'right' });
        }

        /**
         * Update Jeddah date and time display
         */
        function updateJeddahDateTime() {
            const options = {
                timeZone: 'Asia/Riyadh',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };

            const now = new Date();
            document.getElementById('report-date').textContent = now.toLocaleDateString('en-US', options);
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', {
                timeZone: 'Asia/Riyadh',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // =============================================
        // INITIALIZATION
        // =============================================

        /**
         * Initialize the application
         */
        function initializeApp() {
            // Initial calculations
            calculateOperationalHours();
            calculateDeviations();

            // Initialize charts
            initCharts();

            // Render report history
            renderReportHistory();

            // Initialize event listeners
            initializeEventListeners();

            // Set up Jeddah time display
            updateJeddahDateTime();
            setInterval(updateJeddahDateTime, 1000);
            initCharts();

            // Add these event listeners:
            document.querySelectorAll('#ghi-table input, #poa-table input').forEach(input => {
                input.addEventListener('input', updateWeatherChartData);
            });

            document.querySelectorAll('#equipment-performance-table input').forEach(input => {
                input.addEventListener('input', updateEquipmentChartData);
            });

            // Auto-save draft every 30 seconds
            setInterval(() => {
                if (appState.editMode) {
                    const reportData = collectReportData();
                    const reportDate = document.getElementById('report-of-date').textContent;
                    saveReport(reportDate, reportData, false);
                    renderReportHistory();
                }
            }, 30000);

            // Animation for solar panels
            const panels = document.querySelectorAll('.panel');
            panels.forEach((panel, index) => {
                panel.style.animation = `float ${3 + index * 0.2}s ease-in-out infinite`;
            });
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

</body>

</html>