<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>South Jeddah Noor 300MWAC PV SOLAR Plant - Permit to Work System</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --primary-color: #1a5276;
      --secondary-color: #3498db;
      --success-color: #27ae60;
      --danger-color: #e74c3c;
      --warning-color: #f39c12;
      --light-color: #ecf0f1;
      --dark-color: #2c3e50;
      --accent-color: #2980b9;
      --card-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: 'Playfair Display', serif;
      color: var(--primary-color);
    }

    .header-section {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: white;
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 2rem;
      box-shadow: var(--card-shadow);
      border-bottom: 4px solid var(--secondary-color);
    }

    .header-section h2 {
      color: white;
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    }

    .header-section h4 {
      color: var(--light-color);
      font-weight: 500;
    }

    .permit-card {
      border: none;
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      border-top: 4px solid var(--secondary-color);
    }

    .card-header {
      font-weight: 600;
      letter-spacing: 0.5px;
      padding: 1rem 1.5rem;
    }

    .section-title {
      color: var(--primary-color);
      margin: 1.5rem 0 1rem;
      border-bottom: 2px solid var(--secondary-color);
      padding-bottom: 0.5rem;
      font-weight: 600;
      font-size: 1.25rem;
    }

    .form-control,
    .form-select {
      border-radius: 6px;
      padding: 0.75rem 1rem;
      border: 1px solid #ddd;
      transition: all 0.3s;
      font-size: 0.95rem;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.2);
    }

    .btn {
      border-radius: 6px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      transition: all 0.3s;
      font-size: 0.95rem;
    }

    .btn-primary {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }

    .btn-primary:hover {
      background-color: #2874a6;
      border-color: #2874a6;
    }

    .btn-success {
      background-color: var(--success-color);
      border-color: var(--success-color);
    }

    .btn-success:hover {
      background-color: #219653;
      border-color: #219653;
    }

    .btn-danger {
      background-color: var(--danger-color);
      border-color: var(--danger-color);
    }

    .btn-danger:hover {
      background-color: #c0392b;
      border-color: #c0392b;
    }

    .btn-warning {
      background-color: var(--warning-color);
      border-color: var(--warning-color);
    }

    .btn-warning:hover {
      background-color: #d68910;
      border-color: #d68910;
    }

    .btn-outline-primary {
      color: var(--secondary-color);
      border-color: var(--secondary-color);
    }

    .btn-outline-primary:hover {
      background-color: var(--secondary-color);
      color: white;
    }

    .status-badge {
      background-color: #6c757d;
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: bold;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      display: inline-block;
      margin-left: 1rem;
      vertical-align: middle;
    }

    .status-badge.draft {
      background-color: #7f8c8d;
    }

    .status-badge.submitted {
      background-color: var(--secondary-color);
    }

    .status-badge.approved {
      background-color: var(--success-color);
    }

    .status-badge.rejected {
      background-color: var(--danger-color);
    }

    .approval-section {
      display: none;
    }

    /* Add to your existing CSS */
    .hazard-others-specify {
      margin-left: 25px;
      margin-top: 5px;
    }

    .issuer-mode {
      display: none;
    }

    .requester-mode {
      display: none;
    }

    .no-select-mode {
      display: block;
    }

    /* Add this to your CSS */
    .permit-list-item.active-permit {
      border-left: 4px solid var(--secondary-color);
      background-color: rgba(52, 152, 219, 0.05);
    }

    .permit-list-item {
      transition: all 0.2s ease;
    }

    /* Add these styles to your CSS */
    .filter-btn {
      border-radius: 4px;
      margin-right: 5px;
    }

    .filter-btn.active {
      background-color: var(--secondary-color);
      color: rgb(97, 32, 201);
    }

    #permitStatusTabs .nav-link {
      color: var(--primary-color);
      font-weight: 500;
    }

    #permitStatusTabs .nav-link.active {
      font-weight: 600;
      border-bottom: 3px solid var(--secondary-color);
    }

    #customDateRange .input-group-text {
      background-color: var(--light-color);
    }

    #pdf-loading-indicator {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 30px 40px;
      border-radius: 10px;
      z-index: 9999;
      text-align: center;
    }

    .signature-pad canvas {
      border: 1px solid #ddd;
      border-radius: 5px;
      width: 100% !important;
      height: 100px !important;
      background-color: white;
    }

    .password-modal .modal-dialog {
      max-width: 400px;
    }

    .final-status {
      font-size: 1.3rem;
      font-weight: bold;
      text-align: center;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .final-status.approved {
      background-color: rgba(39, 174, 96, 0.15);
      color: var(--success-color);
      border: 2px solid var(--success-color);
    }

    .final-status.rejected {
      background-color: rgba(231, 76, 60, 0.15);
      color: var(--danger-color);
      border: 2px solid var(--danger-color);
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }

    .notification-item {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 5px;
    }

    .notification-item:hover {
      background-color: #f8f9fa;
      transform: translateX(3px);
    }

    .notification-item .requester-name {
      font-weight: 600;
      color: var(--primary-color);
    }

    .notification-item .location {
      color: #7f8c8d;
      font-size: 0.9rem;
    }

    .notification-item .date {
      font-size: 0.8rem;
      color: #95a5a6;
    }

    .form-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }

    .form-header h4 {
      margin: 0;
      color: var(--primary-color);
    }

    .permit-list-item {
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 8px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s;
      background-color: white;
    }

    .permit-list-item:hover {
      background-color: #f8f9fa;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }

    .permit-list-item .permit-number {
      font-weight: bold;
      color: var(--primary-color);
    }

    .permit-list-item .permit-status {
      float: right;
    }

    .permit-details {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }

    .permit-details .detail-label {
      font-weight: 600;
      color: var(--primary-color);
      font-size: 0.9rem;
    }

    .tab-content {
      padding: 20px 0;
    }

    .mode-tabs .nav-link {
      font-weight: 600;
      padding: 12px 20px;
      color: var(--primary-color);
      border-radius: 0;
      border: none;
      position: relative;
    }

    .mode-tabs .nav-link.active {
      background-color: var(--primary-color);
      color: white;
    }

    .mode-tabs .nav-link:not(.active):hover {
      color: var(--secondary-color);
    }

    .mode-tabs .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--secondary-color);
    }

    .permit-info-box {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--card-shadow);
      border-left: 4px solid var(--secondary-color);
    }

    .permit-info-box .info-title {
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--primary-color);
      font-size: 1.1rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 8px;
    }

    .permit-info-box .info-content {
      font-size: 0.95rem;
      line-height: 1.6;
    }

    .info-content div {
      margin-bottom: 8px;
    }

    .time-date-input {
      display: flex;
      gap: 10px;
    }

    .time-date-input .form-control {
      flex: 1;
    }

    .signature-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .signature-label button {
      padding: 2px 8px;
      font-size: 0.8rem;
    }

    .card-header.bg-success {
      background-color: var(--success-color) !important;
    }

    .card-header.bg-primary {
      background-color: var(--primary-color) !important;
    }

    /* Add to your CSS */
    #crewMembersTable {
      font-size: 0.9rem;
    }

    #crewMembersTable th {
      white-space: nowrap;
    }

    #crewMembersTable input {
      border: 1px solid #dee2e6;
      min-width: 100px;
    }

    #crewMembersTable .remove-crew-member {
      padding: 0.25rem 0.5rem;
    }


    /* Add this to your CSS */
    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .form-header>div {
      display: flex;
      align-items: center;
    }

    #backToList {
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group label {
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--dark-color);
      font-size: 0.95rem;
    }

    .form-actions {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border-top: 1px solid #eee;
    }

    .no-print {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: var(--card-shadow);
    }

    /* New styles for additional sections */
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 8px;
    }

    .crew-member-table input {
      min-width: 100px;
    }

    .permit-section {
      display: none;
    }

    .permit-section.active {
      display: block;
    }

    @media print {
      body * {
        visibility: hidden;
      }

      #pdf-container,
      #pdf-container * {
        visibility: visible;
      }

      #pdf-container {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 15px;
        box-sizing: border-box;
      }
    }

    @media print {
      table {
        width: 100% !important;
        page-break-inside: avoid;
      }

      tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }

      td {
        padding: 3px !important;
        font-size: 12px !important;
      }

      h1,
      h2,
      h3,
      h4 {
        page-break-after: avoid;
      }
    }

    @media print {
      .container {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
      }

      .permit-card {
        border: none !important;
        box-shadow: none !important;
      }

      .nav-tabs,
      .no-print {
        display: none !important;
      }

      .tab-pane {
        display: block !important;
        opacity: 1 !important;
      }

      .no-break-inside {
        page-break-inside: avoid;
      }

      .force-black {
        color: #000 !important;
      }

      input,
      textarea,
      select {
        border: 1px solid #000 !important;
        background-color: white !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .form-check-input {
        -webkit-appearance: checkbox !important;
        appearance: checkbox !important;
      }

      .checkbox-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }

      .crew-member-table {
        font-size: 10px !important;
      }

      .permit-section {
        display: block !important;
      }
    }
  </style>
</head>

<body>
  <div class="container py-4">
    <div class="header-section text-center mb-4">
      <h2>South Jeddah Noor 300MW<sub>AC</sub> Solar Plant</h2>
      <h4>O&M Permit to Work Management</h4>
    </div>

    <!-- Password Modal -->
    <div class="modal fade password-modal" id="passwordModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Enter Password</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="passwordInput" class="form-label">Password:</label>
              <input type="password" class="form-control" id="passwordInput">
            </div>
            <div class="alert alert-danger d-none" id="passwordError">Invalid password. Please try again.</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="submitPassword">Submit</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal fade" id="notificationsModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Pending Permit Requests</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="notificationsList">
              <!-- Notifications will be loaded here -->
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Mode Selector -->
    <div class="card mb-4 no-print">
      <div class="card-body text-center">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-outline-primary position-relative" id="enterIssuerMode">
            <i class="bi bi-person-check"></i> Issuer Mode
            <span class="notification-badge d-none" id="issuerNotificationBadge">0</span>
          </button>
          <button type="button" class="btn btn-outline-success" id="enterRequesterMode">
            <i class="bi bi-person"></i> Requester Mode
          </button>
          <button type="button" class="btn btn-outline-secondary" id="enterNoSelectMode">
            <i class="bi bi-house"></i> Default View
          </button>
        </div>
        <div class="mt-2">
          <span id="currentModeDisplay" class="badge bg-light text-dark">Current mode: Default View</span>
        </div>
      </div>
    </div>
    <!-- Tab Contents -->
    <div class="tab-content" id="modeTabContent">
      <!-- No Select Mode Content -->
      <div class="tab-pane fade show active" id="no-select-content" role="tabpanel">
        <div class="card mb-4">
          <div class="card-header bg-light">
            <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Approved/Rejected Permits</h5>
          </div>
          <!-- Add this inside the no-select-content tab-pane, before the completedPermitsList div -->
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0"><i class="bi bi-funnel"></i> Filter Permits</h5>
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-md-8">
                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary filter-btn" data-range="day">Today</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-range="week">This
                      Week</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-range="month">This
                      Month</button>
                    <button type="button" class="btn btn-outline-primary filter-btn" data-range="custom">Custom
                      Range</button>
                  </div>
                </div>
                <div class="col-md-4" id="customDateRange" style="display: none;">
                  <div class="input-group">
                    <input type="date" class="form-control" id="dateFrom">
                    <span class="input-group-text">to</span>
                    <input type="date" class="form-control" id="dateTo">
                    <button class="btn btn-primary" id="applyCustomRange">Apply</button>
                  </div>
                </div>
              </div>

              <ul class="nav nav-tabs" id="permitStatusTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="approved-tab" data-bs-toggle="tab"
                    data-bs-target="#approved-content" type="button" role="tab">Approved Permits</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected-content"
                    type="button" role="tab">Rejected Permits</button>
                </li>
              </ul>
            </div>
          </div>
          <div class="tab-content" id="filteredPermitsContent">
            <div class="tab-pane fade show active" id="approved-content" role="tabpanel">
              <div id="approvedPermitsList"></div>
            </div>
            <div class="tab-pane fade" id="rejected-content" role="tabpanel">
              <div id="rejectedPermitsList"></div>
            </div>
          </div>
          <div class="card-body">
            <div id="completedPermitsList">
              <!-- Completed permits will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Requester Mode Content -->
      <div class="tab-pane fade" id="requester-content" role="tabpanel">
        <div class="card mb-4">
          <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> My Permit Applications</h5>
              <button type="button" class="btn btn-primary" id="createNewPermit">
                <i class="bi bi-plus-circle"></i> Create New Permit
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="draftPermitsList">
              <!-- Draft permits will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Permit Form (hidden by default) -->
        <div class="card permit-card d-none" id="requesterPermitFormCard">
          <div class="card-body">
            <form id="generalPermitForm">
              <div class="form-header">
                <div>
                  <button type="button" class="btn btn-sm btn-outline-secondary me-2" id="backToList">
                    <i class="bi bi-arrow-left"></i> Back
                  </button>
                  <h4><i class="bi bi-file-earmark-text"></i> Permit to Work</h4>
                </div>
                <div class="status-badge draft" id="permitStatus">DRAFT</div>
              </div>
              <!-- Permit Type Selection -->
              <div class="form-group mb-3">
                <label for="permitType">Permit Type</label>
                <select class="form-select" id="permitType">
                  <option value="general">General Work Permit</option>
                  <option value="hot-work">Hot Work Permit</option>
                  <option value="electrical">Electrical Work Permit</option>
                  <option value="confined">Confined Space Permit</option>
                  <option value="height">Work at Height Permit</option>
                  <option value="loto">LOTO Certificate</option>
                  <option value="lifting">Lifting Permit</option>
                  <option value="excavation">Excavation Permit</option>
                </select>
              </div>

              <!-- Permit Status Display -->
              <div id="finalStatusDisplay" class="final-status d-none"></div>

              <!-- Common Permit Sections -->
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group mb-3">
                    <label for="permitNumber">Permit Number</label>
                    <input type="text" class="form-control" id="permitNumber" placeholder="O&M-PTW-0000" readonly>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group mb-3">
                    <label>Date Issued</label>
                    <input type="date" class="form-control" id="dateIssued" readonly>
                  </div>
                </div>
              </div>
              <div class="form-group mb-3">
                <label>Plant Name</label>
                <input type="text" class="form-control" value="South Jeddah Noor 300 MWAC PV Solar Project" readonly>
              </div>
              <h5 class="section-title"><i class="bi bi-geo-alt"></i> Plant Area & Department</h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>SJNPV Plant Area</label>
                    <div class="checkbox-grid">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="PV Field" id="areaPVField"
                          name="plantArea">
                        <label class="form-check-label" for="areaPVField">PV Field</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="PVSS" id="areaPVSS" name="plantArea">
                        <label class="form-check-label" for="areaPVSS">PVSS</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="O&M Building" id="areaOMBuilding"
                          name="plantArea">
                        <label class="form-check-label" for="areaOMBuilding">O&M Building</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="O&M Warehouse" id="areaOMWarehouse"
                          name="plantArea">
                        <label class="form-check-label" for="areaOMWarehouse">O&M Warehouse</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Security Center" id="areaSecurityCenter"
                          name="plantArea">
                        <label class="form-check-label" for="areaSecurityCenter">Security Center</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Visitor Center" id="areaVisitorCenter"
                          name="plantArea">
                        <label class="form-check-label" for="areaVisitorCenter">Visitor Center</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Guard House" id="areaGuardHouse"
                          name="plantArea">
                        <label class="form-check-label" for="areaGuardHouse">Guard House</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="areaOthers" name="plantArea">
                        <label class="form-check-label" for="areaOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="areaOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>O&M Department</label>
                    <div class="checkbox-grid">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electrical" id="deptElectrical"
                          name="department">
                        <label class="form-check-label" for="deptElectrical">Electrical</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Mechnical" id="deptMechnical"
                          name="department">
                        <label class="form-check-label" for="deptMechnical">Mechnical</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Civil" id="deptCivil" name="department">
                        <label class="form-check-label" for="deptCivil">Civil</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="IT" id="deptIT" name="department">
                        <label class="form-check-label" for="deptIT">IT</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Security and Safety" id="deptSecurity"
                          name="department">
                        <label class="form-check-label" for="deptSecurity">Security and Safety</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Admin" id="deptAdmin" name="department">
                        <label class="form-check-label" for="deptAdmin">Admin</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="deptOthers"
                          name="department">
                        <label class="form-check-label" for="deptOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="deptOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Contractor/Company</label>
                    <input type="text" class="form-control" id="contractorCompany">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Number of Employees</label>
                    <input type="number" class="form-control" id="numEmployees" min="1">
                  </div>
                </div>
              </div>
              <h5 class="section-title"><i class="bi bi-calendar-check"></i> Work Execution Plan</h5>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="validFrom">Valid From (Date/Time)</label>
                    <input type="datetime-local" class="form-control" id="validFrom">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="validTo">Valid To (Date/Time)</label>
                    <input type="datetime-local" class="form-control" id="validTo">
                    <small class="form-text text-muted">Maximum for one Shift (12 hrs)</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="plantUnit">Location of Work</label>
                    <input type="text" class="form-control" id="locationOfWork"
                      placeholder="For Example: Column Number, LT Panel Number">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="functionalLocation">Equipment Functional Name</label>
                    <input type="text" class="form-control" id="functionalName"
                      placeholder="For example: M-Box or Inverter Duty Transformer">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="equipmentNo">Equipment Identification Number</label>
                    <input type="text" class="form-control" id="equipmentNo"
                      placeholder="For example: C-207 T-06 B-33 LT-02 INV-03">
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Tools and Equipment</label>
                    <select class="form-control" id="equipmentType">
                      <option>Please Select Tools</option>
                      <option>Power Tools</option>
                      <option>Hand Tools </option>
                      <option>Both Power and Hand Tools</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="workDescription">Description of Work</label>
                <textarea class="form-control" id="workDescription" rows="3"
                  placeholder="Write details of task perform"></textarea>
              </div>


              <!-- Permit Type Sections -->
              <!-- General Work Permit Section -->
              <div id="general-permit-sections" class="permit-section active">
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Work</h5>
                <div class="form-group">
                  <p class="mb-2">Check all possible hazards from the work activity:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electric Arc Flash"
                          id="hazardElectricArcFlash" name="hazards">
                        <label class="form-check-label" for="hazardElectricArcFlash">Electric Arc Flash</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Manual Handling"
                          id="hazardManualHandling" name="hazards">
                        <label class="form-check-label" for="hazardManualHandling">Manual Handling</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Impact Load / Objects"
                          id="hazardImpactLoadObjects" name="hazards">
                        <label class="form-check-label" for="hazardImpactLoadObjects">Impact Load / Objects</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Stored Energy" id="hazardStoredEnergy"
                          name="hazards">
                        <label class="form-check-label" for="hazardStoredEnergy">Stored Energy</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Improper Storage"
                          id="hazardImproperStorage" name="hazards">
                        <label class="form-check-label" for="hazardImproperStorage">Improper Storage</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Lifting / Overhead Loads"
                          id="hazardLiftingOverheadLoads" name="hazards">
                        <label class="form-check-label" for="hazardLiftingOverheadLoads">Lifting / Overhead
                          Loads</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ergonomics" id="hazardErgonomics"
                          name="hazards">
                        <label class="form-check-label" for="hazardErgonomics">Ergonomics</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hot Surfaces" id="hazardHotSurfaces"
                          name="hazards">
                        <label class="form-check-label" for="hazardHotSurfaces">Hot Surfaces</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Cut / Laceration"
                          id="hazardCutLaceration" name="hazards">
                        <label class="form-check-label" for="hazardCutLaceration">Cut / Laceration</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dust / Fumes" id="hazardDustFumes"
                          name="hazards">
                        <label class="form-check-label" for="hazardDustFumes">Dust / Fumes</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="High Noise" id="hazardHighNoise"
                          name="hazards">
                        <label class="form-check-label" for="hazardHighNoise">High Noise</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Contact to HV/MV/LV/Live Working"
                          id="hazardContactHVLVLiveWorking" name="hazards">
                        <label class="form-check-label" for="hazardContactHVLVLiveWorking">Contact to HV/MV/LV/Live
                          Working</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fall from Height / Same Level"
                          id="hazardFallFromHeightSameLevel" name="hazards">
                        <label class="form-check-label" for="hazardFallFromHeightSameLevel">Fall from Height / Same
                          Level</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="High Temperature"
                          id="hazardHighTemperature" name="hazards">
                        <label class="form-check-label" for="hazardHighTemperature">High Temperature</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Pressurized System"
                          id="hazardPressurizedSystem" name="hazards">
                        <label class="form-check-label" for="hazardPressurizedSystem">Pressurized System</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Over-exertion" id="hazardOverExertion"
                          name="hazards">
                        <label class="form-check-label" for="hazardOverExertion">Over-exertion</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Radiation" id="hazardRadiation"
                          name="hazards">
                        <label class="form-check-label" for="hazardRadiation">Radiation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Flammable Material"
                          id="hazardFlammableMaterial" name="hazards">
                        <label class="form-check-label" for="hazardFlammableMaterial">Flammable Material</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Toxic Agents" id="hazardToxicAgents"
                          name="hazards">
                        <label class="form-check-label" for="hazardToxicAgents">Toxic Agents</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Housekeeping" id="hazardHousekeeping"
                          name="hazards">
                        <label class="form-check-label" for="hazardHousekeeping">Housekeeping</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Slips, Trips & Falls"
                          id="hazardSlipsTripsFalls" name="hazards">
                        <label class="form-check-label" for="hazardSlipsTripsFalls">Slips, Trips & Falls</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Confined Space" id="hazardConfinedSpace"
                          name="hazards">
                        <label class="form-check-label" for="hazardConfinedSpace">Confined Space</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Falling Objects"
                          id="hazardFallingObjects" name="hazards">
                        <label class="form-check-label" for="hazardFallingObjects">Falling Objects</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Corrosive Substances"
                          id="hazardCorrosiveSubstances" name="hazards">
                        <label class="form-check-label" for="hazardCorrosiveSubstances">Corrosive Substances</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Heat Stress" id="hazardHeatStress"
                          name="hazards">
                        <label class="form-check-label" for="hazardHeatStress">Heat Stress</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Entrapment / Entanglement"
                          id="hazardEntrapmentEntanglement" name="hazards">
                        <label class="form-check-label" for="hazardEntrapmentEntanglement">Entrapment /
                          Entanglement</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Physical Agent" id="hazardPhysicalAgent"
                          name="hazards">
                        <label class="form-check-label" for="hazardPhysicalAgent">Physical Agent</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dust Exposures" id="hazardDustExposures"
                          name="hazards">
                        <label class="form-check-label" for="hazardDustExposures">Dust Exposures</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Access / Egress" id="hazardAccessEgress"
                          name="hazards">
                        <label class="form-check-label" for="hazardAccessEgress">Access / Egress</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Asphyxiation" id="hazardAsphyxiation"
                          name="hazards">
                        <label class="form-check-label" for="hazardAsphyxiation">Asphyxiation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Underground Services (Cables etc.)"
                          id="hazardUndergroundServices" name="hazards">
                        <label class="form-check-label" for="hazardUndergroundServices">Underground Services (Cables
                          etc.)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="hazardOthers" name="hazards">
                        <label class="form-check-label" for="hazardOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="hazardOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> Precautions / Mitigation Measures</h5>
                <div class="form-group">
                  <p class="mb-2">Select all Precautions / Mitigation Measures available at site:</p>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Implement lockout/tagout (LOTO)"
                          id="precLOTO" name="precautions">
                        <label class="form-check-label" for="precLOTO">Implement lockout/tagout (LOTO)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Maintain Safe working Distance"
                          id="precSafeDistance" name="precautions">
                        <label class="form-check-label" for="precSafeDistance">Maintain Safe working Distance</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Utilize appropriate PPE"
                          id="precAppropriatePPE" name="precautions">
                        <label class="form-check-label" for="precAppropriatePPE">Utilize appropriate PPE, including
                          arc-rated clothing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use safe lifting techniques"
                          id="precSafeLifting" name="precautions">
                        <label class="form-check-label" for="precSafeLifting">Use safe lifting techniques</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Secure loads properly"
                          id="precSecureLoads" name="precautions">
                        <label class="form-check-label" for="precSecureLoads">Secure loads properly to prevent movement
                          or falling</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Verify energy sources de-energized"
                          id="precDeEnergized" name="precautions">
                        <label class="form-check-label" for="precDeEnergized">Verify that energy sources are fully
                          de-energized before work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Keep storage areas organized"
                          id="precOrganizedStorage" name="precautions">
                        <label class="form-check-label" for="precOrganizedStorage">Keep storage areas organized and free
                          of obstructions</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ensure proper rigging of loads"
                          id="precProperRigging" name="precautions">
                        <label class="form-check-label" for="precProperRigging">Ensure proper rigging of loads</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Implement regular breaks"
                          id="precRegularBreaks" name="precautions">
                        <label class="form-check-label" for="precRegularBreaks">Implement regular breaks and task
                          rotation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Label hot surfaces"
                          id="precLabelHotSurfaces" name="precautions">
                        <label class="form-check-label" for="precLabelHotSurfaces">Clearly label hot surfaces with
                          warnings</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Wear heat-resistant gloves"
                          id="precHeatResistantGloves" name="precautions">
                        <label class="form-check-label" for="precHeatResistantGloves">Ensure personnel wear
                          heat-resistant gloves and protective clothing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Wear cut-resistant gloves"
                          id="precCutResistantGloves" name="precautions">
                        <label class="form-check-label" for="precCutResistantGloves">Wear cut-resistant gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Keep work areas clear"
                          id="precClearWorkAreas" name="precautions">
                        <label class="form-check-label" for="precClearWorkAreas">Keep work areas clear of sharp
                          debris</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use sharp tools safely"
                          id="precSharpTools" name="precautions">
                        <label class="form-check-label" for="precSharpTools">Use sharp tools safely and
                          correctly</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use respiratory protection"
                          id="precRespiratoryProtection" name="precautions">
                        <label class="form-check-label" for="precRespiratoryProtection">Ensure proper use of respiratory
                          protective equipment</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use hearing protection"
                          id="precHearingProtection" name="precautions">
                        <label class="form-check-label" for="precHearingProtection">Use of hearing protection
                          devices</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Qualified electrical personnel"
                          id="precQualifiedPersonnel" name="precautions">
                        <label class="form-check-label" for="precQualifiedPersonnel">Ensure qualified personnel perform
                          electrical work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use insulated tools"
                          id="precInsulatedTools" name="precautions">
                        <label class="form-check-label" for="precInsulatedTools">Use insulated tools and appropriate
                          PPE</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Implement fall protection"
                          id="precFallProtection" name="precautions">
                        <label class="form-check-label" for="precFallProtection">Implement fall protection systems like
                          guardrails or harnesses</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Maintain 3-point contact"
                          id="precThreePointContact" name="precautions">
                        <label class="form-check-label" for="precThreePointContact">Maintain 3-point contact while using
                          ladder</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ensure clear pathways"
                          id="precClearPathways" name="precautions">
                        <label class="form-check-label" for="precClearPathways">Ensure clear pathways to prevent
                          same-level falls</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Encourage hydration" id="precHydration"
                          name="precautions">
                        <label class="form-check-label" for="precHydration">Encourage frequent hydration</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Train for heat stress"
                          id="precHeatStressTraining" name="precautions">
                        <label class="form-check-label" for="precHeatStressTraining">Train workers to recognize and
                          respond to heat stress symptoms</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Inspect components"
                          id="precComponentInspection" name="precautions">
                        <label class="form-check-label" for="precComponentInspection">Regularly inspect all components
                          for integrity</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Bleed off pressure"
                          id="precBleedPressure" name="precautions">
                        <label class="form-check-label" for="precBleedPressure">Safely bleed off pressure before
                          maintenance or disconnection</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Provide mechanical aids"
                          id="precMechanicalAids" name="precautions">
                        <label class="form-check-label" for="precMechanicalAids">Provide mechanical aids for lifting and
                          moving heavy objects</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Implement ALARA principle" id="precALARA"
                          name="precautions">
                        <label class="form-check-label" for="precALARA">Implement the ALARA principle (As Low As
                          Reasonably Achievable)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Maximize distance"
                          id="precMaximizeDistance" name="precautions">
                        <label class="form-check-label" for="precMaximizeDistance">Maximize distance, use shielding, and
                          minimize exposure time</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Store flammable materials properly"
                          id="precFlammableStorage" name="precautions">
                        <label class="form-check-label" for="precFlammableStorage">Store flammable materials in
                          designated, well-ventilated areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="precOthers"
                          name="precautions">
                        <label class="form-check-label" for="precOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="precOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <p class="mb-2">Check all PPE required for the work permit:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hard Helmet" id="ppeHardHelmet"
                          name="ppe">
                        <label class="form-check-label" for="ppeHardHelmet">Hard Helmet</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electrical Insulated Gloves"
                          id="ppeElectricalGloves" name="ppe">
                        <label class="form-check-label" for="ppeElectricalGloves">Electrical Insulated Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Leather Gloves" id="ppeLeatherGloves"
                          name="ppe">
                        <label class="form-check-label" for="ppeLeatherGloves">Leather Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Chemical Gloves" id="ppeChemicalGloves"
                          name="ppe">
                        <label class="form-check-label" for="ppeChemicalGloves">Chemical Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety Glasses" id="ppeSafetyGlasses"
                          name="ppe">
                        <label class="form-check-label" for="ppeSafetyGlasses">Safety Glasses</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Chemical Goggles" id="ppeChemicalGoggles"
                          name="ppe">
                        <label class="form-check-label" for="ppeChemicalGoggles">Chemical Goggles</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc Flash Protection Face Shield"
                          id="ppeArcFlashShield" name="ppe">
                        <label class="form-check-label" for="ppeArcFlashShield">Arc Flash Protection Face Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Welding Shield" id="ppeWeldingShield"
                          name="ppe">
                        <label class="form-check-label" for="ppeWeldingShield">Welding Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Plastic Face Shield"
                          id="ppePlasticShield" name="ppe">
                        <label class="form-check-label" for="ppePlasticShield">Plastic Face Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ear Plugs" id="ppeEarPlugs" name="ppe">
                        <label class="form-check-label" for="ppeEarPlugs">Ear Plugs</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ear Muffs" id="ppeEarMuffs" name="ppe">
                        <label class="form-check-label" for="ppeEarMuffs">Ear Muffs</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety Shoes" id="ppeSafetyShoes"
                          name="ppe">
                        <label class="form-check-label" for="ppeSafetyShoes">Safety Shoes</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Gum Boot" id="ppeGumBoot" name="ppe">
                        <label class="form-check-label" for="ppeGumBoot">Gum Boot</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Snake Protection Pad"
                          id="ppeSnakeProtection" name="ppe">
                        <label class="form-check-label" for="ppeSnakeProtection">Snake Protection Pad</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="ppeOthers" name="ppe">
                        <label class="form-check-label" for="ppeOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="ppeOthersSpecify" placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Hot Work Permit Section -->
              <div id="hot-work-sections" class="permit-section">
                <!-- Hot Work Specific Hazards -->
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Work</h5>
                <div class="form-group">
                  <p class="mb-2">Check all possible hazards from the work activity:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Welding Molds" id="hwHazardWeldingMolds"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardWeldingMolds">Welding Molds</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Flame Cutting / Open Flame"
                          id="hwHazardFlameCutting" name="hwHazards">
                        <label class="form-check-label" for="hwHazardFlameCutting">Flame Cutting / Open Flame</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Manual Handling"
                          id="hwHazardManualHandling" name="hwHazards">
                        <label class="form-check-label" for="hwHazardManualHandling">Manual Handling</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Inspected Tools"
                          id="hwHazardInspectedTools" name="hwHazards">
                        <label class="form-check-label" for="hwHazardInspectedTools">Inspected Tools</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dust Exposures"
                          id="hwHazardDustExposures" name="hwHazards">
                        <label class="form-check-label" for="hwHazardDustExposures">Dust Exposures</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Sparks Producing"
                          id="hwHazardSparksProducing" name="hwHazards">
                        <label class="form-check-label" for="hwHazardSparksProducing">Sparks Producing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fall from height/ same level"
                          id="hwHazardFallFromHeight" name="hwHazards">
                        <label class="form-check-label" for="hwHazardFallFromHeight">Fall from height/ same
                          level</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dust/Fumes" id="hwHazardDustFumes"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardDustFumes">Dust/Fumes</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Access/ egress" id="hwHazardAccessEgress"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardAccessEgress">Access/ egress</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Asphyxiation" id="hwHazardAsphyxiation"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardAsphyxiation">Asphyxiation</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Blasting toxic hazards"
                          id="hwHazardBlastingToxic" name="hwHazards">
                        <label class="form-check-label" for="hwHazardBlastingToxic">Blasting toxic hazards</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Pressurized Gas Cylinders"
                          id="hwHazardGasCylinders" name="hwHazards">
                        <label class="form-check-label" for="hwHazardGasCylinders">Pressurized Gas Cylinders</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fire" id="hwHazardFire" name="hwHazards">
                        <label class="form-check-label" for="hwHazardFire">Fire</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Lone working" id="hwHazardLoneWorking"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardLoneWorking">Lone working</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hot Surfaces" id="hwHazardHotSurfaces"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardHotSurfaces">Hot Surfaces</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Power Brushing"
                          id="hwHazardPowerBrushing" name="hwHazards">
                        <label class="form-check-label" for="hwHazardPowerBrushing">Power Brushing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fragile grinder disk"
                          id="hwHazardFragileGrinder" name="hwHazards">
                        <label class="form-check-label" for="hwHazardFragileGrinder">Fragile grinder disk</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Slip/trip & fall"
                          id="hwHazardSlipTripFall" name="hwHazards">
                        <label class="form-check-label" for="hwHazardSlipTripFall">Slip/trip & fall</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Cut/Laceration"
                          id="hwHazardCutLaceration" name="hwHazards">
                        <label class="form-check-label" for="hwHazardCutLaceration">Cut/Laceration</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Flammable material"
                          id="hwHazardFlammableMaterial" name="hwHazards">
                        <label class="form-check-label" for="hwHazardFlammableMaterial">Flammable material</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Confined Space"
                          id="hwHazardConfinedSpace" name="hwHazards">
                        <label class="form-check-label" for="hwHazardConfinedSpace">Confined Space</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Falling Objects"
                          id="hwHazardFallingObjects" name="hwHazards">
                        <label class="form-check-label" for="hwHazardFallingObjects">Falling Objects</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Corrosive Substances"
                          id="hwHazardCorrosiveSubstances" name="hwHazards">
                        <label class="form-check-label" for="hwHazardCorrosiveSubstances">Corrosive Substances</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Heat Stress" id="hwHazardHeatStress"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardHeatStress">Heat Stress</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Entrapment / Entanglement"
                          id="hwHazardEntrapmentEntanglement" name="hwHazards">
                        <label class="form-check-label" for="hwHazardEntrapmentEntanglement">Entrapment /
                          Entanglement</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Physical Agent"
                          id="hwHazardPhysicalAgent" name="hwHazards">
                        <label class="form-check-label" for="hwHazardPhysicalAgent">Physical Agent</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Access / Egress"
                          id="hwHazardAccessEgress2" name="hwHazards">
                        <label class="form-check-label" for="hwHazardAccessEgress2">Access / Egress</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Underground Services (Cables etc.)"
                          id="hwHazardUndergroundServices" name="hwHazards">
                        <label class="form-check-label" for="hwHazardUndergroundServices">Underground Services (Cables
                          etc.)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="hwHazardOthers"
                          name="hwHazards">
                        <label class="form-check-label" for="hwHazardOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="hwHazardOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Hot Work Specific Precautions -->
                <h5 class="section-title"><i class="bi bi-shield-check"></i> PRECAUTIONS / MITIGATION MEASURES</h5>
                <div class="form-group">
                  <p class="mb-2">Select all precautions / mitigation measures available at site:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fire Watch" id="hwPrecFireWatch"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecFireWatch">Fire Watch</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Standby Fire Hoses" id="hwPrecFireHoses"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecFireHoses">Standby Fire Hoses</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Flash Back Arrestor (FBA)" id="hwPrecFBA"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecFBA">Flash Back Arrestor (FBA)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safe Work Positions"
                          id="hwPrecSafeWorkPositions" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecSafeWorkPositions">Safe Work Positions</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Ensure Proper Disk Fitting to Grinder with Guard" id="hwPrecGrinderGuard"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecGrinderGuard">Ensure Proper Disk Fitting to Grinder
                          with Guard</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Pre-Job Meeting/ Tool Box Talk"
                          id="hwPrecToolBoxTalk" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecToolBoxTalk">Pre-Job Meeting/ Tool Box Talk</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fire Extinguisher / Fire Blanket"
                          id="hwPrecFireExtinguisher" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecFireExtinguisher">Fire Extinguisher / Fire
                          Blanket</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="First Aid Available" id="hwPrecFirstAid"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecFirstAid">First Aid Available</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Insulated Tools Available"
                          id="hwPrecInsulatedTools" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecInsulatedTools">Insulated Tools Available</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Energy Isolation/ apply LOTO"
                          id="hwPrecLOTO" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecLOTO">Energy Isolation/ apply LOTO</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ventilation" id="hwPrecVentilation"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecVentilation">Ventilation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Job Safety Analysis" id="hwPrecJSA"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecJSA">Job Safety Analysis</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Area Barricades & Signs in place"
                          id="hwPrecBarricades" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecBarricades">Area Barricades & Signs in place</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Remove or cover any combustible material"
                          id="hwPrecRemoveCombustible" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecRemoveCombustible">Remove or cover any combustible
                          material</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Gas Monitoring if work to be done in confined space" id="hwPrecGasMonitoring"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecGasMonitoring">Gas Monitoring if work to be done in
                          confined space</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Gas Cylinders chained with trolley"
                          id="hwPrecGasCylinders" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecGasCylinders">Gas Cylinders chained with
                          trolley</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Canopy to control fumes & sparks"
                          id="hwPrecCanopy" name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecCanopy">Canopy to control fumes & sparks</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="hwPrecOthers"
                          name="hwPrecautions">
                        <label class="form-check-label" for="hwPrecOthers">Others (Please specify)</label>
                        <input type="text" class="form-control mt-1" id="hwPrecOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Hot Work Specific PPE -->

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <p class="mb-2">Check all PPE required for the work permit:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hard Helmet" id="ppeHardHelmet"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeHardHelmet">Hard Helmet</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electrical Insulated Gloves"
                          id="ppeElectricalGloves" name="hwPPE">
                        <label class="form-check-label" for="ppeElectricalGloves">Electrical Insulated Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Leather Gloves" id="ppeLeatherGloves"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeLeatherGloves">Leather Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Chemical Gloves" id="ppeChemicalGloves"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeChemicalGloves">Chemical Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety Glasses" id="ppeSafetyGlasses"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeSafetyGlasses">Safety Glasses</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Chemical Goggles" id="ppeChemicalGoggles"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeChemicalGoggles">Chemical Goggles</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc Flash Protection Face Shield"
                          id="ppeArcFlashShield" name="hwPPE">
                        <label class="form-check-label" for="ppeArcFlashShield">Arc Flash Protection Face
                          Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Welding Shield" id="ppeWeldingShield"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeWeldingShield">Welding Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Plastic Face Shield"
                          id="ppePlasticShield" name="hwPPE">
                        <label class="form-check-label" for="ppePlasticShield">Plastic Face Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ear Plugs" id="ppeEarPlugs" name="hwPPE">
                        <label class="form-check-label" for="ppeEarPlugs">Ear Plugs</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Ear Muffs" id="ppeEarMuffs" name="hwPPE">
                        <label class="form-check-label" for="ppeEarMuffs">Ear Muffs</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety Shoes" id="ppeSafetyShoes"
                          name="hwPPE">
                        <label class="form-check-label" for="ppeSafetyShoes">Safety Shoes</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Gum Boot" id="ppeGumBoot" name="hwPPE">
                        <label class="form-check-label" for="ppeGumBoot">Gum Boot</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Snake Protection Pad"
                          id="ppeSnakeProtection" name="hwPPE">
                        <label class="form-check-label" for="ppeSnakeProtection">Snake Protection Pad</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="ppeOthers" name="hwPPE">
                        <label class="form-check-label" for="ppeOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="ppeOthersSpecify" placeholder="Please specify"
                          name="ppeOthersSpecify">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div id="electrical-sections" class="permit-section">
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Electrical Work
                </h5>
                <div class="form-group">
                  <p class="mb-2">Check all possible hazards from the work activity:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electric Shock" id="hazardElectricShock"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardElectricShock">Electric Shock (AC/DC)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc Flash" id="hazardArcFlash"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardArcFlash">Arc Flash/Blast</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Short Circuit" id="hazardShortCircuit"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardShortCircuit">Short Circuit</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Live Parts" id="hazardLiveParts"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardLiveParts">Contact with Live Parts</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Backfeed Hazard" id="hazardBackfeed"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardBackfeed">Backfeed from Solar PV (Daylight
                          Risk)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Battery Hazards" id="hazardBattery"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardBattery">Battery Hazards (Explosion, Acid
                          Leak)</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fire" id="hazardFire"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardFire">Electrical Fire</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Explosion" id="hazardExplosion"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardExplosion">Explosion (Battery/Transformer)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Overheating" id="hazardOverheating"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardOverheating">Overheating (Inverters, Cables)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Stored Energy" id="hazardStoredEnergy"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardStoredEnergy">Stored Energy (Capacitors,
                          Batteries)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Thermal Burns" id="hazardThermalBurns"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardThermalBurns">Thermal Burns (Hot Surfaces)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Falling Hazards" id="hazardFalling"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardFalling">Falling from Heights (PV Modules)</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fault Current" id="hazardFaultCurrent"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardFaultCurrent">High Fault Current</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Induced Voltage"
                          id="hazardInducedVoltage" name="electricalHazards">
                        <label class="form-check-label" for="hazardInducedVoltage">Induced Voltage (MV Cables)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Static Electricity"
                          id="hazardStaticElectricity" name="electricalHazards">
                        <label class="form-check-label" for="hazardStaticElectricity">Static Electricity</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Confined Space" id="hazardConfinedSpace"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardConfinedSpace">Confined Space (Battery/Server
                          Room)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="UV Exposure" id="hazardUVExposure"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardUVExposure">UV Exposure (PV Field Work)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="hazardOthersElectrical"
                          name="electricalHazards">
                        <label class="form-check-label" for="hazardOthersElectrical">Others</label>
                        <input type="text" class="form-control mt-1" id="hazardOthersElectricalSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> Electrical Work Precautions</h5>
                <div class="form-group">
                  <p class="mb-2">Select all precautions / mitigation measures available at site:</p>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="LOTO Implemented" id="precLOTO"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precLOTO">Lockout/Tagout (LOTO) Implemented</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Voltage Verification"
                          id="precVoltageTest" name="electricalPrecautions">
                        <label class="form-check-label" for="precVoltageTest">Voltage Verification Before Work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Grounding" id="precGrounding"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precGrounding">Proper Grounding Established</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Barricades" id="precBarricades"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precBarricades">Barricades and Warning Signs</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Capacitor Discharge"
                          id="precCapDischarge" name="electricalPrecautions">
                        <label class="form-check-label" for="precCapDischarge">Capacitor Banks Discharged</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Flash Boundary" id="precFlashBoundary"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precFlashBoundary">Flash Boundary Established</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="PV Isolation" id="precPVIsolation"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precPVIsolation">PV Array Isolated (Daylight
                          Cover/Disconnect)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Battery Safety" id="precBatterySafety"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precBatterySafety">Battery Safety Protocols (Ventilation,
                          PPE)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Qualified Personnel"
                          id="precQualifiedPersonnel" name="electricalPrecautions">
                        <label class="form-check-label" for="precQualifiedPersonnel">Qualified Personnel Only</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Insulated Tools" id="precInsulatedTools"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precInsulatedTools">Insulated Tools Used</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Work Permit" id="precWorkPermit"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precWorkPermit">Electrical Work Permit Obtained</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Emergency Plan" id="precEmergencyPlan"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precEmergencyPlan">Emergency Response Plan in Place</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fall Protection" id="precFallProtection"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precFallProtection">Fall Protection (Harness,
                          Lanyards)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Thermal Monitoring"
                          id="precThermalMonitoring" name="electricalPrecautions">
                        <label class="form-check-label" for="precThermalMonitoring">Thermal Monitoring (IR
                          Scanning)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="precOthersElectrical"
                          name="electricalPrecautions">
                        <label class="form-check-label" for="precOthersElectrical">Others</label>
                        <input type="text" class="form-control mt-1" id="precOthersElectricalSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <p class="mb-2">Check all PPE required for the work permit:</p>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Voltage-Rated Gloves"
                          id="ppeVoltageGloves" name="electricalPPE">
                        <label class="form-check-label" for="ppeVoltageGloves">Voltage-Rated Gloves (Class 00-4) +
                          Leather Protectors</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc Flash Suit" id="ppeArcFlashSuit"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeArcFlashSuit">Arc Flash Suit (Category 2-4)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety Glasses" id="ppeSafetyGlasses"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeSafetyGlasses">Safety Glasses (ANSI Z87+)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Insulated Matting"
                          id="ppeInsulatedMatting" name="electricalPPE">
                        <label class="form-check-label" for="ppeInsulatedMatting">Insulated Matting (For MV
                          Work)</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Face Shield" id="ppeFaceShield"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeFaceShield">Arc-Rated Face Shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Insulated Boots" id="ppeInsulatedBoots"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeInsulatedBoots">Insulated Boots (EH Rated)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hard Hat" id="ppeHardHat"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeHardHat">Hard Hat (Class E)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Sun Protection" id="ppeSunProtection"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeSunProtection">Sun Protection (UV Hat,
                          Sunglasses)</label>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hearing Protection"
                          id="ppeHearingProtection" name="electricalPPE">
                        <label class="form-check-label" for="ppeHearingProtection">Hearing Protection (Inverter
                          Noise)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Voltage Detector" id="ppeVoltageDetector"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeVoltageDetector">Voltage Detector (AC/DC)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fall Protection Gear"
                          id="ppeFallProtection" name="electricalPPE">
                        <label class="form-check-label" for="ppeFallProtection">Fall Protection (Harness,
                          Lanyard)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="ppeOthersElectrical"
                          name="electricalPPE">
                        <label class="form-check-label" for="ppeOthersElectrical">Others</label>
                        <input type="text" class="form-control mt-1" id="ppeOthersElectricalSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Confined Space Permit Section -->
              <div id="confined-sections" class="permit-section">
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Confined Space
                </h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Oxygen Deficiency"
                          id="hazardOxygenDeficiency" name="confinedHazards">
                        <label class="form-check-label" for="hazardOxygenDeficiency">Oxygen Deficiency</label>
                      </div>
                      <!-- Additional hazards from the table version -->
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electrical hazards" id="hazardElectrical"
                          name="confinedHazards">
                        <label class="form-check-label" for="hazardElectrical">Electrical hazards from live DC/AC
                          cables</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc flash hazards" id="hazardArcFlash"
                          name="confinedHazards">
                        <label class="form-check-label" for="hazardArcFlash">Potential arc flash hazards</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Toxic gases" id="hazardToxicGases"
                          name="confinedHazards">
                        <label class="form-check-label" for="hazardToxicGases">Accumulation of toxic gases</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Engulfment hazard" id="hazardEngulfment"
                          name="confinedHazards">
                        <label class="form-check-label" for="hazardEngulfment">Engulfment hazard</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Extreme temperatures"
                          id="hazardTemperature" name="confinedHazards">
                        <label class="form-check-label" for="hazardTemperature">Extreme temperatures</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Battery room hazards" id="hazardBattery"
                          name="confinedHazards">
                        <label class="form-check-label" for="hazardBattery">Battery room hazards</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Restricted movement"
                          id="hazardRestricted" name="confinedHazards">
                        <label class="form-check-label" for="hazardRestricted">Restricted movement</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> Confined Space Precautions</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Continuous Ventilation"
                          id="precVentilation" name="confinedPrecautions">
                        <label class="form-check-label" for="precVentilation">Continuous Ventilation</label>
                      </div>
                      <!-- Additional precautions from the table version -->
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="LOTO performed" id="precLoto"
                          name="confinedPrecautions">
                        <label class="form-check-label" for="precLoto">LOTO performed on circuits</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Gas monitoring" id="precGasMonitoring"
                          name="confinedPrecautions">
                        <label class="form-check-label" for="precGasMonitoring">Continuous gas monitoring</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Trench shoring" id="precTrenchShoring"
                          name="confinedPrecautions">
                        <label class="form-check-label" for="precTrenchShoring">Trench boxes/shoring installed</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Rescue equipment"
                          id="precRescueEquipment" name="confinedPrecautions">
                        <label class="form-check-label" for="precRescueEquipment">Rescue equipment available</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Communication procedures"
                          id="precCommunication" name="confinedPrecautions">
                        <label class="form-check-label" for="precCommunication">Communication procedures</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Atmospheric testing"
                          id="precAtmosphericTest" name="confinedPrecautions">
                        <label class="form-check-label" for="precAtmosphericTest">Atmospheric testing conducted</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Gas Detector" id="ppeGasDetector"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeGasDetector">Gas Detector</label>
                      </div>
                      <!-- Additional PPE from the table version -->
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Electrical Gloves" id="ppeVoltageGloves"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeVoltageGloves">Electrical Gloves</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc Flash Suit" id="ppeArcFlashSuit"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeArcFlashSuit">Arc Flash Rated Clothing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Rubber Boots" id="ppeRubberBoots"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeRubberBoots">Rubber boots</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Insulated Tools" id="ppeInsulatedTools"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeInsulatedTools">Insulated tools</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Body Harness" id="ppeBodyHarness"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeBodyHarness">Full body harness</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Chemical Gloves" id="ppeChemGloves"
                          name="confinedPPE">
                        <label class="form-check-label" for="ppeChemGloves">Chemical-resistant gloves</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Work at Height Permit Section -->
              <div id="height-sections" class="permit-section">
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Work at Height
                </h5>
                <div class="form-group">
                  <p class="mb-2">Check all possible hazards from the work activity:</p>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fall from height"
                          id="hazardFallFromHeight" name="heightHazards">
                        <label class="form-check-label" for="hazardFallFromHeight">Fall from height</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Falling objects"
                          id="hazardFallingObjects" name="heightHazards">
                        <label class="form-check-label" for="hazardFallingObjects">Falling objects</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Structural collapse"
                          id="hazardStructuralCollapse" name="heightHazards">
                        <label class="form-check-label" for="hazardStructuralCollapse">Structural collapse</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Unstable platforms"
                          id="hazardUnstablePlatforms" name="heightHazards">
                        <label class="form-check-label" for="hazardUnstablePlatforms">Unstable
                          platforms/ladders/scaffolding</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Weather conditions"
                          id="hazardWeatherConditions" name="heightHazards">
                        <label class="form-check-label" for="hazardWeatherConditions">Adverse weather conditions (wind,
                          rain)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Overhead hazards"
                          id="hazardOverheadHazards" name="heightHazards">
                        <label class="form-check-label" for="hazardOverheadHazards">Overhead hazards (power lines,
                          structures)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Manual handling"
                          id="hazardManualHandling" name="heightHazards">
                        <label class="form-check-label" for="hazardManualHandling">Manual handling of heavy
                          materials</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Slips/trips" id="hazardSlipsTrips"
                          name="heightHazards">
                        <label class="form-check-label" for="hazardSlipsTrips">Slips, trips on same level</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Equipment failure"
                          id="hazardEquipmentFailure" name="heightHazards">
                        <label class="form-check-label" for="hazardEquipmentFailure">Equipment failure (harnesses,
                          lanyards)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="hazardHeightOthers"
                          name="heightHazards">
                        <label class="form-check-label" for="hazardHeightOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="hazardHeightOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> Work at Height Precautions</h5>
                <div class="form-group">
                  <p class="mb-2">Select all precautions / mitigation measures available at site:</p>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Fall protection" id="precFallProtection"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precFallProtection">Fall protection systems in place
                          (harnesses, guardrails)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Tool tethering" id="precToolTethering"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precToolTethering">Tool tethering systems
                          implemented</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Weather monitoring"
                          id="precWeatherMonitoring" name="heightPrecautions">
                        <label class="form-check-label" for="precWeatherMonitoring">Weather monitoring and work
                          suspension protocol</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Exclusion zones" id="precExclusionZones"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precExclusionZones">Exclusion zones established below work
                          areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Equipment inspection"
                          id="precEquipmentInspection" name="heightPrecautions">
                        <label class="form-check-label" for="precEquipmentInspection">Pre-use inspection of all
                          equipment</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Training" id="precTraining"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precTraining">Workers trained in fall protection</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Rescue plan" id="precRescuePlan"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precRescuePlan">Rescue plan in place</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Three-point contact"
                          id="precThreePointContact" name="heightPrecautions">
                        <label class="form-check-label" for="precThreePointContact">Three-point contact maintained on
                          ladders</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Mechanical aids" id="precMechanicalAids"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precMechanicalAids">Mechanical aids for lifting</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="precHeightOthers"
                          name="heightPrecautions">
                        <label class="form-check-label" for="precHeightOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="precHeightOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <p class="mb-2">Check all PPE required for the work permit:</p>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Full body harness"
                          id="ppeFullBodyHarness" name="heightPPE">
                        <label class="form-check-label" for="ppeFullBodyHarness">Full body harness with shock-absorbing
                          lanyard</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hard hat" id="ppeHardHat"
                          name="heightPPE">
                        <label class="form-check-label" for="ppeHardHat">Hard hat (ANSI/ISEA compliant)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety glasses" id="ppeSafetyGlasses"
                          name="heightPPE">
                        <label class="form-check-label" for="ppeSafetyGlasses">Safety glasses with side shields</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="High-visibility vest"
                          id="ppeHighVisibility" name="heightPPE">
                        <label class="form-check-label" for="ppeHighVisibility">High-visibility vest</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Gloves" id="ppeGloves" name="heightPPE">
                        <label class="form-check-label" for="ppeGloves">Work gloves (cut-resistant if needed)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety boots" id="ppeSafetyBoots"
                          name="heightPPE">
                        <label class="form-check-label" for="ppeSafetyBoots">Safety boots with slip-resistant
                          soles</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Tool lanyards" id="ppeToolLanyards"
                          name="heightPPE">
                        <label class="form-check-label" for="ppeToolLanyards">Tool lanyards/tethers</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Others" id="ppeHeightOthers"
                          name="heightPPE">
                        <label class="form-check-label" for="ppeHeightOthers">Others</label>
                        <input type="text" class="form-control mt-1" id="ppeHeightOthersSpecify"
                          placeholder="Please specify">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- LOTO Certificate Section -->
              <div id="loto-sections" class="permit-section">
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to LOTO</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Unexpected Startup"
                          id="hazardUnexpectedStartup" name="lotoHazards">
                        <label class="form-check-label" for="hazardUnexpectedStartup">Unexpected Startup</label>
                      </div>
                      <!-- Add other LOTO hazards here -->
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> LOTO Precautions</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Lock Verification"
                          id="precLockVerification" name="lotoPrecautions">
                        <label class="form-check-label" for="precLockVerification">Lock Verification</label>
                      </div>
                      <!-- Add other LOTO precautions here -->
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Lockout Tag" id="ppeLockoutTag"
                          name="lotoPPE">
                        <label class="form-check-label" for="ppeLockoutTag">Lockout Tag</label>
                      </div>
                      <!-- Add other LOTO PPE here -->
                    </div>
                  </div>
                </div>
              </div>
              <!-- Lifting Permit Section -->
              <div id="lifting-sections" class="permit-section">
                <!-- Lifting Plan Section -->
                <!-- Lifting Equipment Section -->
                <div class="form-section">
                  <h5 class="section-title"><i class="bi bi-gear"></i> Solar Plant Lifting Equipment</h5>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="liftingEquipmentType">Type of Lifting Equipment</label>
                        <select class="form-select" id="liftingEquipmentType">
                          <option value="">Select Equipment</option>
                          <option value="mobile_crane">Mobile Crane</option>
                          <option value="tower_crane">Tower Crane</option>
                          <option value="crawler_crane">Crawler Crane</option>
                          <option value="telehandler">Telehandler</option>
                          <option value="forklift">Forklift</option>
                          <option value="chain_hoist">Chain Hoist</option>
                          <option value="gantry_crane">Gantry Crane</option>
                          <option value="other">Other (Specify)</option>
                        </select>
                        <input type="text" class="form-control mt-2" id="otherLiftingEquipment"
                          placeholder="Please specify" style="display:none;">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="equipmentModel">Equipment Model</label>
                        <input type="text" class="form-control" id="equipmentModel" placeholder="Equipment Model">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="equipmentSerialNumber">Serial Number</label>
                        <input type="text" class="form-control" id="equipmentSerialNumber" placeholder="Serial Number">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="equipmentInspectionDate">Last Inspection Date</label>
                        <input type="date" class="form-control" id="equipmentInspectionDate">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="equipmentCertExpiry">Certification Expiry</label>
                        <input type="date" class="form-control" id="equipmentCertExpiry">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Equipment to be Lifted Section -->
                <div class="form-section">
                  <h5 class="section-title"><i class="bi bi-box-seam"></i> Solar Plant Equipment to be Lifted</h5>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="equipmentToBeLifted">Equipment Being Lifted</label>
                        <select class="form-select" id="equipmentToBeLifted">
                          <option value="">Select Equipment</option>
                          <option value="solar_panel">Solar Panel</option>
                          <option value="inverter">Inverter</option>
                          <option value="transformer">Transformer</option>
                          <option value="racking_system">Racking System</option>
                          <option value="battery">Battery Storage</option>
                          <option value="tracker">Solar Tracker</option>
                          <option value="other">Other (Specify)</option>
                        </select>
                        <input type="text" class="form-control mt-2" id="otherEquipmentToBeLifted"
                          placeholder="Please specify" style="display:none;">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="equipmentDimensions">Dimensions (L x W x H in meters)</label>
                        <input type="text" class="form-control" id="equipmentDimensions"
                          placeholder="Dimensions (L x W x H)">
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="form-group">
                        <label for="equipmentSpecialNotes">Special Handling Notes</label>
                        <textarea class="form-control" id="equipmentSpecialNotes" placeholder="Special Handling Notes"
                          style="height: 80px"></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Lifting Calculations Section -->
                <div class="form-section">
                  <h5 class="section-title"><i class="bi bi-calculator"></i> Lifting Calculations</h5>
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="totalLoadWeight">Total Load Weight (kg)</label>
                        <input type="number" class="form-control" id="totalLoadWeight" min="0" step="0.01">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="equipmentCapacity">Equipment Capacity (kg)</label>
                        <input type="number" class="form-control" id="equipmentCapacity" min="0" step="0.01">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="safetyFactor">Safety Factor (%)</label>
                        <input type="number" class="form-control" id="safetyFactor" min="0" step="0.01" value="25"
                          readonly>
                      </div>
                    </div>

                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="boomLength">Boom Length (m)</label>
                        <input type="number" class="form-control" id="boomLength" min="0" step="0.01">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="boomAngle">Boom Angle (degrees)</label>
                        <input type="number" class="form-control" id="boomAngle" min="0" max="90" step="0.1">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="form-group">
                        <label for="loadRadius">Load Radius (m)</label>
                        <input type="number" class="form-control" id="loadRadius" min="0" step="0.01">
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="calculatedCapacity">Calculated Capacity (kg)</label>
                        <input type="number" class="form-control" id="calculatedCapacity" readonly>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="requiredCapacity">Required Capacity (kg)</label>
                        <input type="number" class="form-control" id="requiredCapacity" readonly>
                      </div>
                    </div>
                  </div>

                  <div class="alert alert-info mt-3">
                    <strong><i class="bi bi-info-circle"></i> Note:</strong> The calculated capacity from load chart
                    must be greater than the total load weight including safety factor.
                  </div>

                  <!-- Visual Safety Indicator -->
                  <div class="safety-indicator mt-3">
                    <div class="d-flex justify-content-between mb-2">
                      <span>Safety Status:</span>
                      <span id="safetyStatusText" class="fw-bold">Enter values to calculate</span>
                    </div>
                    <div class="progress" style="height: 25px;">
                      <div id="safetyProgressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                        role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                      <small>0%</small>
                      <small>100%</small>
                    </div>
                    <div id="safetyMessage" class="mt-2 text-center fw-bold"></div>
                  </div>
                </div>
                <div class="permit-info-box">
                  <div class="info-title"><i class="bi bi-clipboard-check"></i> Lifting Plan Checklist</div>
                  <div class="alert alert-info">
                    <strong><i class="bi bi-info-circle"></i> Note:</strong> This lifting plan shall be filled and
                    attached by Maintenance for all the lifting activities.
                  </div>
                  <div class="table-responsive">
                    <table class="table table-bordered" id="liftingPlanTable">
                      <thead class="table-light">
                        <tr>
                          <th width="45%">Lifting Plan Item</th>
                          <th width="15%">Response</th>
                          <th width="40%">Remarks</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>Has a competent Lifting Team been identified? (Certifications and/or training records)
                          </td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse1">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks1"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Is the exact weight of the load (including rigging and all components) specified?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse2">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td>
                            <div class="row g-2">
                              <div class="col-md-6">
                                <input type="number" class="form-control form-control-sm" name="loadWeight"
                                  placeholder="Load weight (kg)" step="0.01">
                              </div>
                              <div class="col-md-6">
                                <input type="number" class="form-control form-control-sm" name="riggingWeight"
                                  placeholder="Rigging weight (kg)" step="0.01">
                              </div>
                            </div>
                          </td>
                        </tr>
                        <tr>
                          <td>Has the center of gravity been determined and clearly marked on the load?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse3">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks3"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Have all lifting points been inspected and confirmed as adequate for the lift?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse4">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks4"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Have all lifting accessories been inspected and certified?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse5">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks5"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Has the lifting equipment been inspected and certified?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse6">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks6"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Is the lifting equipment capacity adequate for the load including all rigging?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse7">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks7"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Has the ground condition been assessed for stability and bearing capacity?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse8">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks8"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Has the travel path been surveyed for obstructions and hazards?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse9">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks9"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Have weather conditions been considered (wind speed, rain, etc.)?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse10">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks10"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Have exclusion zones been established and communicated?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse11">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks11"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Have emergency procedures been established and communicated?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse12">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks12"
                              placeholder="Remarks"></td>
                        </tr>
                        <tr>
                          <td>Have all personnel involved been briefed on the lifting plan?</td>
                          <td>
                            <select class="form-select form-select-sm response-select" name="liftingPlanResponse13">
                              <option value="">Select</option>
                              <option value="yes">Yes</option>
                              <option value="no">No</option>
                              <option value="na">NA</option>
                            </select>
                          </td>
                          <td><input type="text" class="form-control form-control-sm" name="liftingPlanRemarks13"
                              placeholder="Remarks"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Lifting</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Falling objects from height"
                          id="hazardFallingObjects" name="liftingHazards">
                        <label class="form-check-label" for="hazardFallingObjects">Falling objects from height</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Crane or boom truck overturning"
                          id="hazardCraneOverturn" name="liftingHazards">
                        <label class="form-check-label" for="hazardCraneOverturn">Crane or boom truck
                          overturning</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Overhead power line contact"
                          id="hazardPowerLineContact" name="liftingHazards">
                        <label class="form-check-label" for="hazardPowerLineContact">Overhead power line contact</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Improper rigging and slinging"
                          id="hazardImproperRigging" name="liftingHazards">
                        <label class="form-check-label" for="hazardImproperRigging">Improper rigging and
                          slinging</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Load instability during lifting"
                          id="hazardLoadInstability" name="liftingHazards">
                        <label class="form-check-label" for="hazardLoadInstability">Load instability during
                          lifting</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Exceeding crane capacity limits"
                          id="hazardOvercapacity" name="liftingHazards">
                        <label class="form-check-label" for="hazardOvercapacity">Exceeding crane capacity limits</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Swinging loads hitting workers"
                          id="hazardSwingingLoads" name="liftingHazards">
                        <label class="form-check-label" for="hazardSwingingLoads">Swinging loads hitting workers</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Pinch points during equipment movement"
                          id="hazardPinchPoints" name="liftingHazards">
                        <label class="form-check-label" for="hazardPinchPoints">Pinch points during equipment
                          movement</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dropped loads during transfer"
                          id="hazardDroppedLoads" name="liftingHazards">
                        <label class="form-check-label" for="hazardDroppedLoads">Dropped loads during transfer</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Manual handling injuries"
                          id="hazardManualHandling" name="liftingHazards">
                        <label class="form-check-label" for="hazardManualHandling">Manual handling injuries</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Inadequate ground support/foundation"
                          id="hazardGroundSupport" name="liftingHazards">
                        <label class="form-check-label" for="hazardGroundSupport">Inadequate ground
                          support/foundation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Uncontrolled movement of heavy equipment"
                          id="hazardUncontrolledMovement" name="liftingHazards">
                        <label class="form-check-label" for="hazardUncontrolledMovement">Uncontrolled movement of heavy
                          equipment</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Failure of lifting accessories"
                          id="hazardAccessoryFailure" name="liftingHazards">
                        <label class="form-check-label" for="hazardAccessoryFailure">Failure of lifting
                          accessories</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Inadequate visibility for operator"
                          id="hazardPoorVisibility" name="liftingHazards">
                        <label class="form-check-label" for="hazardPoorVisibility">Inadequate visibility for
                          operator</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Electrical hazards during equipment lifting" id="hazardElectrical"
                          name="liftingHazards">
                        <label class="form-check-label" for="hazardElectrical">Electrical hazards during equipment
                          lifting</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Sudden release of stored energy"
                          id="hazardStoredEnergy" name="liftingHazards">
                        <label class="form-check-label" for="hazardStoredEnergy">Sudden release of stored energy</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Crushing between load and fixed objects"
                          id="hazardCrushing" name="liftingHazards">
                        <label class="form-check-label" for="hazardCrushing">Crushing between load and fixed
                          objects</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Inadequate lifting plan for oversized loads" id="hazardNoLiftingPlan"
                          name="liftingHazards">
                        <label class="form-check-label" for="hazardNoLiftingPlan">Inadequate lifting plan for oversized
                          loads</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Wind effects on lifted loads"
                          id="hazardWindEffects" name="liftingHazards">
                        <label class="form-check-label" for="hazardWindEffects">Wind effects on lifted loads</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Inadequate communication during lifts"
                          id="hazardPoorCommunication" name="liftingHazards">
                        <label class="form-check-label" for="hazardPoorCommunication">Inadequate communication during
                          lifts</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> Lifting Precautions</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Conduct pre-lift meeting and toolbox talk" id="precLiftMeeting"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precLiftMeeting">Conduct pre-lift meeting and toolbox
                          talk</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Inspect all lifting equipment before use"
                          id="precEquipmentInspection" name="liftingPrecautions">
                        <label class="form-check-label" for="precEquipmentInspection">Inspect all lifting equipment
                          before use</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Establish and maintain exclusion zones"
                          id="precExclusionZones" name="liftingPrecautions">
                        <label class="form-check-label" for="precExclusionZones">Establish and maintain exclusion
                          zones</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use certified riggers for all lifts"
                          id="precCertifiedRiggers" name="liftingPrecautions">
                        <label class="form-check-label" for="precCertifiedRiggers">Use certified riggers for all
                          lifts</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Verify load weight and center of gravity"
                          id="precLoadVerification" name="liftingPrecautions">
                        <label class="form-check-label" for="precLoadVerification">Verify load weight and center of
                          gravity</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use tag lines to control load movement"
                          id="precTagLines" name="liftingPrecautions">
                        <label class="form-check-label" for="precTagLines">Use tag lines to control load
                          movement</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Maintain safe distance from power lines"
                          id="precPowerLineDistance" name="liftingPrecautions">
                        <label class="form-check-label" for="precPowerLineDistance">Maintain safe distance from power
                          lines</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Ensure proper ground conditions and support" id="precGroundSupport"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precGroundSupport">Ensure proper ground conditions and
                          support</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use spotters for blind lift areas"
                          id="precSpotters" name="liftingPrecautions">
                        <label class="form-check-label" for="precSpotters">Use spotters for blind lift areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Follow manufacturer's load charts"
                          id="precLoadCharts" name="liftingPrecautions">
                        <label class="form-check-label" for="precLoadCharts">Follow manufacturer's load charts</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement communication protocol (radio/hand signals)" id="precCommunicationProtocol"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precCommunicationProtocol">Implement communication protocol
                          (radio/hand signals)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Check weather conditions before lifting"
                          id="precWeatherCheck" name="liftingPrecautions">
                        <label class="form-check-label" for="precWeatherCheck">Check weather conditions before
                          lifting</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Secure all loose materials before lifting" id="precSecureMaterials"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precSecureMaterials">Secure all loose materials before
                          lifting</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use proper lifting points on equipment"
                          id="precLiftingPoints" name="liftingPrecautions">
                        <label class="form-check-label" for="precLiftingPoints">Use proper lifting points on
                          equipment</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Barricade and mark swing radius areas"
                          id="precBarricadeSwing" name="liftingPrecautions">
                        <label class="form-check-label" for="precBarricadeSwing">Barricade and mark swing radius
                          areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="De-energize nearby electrical equipment when possible" id="precDeenergize"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precDeenergize">De-energize nearby electrical equipment
                          when possible</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use appropriate rigging for delicate equipment" id="precDelicateRigging"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precDelicateRigging">Use appropriate rigging for delicate
                          equipment</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Conduct trial lift to verify balance"
                          id="precTrialLift" name="liftingPrecautions">
                        <label class="form-check-label" for="precTrialLift">Conduct trial lift to verify balance</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Ensure multiple lifts are properly coordinated" id="precCoordinatedLifts"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precCoordinatedLifts">Ensure multiple lifts are properly
                          coordinated</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Have emergency response plan for lifting incidents" id="precEmergencyPlan"
                          name="liftingPrecautions">
                        <label class="form-check-label" for="precEmergencyPlan">Have emergency response plan for lifting
                          incidents</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hard hat (ANSI Z89.1 compliant)"
                          id="ppeHardHat" name="liftingPPE">
                        <label class="form-check-label" for="ppeHardHat">Hard hat (ANSI Z89.1 compliant)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety glasses with side shields"
                          id="ppeSafetyGlasses" name="liftingPPE">
                        <label class="form-check-label" for="ppeSafetyGlasses">Safety glasses with side shields</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="High-visibility vest/coverall"
                          id="ppeHiVisVest" name="liftingPPE">
                        <label class="form-check-label" for="ppeHiVisVest">High-visibility vest/coverall</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Steel-toe safety boots"
                          id="ppeSteelToeBoots" name="liftingPPE">
                        <label class="form-check-label" for="ppeSteelToeBoots">Steel-toe safety boots</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Leather gloves for rigging"
                          id="ppeLeatherGloves" name="liftingPPE">
                        <label class="form-check-label" for="ppeLeatherGloves">Leather gloves for rigging</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hearing protection in high-noise areas"
                          id="ppeHearingProtection" name="liftingPPE">
                        <label class="form-check-label" for="ppeHearingProtection">Hearing protection in high-noise
                          areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Fall protection harness when working at height" id="ppeFallHarness" name="liftingPPE">
                        <label class="form-check-label" for="ppeFallHarness">Fall protection harness when working at
                          height</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Cut-resistant gloves for cable handling"
                          id="ppeCutGloves" name="liftingPPE">
                        <label class="form-check-label" for="ppeCutGloves">Cut-resistant gloves for cable
                          handling</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Face shield for overhead work"
                          id="ppeFaceShield" name="liftingPPE">
                        <label class="form-check-label" for="ppeFaceShield">Face shield for overhead work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Chemical-resistant gloves for oil handling" id="ppeChemicalGloves" name="liftingPPE">
                        <label class="form-check-label" for="ppeChemicalGloves">Chemical-resistant gloves for oil
                          handling</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Respirator for dusty conditions"
                          id="ppeRespirator" name="liftingPPE">
                        <label class="form-check-label" for="ppeRespirator">Respirator for dusty conditions</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Protective coveralls for transformer work" id="ppeCoveralls" name="liftingPPE">
                        <label class="form-check-label" for="ppeCoveralls">Protective coveralls for transformer
                          work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Voltage-rated gloves for electrical equipment" id="ppeVoltageGloves" name="liftingPPE">
                        <label class="form-check-label" for="ppeVoltageGloves">Voltage-rated gloves for electrical
                          equipment</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Safety toe rubber boots for wet areas"
                          id="ppeRubberBoots" name="liftingPPE">
                        <label class="form-check-label" for="ppeRubberBoots">Safety toe rubber boots for wet
                          areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Anti-vibration gloves for power tools"
                          id="ppeAntiVibrationGloves" name="liftingPPE">
                        <label class="form-check-label" for="ppeAntiVibrationGloves">Anti-vibration gloves for power
                          tools</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Full body harness for boom truck work"
                          id="ppeFullBodyHarness" name="liftingPPE">
                        <label class="form-check-label" for="ppeFullBodyHarness">Full body harness for boom truck
                          work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc flash protection for electrical work"
                          id="ppeArcFlash" name="liftingPPE">
                        <label class="form-check-label" for="ppeArcFlash">Arc flash protection for electrical
                          work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Knee pads for ground work"
                          id="ppeKneePads" name="liftingPPE">
                        <label class="form-check-label" for="ppeKneePads">Knee pads for ground work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Cooling vest for hot weather"
                          id="ppeCoolingVest" name="liftingPPE">
                        <label class="form-check-label" for="ppeCoolingVest">Cooling vest for hot weather</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Waterproof gear for wet conditions"
                          id="ppeWaterproofGear" name="liftingPPE">
                        <label class="form-check-label" for="ppeWaterproofGear">Waterproof gear for wet
                          conditions</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Excavation Permit Section -->
              <div id="excavation-sections" class="permit-section">
                <h5 class="section-title"><i class="bi bi-exclamation-triangle"></i> Hazards Related to Excavation</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Contact with buried DC collection lines"
                          id="hazardBuriedDC" name="excavationHazards">
                        <label class="form-check-label" for="hazardBuriedDC">Contact with buried DC collection lines
                          (600V+)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Damaging underground combiner box conduits" id="hazardCombinerConduits"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardCombinerConduits">Damaging underground combiner box
                          conduits</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Trench collapse near pile-driven foundations" id="hazardPileTrench"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardPileTrench">Trench collapse near pile-driven
                          foundations</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Excavator contact with overhead PV strings" id="hazardOverheadStrings"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardOverheadStrings">Excavator contact with overhead PV
                          strings</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Striking buried grounding grid conductors" id="hazardGroundingGrid"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardGroundingGrid">Striking buried grounding grid
                          conductors</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Hitting buried inverter AC conduits"
                          id="hazardInverterConduits" name="excavationHazards">
                        <label class="form-check-label" for="hazardInverterConduits">Hitting buried inverter AC
                          conduits</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Underground thermal runaway from damaged batteries" id="hazardBatteryThermal"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardBatteryThermal">Underground thermal runaway from
                          damaged batteries</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Electrocution from unmarked PV source circuits" id="hazardSourceCircuits"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardSourceCircuits">Electrocution from unmarked PV source
                          circuits</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Collapsing trenches in tracker foundation areas" id="hazardTrackerTrench"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardTrackerTrench">Collapsing trenches in tracker
                          foundation areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Contact with buried MV collection system"
                          id="hazardMVCollection" name="excavationHazards">
                        <label class="form-check-label" for="hazardMVCollection">Contact with buried MV collection
                          system</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Workmen falling into excavation"
                          id="hazardWorkmenFall" name="excavationHazards">
                        <label class="form-check-label" for="hazardWorkmenFall">Workmen falling into excavation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Manual handling injuries"
                          id="hazardManualHandling" name="excavationHazards">
                        <label class="form-check-label" for="hazardManualHandling">Manual handling injuries</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Heat stress in deep excavations"
                          id="hazardHeatStress" name="excavationHazards">
                        <label class="form-check-label" for="hazardHeatStress">Heat stress in deep excavations</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Exposure to venomous creatures"
                          id="hazardVenomous" name="excavationHazards">
                        <label class="form-check-label" for="hazardVenomous">Exposure to venomous creatures</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Tick-borne diseases"
                          id="hazardTickDiseases" name="excavationHazards">
                        <label class="form-check-label" for="hazardTickDiseases">Tick-borne diseases</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Damage to buried weather monitoring cables" id="hazardWeatherCables"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardWeatherCables">Damage to buried weather monitoring
                          cables</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Striking existing PV field drainage systems" id="hazardDrainage"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardDrainage">Striking existing PV field drainage
                          systems</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Excavation near energized perimeter fencing" id="hazardFencing"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardFencing">Excavation near energized perimeter
                          fencing</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Contact with buried DC optimizer cables"
                          id="hazardOptimizers" name="excavationHazards">
                        <label class="form-check-label" for="hazardOptimizers">Contact with buried DC optimizer
                          cables</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Striking buried SCADA communication lines" id="hazardSCADA" name="excavationHazards">
                        <label class="form-check-label" for="hazardSCADA">Striking buried SCADA communication
                          lines</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Trenching near active transformer pads"
                          id="hazardTransformer" name="excavationHazards">
                        <label class="form-check-label" for="hazardTransformer">Trenching near active transformer
                          pads</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Damage to existing site erosion controls"
                          id="hazardErosion" name="excavationHazards">
                        <label class="form-check-label" for="hazardErosion">Damage to existing site erosion
                          controls</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Excavation in high wind near racking"
                          id="hazardWind" name="excavationHazards">
                        <label class="form-check-label" for="hazardWind">Excavation in high wind near racking</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Contact with buried rapid shutdown conductors" id="hazardRapidShutdown"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardRapidShutdown">Contact with buried rapid shutdown
                          conductors</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Striking buried PV module grounding wires" id="hazardModuleGrounding"
                          name="excavationHazards">
                        <label class="form-check-label" for="hazardModuleGrounding">Striking buried PV module grounding
                          wires</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Flash flooding in excavations"
                          id="hazardFlashFlood" name="excavationHazards">
                        <label class="form-check-label" for="hazardFlashFlood">Flash flooding in excavations</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Lightning strike risk"
                          id="hazardLightning" name="excavationHazards">
                        <label class="form-check-label" for="hazardLightning">Lightning strike risk</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Extreme temperature exposure"
                          id="hazardExtremeTemp" name="excavationHazards">
                        <label class="form-check-label" for="hazardExtremeTemp">Extreme temperature exposure</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Trench collapse emergency"
                          id="hazardTrenchCollapse" name="excavationHazards">
                        <label class="form-check-label" for="hazardTrenchCollapse">Trench collapse emergency</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Equipment rollover hazard"
                          id="hazardEquipmentRollover" name="excavationHazards">
                        <label class="form-check-label" for="hazardEquipmentRollover">Equipment rollover hazard</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield-check"></i> Excavation Precautions</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Perform PV-specific utility locate (beyond standard 811)" id="precPVLocate"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precPVLocate">Perform PV-specific utility locate (beyond
                          standard 811)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use CAT scanner with PV system voltage settings" id="precCATPV"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precCATPV">Use CAT scanner with PV system voltage
                          settings</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement lockout/tagout for nearby combiner boxes" id="precLOTOCombiners"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precLOTOCombiners">Implement lockout/tagout for nearby
                          combiner boxes</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use non-conductive trench shoring in PV fields" id="precNonConductiveShoring"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precNonConductiveShoring">Use non-conductive trench shoring
                          in PV fields</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Mark all underground DC home runs with high-vis flags" id="precDCFlags"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precDCFlags">Mark all underground DC home runs with
                          high-vis flags</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="De-energize adjacent tracker rows during excavation" id="precDeenergizeTrackers"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precDeenergizeTrackers">De-energize adjacent tracker rows
                          during excavation</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use insulated tools near buried PV conductors" id="precInsulatedTools"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precInsulatedTools">Use insulated tools near buried PV
                          conductors</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement spotter for equipment near overhead PV" id="precPVSpotter"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precPVSpotter">Implement spotter for equipment near
                          overhead PV</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Test for voltage before manual digging near arrays" id="precVoltageTest"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precVoltageTest">Test for voltage before manual digging
                          near arrays</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Maintain 10' clearance from inverter pads when digging" id="precInverterClearance"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precInverterClearance">Maintain 10' clearance from inverter
                          pads when digging</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Install temporary grounding for exposed PV conductors" id="precTempGrounding"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precTempGrounding">Install temporary grounding for exposed
                          PV conductors</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use dielectric barriers for live work near trenches" id="precDielectricBarriers"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precDielectricBarriers">Use dielectric barriers for live
                          work near trenches</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement buddy system in deep excavations" id="precBuddySystem"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precBuddySystem">Implement buddy system in deep
                          excavations</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Provide cooling stations in hot weather"
                          id="precCoolingStations" name="excavationPrecautions">
                        <label class="form-check-label" for="precCoolingStations">Provide cooling stations in hot
                          weather</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Use insect repellent in tick areas"
                          id="precInsectRepellent" name="excavationPrecautions">
                        <label class="form-check-label" for="precInsectRepellent">Use insect repellent in tick
                          areas</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement step potential precautions near MV trenches" id="precStepPotential"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precStepPotential">Implement step potential precautions
                          near MV trenches</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Mark all buried rapid shutdown conduits with UV-resistant tags"
                          id="precRapidShutdownTags" name="excavationPrecautions">
                        <label class="form-check-label" for="precRapidShutdownTags">Mark all buried rapid shutdown
                          conduits with UV-resistant tags</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use ground penetrating radar for dense PV conductor areas" id="precGPR"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precGPR">Use ground penetrating radar for dense PV
                          conductor areas</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Establish no-dig zones around substation grounding grids" id="precNoDigSubstation"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precNoDigSubstation">Establish no-dig zones around
                          substation grounding grids</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement dust control measures near operating PV arrays" id="precDustControl"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precDustControl">Implement dust control measures near
                          operating PV arrays</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use non-metallic ladders near overhead DC runs" id="precNonMetallicLadders"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precNonMetallicLadders">Use non-metallic ladders near
                          overhead DC runs</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Verify DC conductor de-energization with clamp meter" id="precClampMeter"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precClampMeter">Verify DC conductor de-energization with
                          clamp meter</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Install warning signs for buried PV cables at 25' intervals" id="precWarningSigns"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precWarningSigns">Install warning signs for buried PV
                          cables at 25' intervals</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use fiberglass shovels within 3' of marked PV cables" id="precFiberglassShovels"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precFiberglassShovels">Use fiberglass shovels within 3' of
                          marked PV cables</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Implement solar-specific confined space entry for trenches near inverters"
                          id="precSolarConfinedSpace" name="excavationPrecautions">
                        <label class="form-check-label" for="precSolarConfinedSpace">Implement confined space entry for
                          trenches near inverters</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Establish emergency shutdown procedures for adjacent arrays" id="precArrayShutdown"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precArrayShutdown">Establish emergency shutdown procedures
                          for adjacent arrays</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Use thermal imaging to identify loaded underground conductors" id="precThermalImaging"
                          name="excavationPrecautions">
                        <label class="form-check-label" for="precThermalImaging">Use thermal imaging to identify loaded
                          underground conductors</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Monitor weather for flash flood warnings"
                          id="precWeatherMonitor" name="excavationPrecautions">
                        <label class="form-check-label" for="precWeatherMonitor">Monitor weather for flash flood
                          warnings</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Establish emergency rescue plan"
                          id="precRescuePlan" name="excavationPrecautions">
                        <label class="form-check-label" for="precRescuePlan">Establish emergency rescue plan</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Conduct emergency drills monthly"
                          id="precEmergencyDrills" name="excavationPrecautions">
                        <label class="form-check-label" for="precEmergencyDrills">Conduct emergency drills
                          monthly</label>
                      </div>
                    </div>
                  </div>
                </div>

                <h5 class="section-title"><i class="bi bi-shield"></i> Personal Protective Equipment (PPE)</h5>
                <div class="form-group">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Class 00 rubber gloves with leather protectors (1000V)" id="ppeClass00Gloves"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeClass00Gloves">Class 00 rubber gloves with leather
                          protectors (1000V)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Arc-rated clothing (8 cal/cm²)"
                          id="ppeArcClothing" name="excavationPPE">
                        <label class="form-check-label" for="ppeArcClothing">Arc-rated clothing (8 cal/cm²)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Voltage-rated face shield with UV protection" id="ppeVoltageFaceShield"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeVoltageFaceShield">Voltage-rated face shield with UV
                          protection</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Dielectric boots (ASTM F2413-18)"
                          id="ppeDielectricBoots" name="excavationPPE">
                        <label class="form-check-label" for="ppeDielectricBoots">Dielectric boots (ASTM
                          F2413-18)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="High-visibility apparel with arc rating"
                          id="ppeArcVis" name="excavationPPE">
                        <label class="form-check-label" for="ppeArcVis">High-visibility apparel with arc rating</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Insulated hand tools (1000V rating)"
                          id="ppeInsulatedTools" name="excavationPPE">
                        <label class="form-check-label" for="ppeInsulatedTools">Insulated hand tools (1000V
                          rating)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Hearing protection for inverter proximity work" id="ppeHearingProtection"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeHearingProtection">Hearing protection for inverter
                          proximity work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Anti-reflective safety glasses"
                          id="ppeAntiReflectiveGlasses" name="excavationPPE">
                        <label class="form-check-label" for="ppeAntiReflectiveGlasses">Anti-reflective safety
                          glasses</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Voltage-detecting gloves for verification" id="ppeVoltageDetectGloves"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeVoltageDetectGloves">Voltage-detecting gloves for
                          verification</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Fall protection for trench work near racking" id="ppeFallProtection"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeFallProtection">Fall protection for trench work near
                          racking</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Cut-resistant sleeves for cable handling"
                          id="ppeCutResistant" name="excavationPPE">
                        <label class="form-check-label" for="ppeCutResistant">Cut-resistant sleeves for cable
                          handling</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Cooling vest for high-temperature field work" id="ppeCoolingVest" name="excavationPPE">
                        <label class="form-check-label" for="ppeCoolingVest">Cooling vest for high-temperature field
                          work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Waterproof gear for wet conditions"
                          id="ppeWaterproofGear" name="excavationPPE">
                        <label class="form-check-label" for="ppeWaterproofGear">Waterproof gear for wet
                          conditions</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Respirator for dusty trench work"
                          id="ppeRespirator" name="excavationPPE">
                        <label class="form-check-label" for="ppeRespirator">Respirator for dusty trench work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Voltage-rated knee pads" id="ppeKneePads"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeKneePads">Voltage-rated knee pads</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Non-conductive hard hat (Class E)"
                          id="ppeNonConductiveHardHat" name="excavationPPE">
                        <label class="form-check-label" for="ppeNonConductiveHardHat">Non-conductive hard hat (Class
                          E)</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Insulated matting for work near live equipment" id="ppeInsulatedMatting"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeInsulatedMatting">Insulated matting for work near live
                          equipment</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Glare-reducing face shield"
                          id="ppeGlareShield" name="excavationPPE">
                        <label class="form-check-label" for="ppeGlareShield">Glare-reducing face shield</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Voltage-rated tool lanyards"
                          id="ppeToolLanyards" name="excavationPPE">
                        <label class="form-check-label" for="ppeToolLanyards">Voltage-rated tool lanyards</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Chemical-resistant gloves for battery area work" id="ppeChemicalGloves"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeChemicalGloves">Chemical-resistant gloves for battery
                          area work</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Wire mesh gloves for cable pulling"
                          id="ppeWireMeshGloves" name="excavationPPE">
                        <label class="form-check-label" for="ppeWireMeshGloves">Wire mesh gloves for cable
                          pulling</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                          value="Electrostatic discharge (ESD) wrist strap" id="ppeESDWrist" name="excavationPPE">
                        <label class="form-check-label" for="ppeESDWrist">Electrostatic discharge (ESD) wrist
                          strap</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="UV-protective neck flap" id="ppeUVNeck"
                          name="excavationPPE">
                        <label class="form-check-label" for="ppeUVNeck">UV-protective neck flap</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Non-slip, dielectric overshoes"
                          id="ppeDielectricOvershoes" name="excavationPPE">
                        <label class="form-check-label" for="ppeDielectricOvershoes">Non-slip, dielectric
                          overshoes</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Emergency DC arc flash hood"
                          id="ppeArcFlashHood" name="excavationPPE">
                        <label class="form-check-label" for="ppeArcFlashHood">Emergency DC arc flash hood</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="Emergency whistle for trench workers"
                          id="ppeEmergencyWhistle" name="excavationPPE">
                        <label class="form-check-label" for="ppeEmergencyWhistle">Emergency whistle for trench
                          workers</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Common Permit Request Section -->
              <h5 class="section-title"><i class="bi bi-paperclip"></i> Attached Documents / Associated PTW</h5>
              <div class="form-group">
                <p class="mb-2">Select Attached Documents and Associated PTW (Check all that apply ...):</p>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Drawings / Layouts" id="docDrawingsLayouts"
                        name="documents">
                      <label class="form-check-label" for="docDrawingsLayouts">Drawings / Layouts</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Associated Work Permit Numbers"
                        id="docWorkPermitNumbers" name="documents">
                      <label class="form-check-label" for="docWorkPermitNumbers">Associated Work Permit Numbers</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Isolation Confirmation Certificate"
                        id="docIsolationCertificate" name="documents">
                      <label class="form-check-label" for="docIsolationCertificate">Isolation Confirmation
                        Certificate</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Emergency Response Plan"
                        id="docEmergencyResponsePlan" name="documents">
                      <label class="form-check-label" for="docEmergencyResponsePlan">Emergency Response Plan</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox"
                        value="Approved Risk Assessment / Method Statement" id="docApprovedRAMS" name="documents">
                      <label class="form-check-label" for="docApprovedRAMS">Approved Risk Assessment / Method
                        Statement</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Personnel Qualification Certificates"
                        id="docPersonnelCertificates" name="documents">
                      <label class="form-check-label" for="docPersonnelCertificates">Personnel Qualification
                        Certificates</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Authorized Personnel List"
                        id="docAuthorizedPersonnel" name="documents">
                      <label class="form-check-label" for="docAuthorizedPersonnel">Authorized Personnel List</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="Others" id="docOthers" name="documents">
                      <label class="form-check-label" for="docOthers">Others</label>
                      <input type="text" class="form-control mt-1" id="docOthersSpecify" placeholder="Please specify">
                    </div>
                  </div>
                </div>
              </div>

              <h5 class="section-title"><i class="bi bi-moon"></i> Night Work Checklist</h5>
              <div class="form-group">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Is sufficient emergency power backup available"
                    id="nightWorkEmergencyBackup" name="nightWork">
                  <label class="form-check-label" for="nightWorkEmergencyBackup">Is sufficient emergency power backup
                    available</label>
                </div>
                <textarea class="form-control mt-2" rows="2" id="nightWorkOtherChecks"
                  placeholder="Add any other night work specific checks"></textarea>
              </div>
              <!-- Add this section before the "Permit Request & Issuance" section -->
              <h5 class="section-title"><i class="bi bi-people"></i> Crew Members</h5>
              <div class="card mb-3">
                <div class="card-body">
                  <div class="table-responsive">
                    <table class="table table-bordered" id="crewMembersTable">
                      <thead class="table-light">
                        <tr>
                          <th>Sr No.</th>
                          <th>Name</th>
                          <th>Iqama Number</th>
                          <th>Designation</th>
                          <th>Company</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Crew members will be added here dynamically -->
                      </tbody>
                    </table>
                  </div>
                  <button type="button" class="btn btn-sm btn-primary mt-2" id="addCrewMember">
                    <i class="bi bi-plus-circle"></i> Add Crew Member
                  </button>
                </div>
              </div>
              <h5 class="section-title"><i class="bi bi-file-earmark-check"></i> Permit Request & Issuance</h5>
              <div class="card mb-3">
                <div class="card-header bg-success text-white">
                  Permit Requestor Declaration:
                  I confirm the worksite is assessed, hazards identified, isolation ensured, competent personnel
                  assigned, all tools, PPE, and precautions taken.
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-group mb-3">
                        <label>Authorized Receiver, Name:</label>
                        <select class="form-select" id="requestorName">
                          <option value="">-- Select Receiver --</option>
                          <option value="Sridhar">Sridhar</option>
                          <option value="Umashankar">Umashankar</option>
                          <option value="Mohammad">Mohammad</option>
                          <option value="D krishann">D krishann</option>
                          <option value="Abdullah Alhamdi">Abdullah Alhamdi</option>
                          <option value="Saad Al Anazi">Saad Al Anazi</option>
                          <option value="Rakan Al Shekhi">Rakan Al Shekhi</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="form-group mb-3">
                        <div class="signature-label">
                          <label>Signature</label>
                          <button type="button" class="btn btn-sm btn-outline-secondary"
                            onclick="clearSignature('requestorSignature')">Clear</button>
                        </div>
                        <div class="signature-pad">
                          <canvas id="requestorSignature" width="200" height="80"></canvas>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group mb-3">
                        <label>Date</label>
                        <input type="date" class="form-control" id="requestorDate" readonly>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group mb-3">
                        <label>Time</label>
                        <input type="time" class="form-control" id="requestorTime" readonly>
                      </div>
                    </div>
                  </div>

                  <!-- Requester Actions -->
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group mb-3">
                        <label>Select Permit Issuer:</label>
                        <select class="form-select" id="permitIssuerSelect">
                          <option value="">-- Select Issuer --</option>
                          <option value="Noman Ashraf">Noman Ashraf</option>
                          <option value="Rachid">Rachid</option>
                          <option value="Jayiz">Jayiz</option>
                          <option value="Thiru">Thiru</option>
                          <option value="Raguraman">Raguraman</option>
                          <option value="Anderigiri">Anderigiri</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="d-flex gap-2 mt-4">
                        <button type="button" class="btn btn-success flex-grow-1" id="submitPermitRequest">
                          <i class="bi bi-send"></i> Submit Permit
                        </button>
                        <button type="button" class="btn btn-secondary flex-grow-1" id="saveDraft">
                          <i class="bi bi-save"></i> Save as Draft
                        </button>
                        <button type="button" class="btn btn-danger flex-grow-1" id="cancelPermit">
                          <i class="bi bi-x-circle"></i> Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Issuer Mode Content -->
      <div class="tab-pane fade" id="issuer-content" role="tabpanel">
        <div class="card mb-4">
          <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Permit Applications</h5>
              <button type="button" class="btn btn-info position-relative" id="viewNotifications">
                <i class="bi bi-bell"></i> Notifications
                <span class="notification-badge d-none" id="activeNotificationBadge">0</span>
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="submittedPermitsList">
              <!-- Submitted permits will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Permit Form (hidden by default) -->
        <div class="card permit-card d-none" id="issuerPermitFormCard">
          <div class="card-body">
            <form id="issuerPermitForm">
              <div class="form-header">
                <h4><i class="bi bi-file-earmark-text"></i> Permit to Work</h4>
                <div class="status-badge submitted" id="issuerPermitStatus">SUBMITTED</div>
              </div>

              <!-- Permit Status Display -->
              <div id="issuerFinalStatusDisplay" class="final-status d-none"></div>

              <div class="row">
                <!-- Permit Type Display -->
                <div class="form-group mb-3">
                  <label>Permit Type</label>
                  <input type="text" class="form-control" id="issuerPermitType" readonly>
                </div>
                <div class="col-md-6">
                  <div class="form-group mb-3">
                    <label for="issuerPermitNumber">Permit Number</label>
                    <input type="text" class="form-control" id="issuerPermitNumber" placeholder="O&M-PTW-0000" readonly>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group mb-3">
                    <label>Date Issued</label>
                    <input type="date" class="form-control" id="issuerDateIssued" readonly>
                  </div>
                </div>
              </div>

              <div class="form-group mb-3">
                <label>Plant Name</label>
                <input type="text" class="form-control" value="South Jeddah Noor 300 MWAC PV Solar Project" readonly>
              </div>

              <h5 class="section-title"><i class="bi bi-calendar-check"></i> Work Execution Plan</h5>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Valid From (Date/Time)</label>
                    <input type="datetime-local" class="form-control" id="issuerValidFrom" readonly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Valid To (Date/Time)</label>
                    <input type="datetime-local" class="form-control" id="issuerValidTo" readonly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Location of Work</label>
                    <input type="text" class="form-control" id="issuerLocationOfWork" readonly>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Equipment Functional Name</label>
                    <input type="text" class="form-control" id="issuerFunctionalName" readonly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Equipment Identification Number</label>
                    <input type="text" class="form-control" id="issuerEquipmentNo" readonly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Tools and Equipment</label>
                    <input type="text" class="form-control" id="issuerEquipmentType" readonly>
                  </div>
                </div>
              </div>


              <!-- Permit Details Section -->
              <div class="permit-info-box">
                <div class="info-title">Permit Requestor Details</div>
                <div class="info-content">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group mb-3">
                        <label>Requestor Name</label>
                        <input type="text" class="form-control" id="issuerRequestorName" readonly>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group mb-3">
                        <label>Request Date</label>
                        <input type="date" class="form-control" id="issuerRequestorDate" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group mb-3">
                        <label>Request Time</label>
                        <input type="time" class="form-control" id="issuerRequestorTime" readonly>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group mb-3">
                        <div class="info-title">Requestor Signature</div>
                        <div class="signature-pad">
                          <canvas id="issuerRequestorSignature" width="200" height="80"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Permit Type Specific Sections -->
              <div id="issuer-general-sections" class="permit-section">
                <!-- General permit content for issuer view -->
                <div class="permit-info-box">
                  <div class="info-title">Identified Hazards</div>
                  <div class="info-content" id="issuerHazards">
                    <!-- Will be filled dynamically -->
                  </div>
                </div>

                <div class="permit-info-box">
                  <div class="info-title">Precautions Taken</div>
                  <div class="info-content" id="issuerPrecautions">
                    <!-- Will be filled dynamically -->
                  </div>
                </div>

                <div class="permit-info-box">
                  <div class="info-title">Required PPE</div>
                  <div class="info-content" id="issuerPPE">
                    <!-- Will be filled dynamically -->
                  </div>
                </div>
              </div>

              <div id="issuer-hot-work-sections" class="permit-section">
                <!-- Hot work content for issuer view -->
              </div>

              <!-- Common Issuer Section -->
              <!-- Add this after the permit type specific sections -->
              <div class="permit-info-box">
                <div class="info-title">Crew Members</div>
                <div class="info-content">
                  <table class="table table-bordered" id="issuerCrewMembersTable">
                    <thead class="table-light">
                      <tr>
                        <th>Sr No.</th>
                        <th>Name</th>
                        <th>Iqama Number</th>
                        <th>Designation</th>
                        <th>Company</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Crew members will be added here dynamically -->
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="card mb-3">
                <div class="card-header bg-primary text-white">
                  PERMIT ISSUANCE (Permit Issuer / Appointed Person) : I declare that Equipment/System is SECURED. I
                  hereby approve this task.
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="form-group mb-3">
                        <label>Authorized Issuer/Appointed Person, Name:</label>
                        <input type="text" class="form-control" id="issuerIssuerName" readonly>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="form-group mb-3">
                        <div class="signature-label">
                          <label>Signature</label>
                          <button type="button" class="btn btn-sm btn-outline-secondary"
                            onclick="clearSignature('issuerIssuerSignature')">Clear</button>
                        </div>
                        <div class="signature-pad">
                          <canvas id="issuerIssuerSignature" width="200" height="80"></canvas>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group mb-3">
                        <label>Date</label>
                        <input type="date" class="form-control" id="issuerIssuerDate" readonly>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group mb-3">
                        <label>Time</label>
                        <input type="time" class="form-control" id="issuerIssuerTime" readonly>
                      </div>
                    </div>
                  </div>

                  <!-- Issuer Actions -->
                  <div class="d-flex gap-2">
                    <button type="button" class="btn btn-warning flex-grow-1" id="issuerEditPermit">
                      <i class="bi bi-pencil"></i> Edit Permit
                    </button>
                    <button type="button" class="btn btn-success flex-grow-1 d-none" id="issuerApprovePermit">
                      <i class="bi bi-check-circle"></i> Approve
                    </button>
                    <button type="button" class="btn btn-danger flex-grow-1 d-none" id="issuerRejectPermit">
                      <i class="bi bi-x-circle"></i> Reject
                    </button>
                    <button type="button" class="btn btn-secondary flex-grow-1" id="issuerCancelPermit">
                      <i class="bi bi-arrow-left"></i> Back
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Indicator for PDF Generation -->
  <div id="pdf-loading-indicator">
    <div class="spinner-border text-light" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Generating PDF...</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
  <script>
    // Constants
    const ISSUER_PASSWORD = "5678";
    const REQUESTER_PASSWORD = "1234";
    const PERMIT_TYPES = {
      'general': 'General Work Permit',
      'hot-work': 'Hot Work Permit',
      'electrical': 'Electrical Work Permit',
      'confined': 'Confined Space Permit',
      'height': 'Work at Height Permit',
      'loto': 'LOTO Certificate',
      'lifting': 'Lifting Permit',
      'excavation': 'Excavation Permit'
    };

    // Global variables
    let currentMode = 'no-select'; // 'issuer', 'requester', or 'no-select'
    let signaturePads = {};
    let currentPermitId = null;
    let nextPermitNumber = 1;

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function () {
      // Initialize signature pads
      initializeSignaturePads();

      // Initialize modals
      const passwordModal = new bootstrap.Modal(document.getElementById('passwordModal'));
      const notificationsModal = new bootstrap.Modal(document.getElementById('notificationsModal'));

      // Load saved data
      loadInitialData();

      // Set up event listeners
      setupEventListeners(passwordModal, notificationsModal);

      // Load permits for the current mode
      loadPermitsForCurrentMode();

      // Set current date as default for date fields
      setDefaultDates();
    });

    function initializeSignaturePads() {
      const signatureCanvases = document.querySelectorAll('canvas');
      signatureCanvases.forEach(canvas => {
        const pad = new SignaturePad(canvas, {
          backgroundColor: 'rgb(255, 255, 255)',
          penColor: 'rgb(0, 0, 0)'
        });
        signaturePads[canvas.id] = pad;
      });
    }
    // Add these functions to your script
    function addCrewMemberRow(crewMember = {}) {
      const tableBody = document.querySelector('#crewMembersTable tbody');
      const rowCount = tableBody.querySelectorAll('tr').length;
      const rowId = `crew-${Date.now()}`;

      const row = document.createElement('tr');
      row.id = rowId;
      row.innerHTML = `
    <td><input type="text" class="form-control form-control-sm" name="crewSrNo" value="${crewMember.srNo || rowCount + 1}"></td>
    <td><input type="text" class="form-control form-control-sm" name="crewName" value="${crewMember.name || ''}"></td>
    <td><input type="text" class="form-control form-control-sm" name="crewIqama" value="${crewMember.iqama || ''}"></td>
    <td><input type="text" class="form-control form-control-sm" name="crewDesignation" value="${crewMember.designation || ''}"></td>
    <td><input type="text" class="form-control form-control-sm" name="crewCompany" value="${crewMember.company || ''}"></td>
    <td>
      <button type="button" class="btn btn-sm btn-danger remove-crew-member" data-row-id="${rowId}">
        <i class="bi bi-trash"></i>
      </button>
    </td>
  `;

      tableBody.appendChild(row);

      // Add event listener to the remove button
      row.querySelector('.remove-crew-member').addEventListener('click', function () {
        removeCrewMemberRow(this.getAttribute('data-row-id'));
      });
    }

    function removeCrewMemberRow(rowId) {
      const row = document.getElementById(rowId);
      if (row) {
        row.remove();
        // Update serial numbers after removal
        updateCrewMemberSerialNumbers();
      }
    }

    function updateCrewMemberSerialNumbers() {
      const rows = document.querySelectorAll('#crewMembersTable tbody tr');
      rows.forEach((row, index) => {
        row.querySelector('input[name="crewSrNo"]').value = index + 1;
      });
    }

    function getCrewMembers() {
      const crewMembers = [];
      const rows = document.querySelectorAll('#crewMembersTable tbody tr');

      rows.forEach(row => {
        crewMembers.push({
          srNo: row.querySelector('input[name="crewSrNo"]').value,
          name: row.querySelector('input[name="crewName"]').value,
          iqama: row.querySelector('input[name="crewIqama"]').value,
          designation: row.querySelector('input[name="crewDesignation"]').value,
          company: row.querySelector('input[name="crewCompany"]').value
        });
      });

      return crewMembers;
    }

    // Add to your setupEventListeners() function
    document.getElementById('addCrewMember').addEventListener('click', () => {
      addCrewMemberRow();
    });
    function setupEventListeners(passwordModal, notificationsModal) {
      // Mode selection
      document.getElementById('enterIssuerMode').addEventListener('click', () => {
        passwordModal.show();
        document.getElementById('passwordInput').placeholder = "Enter issuer password (5678)";
        document.getElementById('submitPassword').onclick = () => verifyPassword(passwordModal, ISSUER_PASSWORD, 'issuer');
      });
      document.getElementById('permitType').addEventListener('change', function () {
        handlePermitTypeChange(this.value);
      });
      document.getElementById('enterRequesterMode').addEventListener('click', () => {
        passwordModal.show();
        document.getElementById('passwordInput').placeholder = "Enter requester password (1234)";
        document.getElementById('submitPassword').onclick = () => verifyPassword(passwordModal, REQUESTER_PASSWORD, 'requester');
      });

      document.getElementById('enterNoSelectMode').addEventListener('click', () => {
        currentMode = 'no-select';
        localStorage.setItem('currentMode', currentMode);
        updateUIForMode();
        document.getElementById('currentModeDisplay').textContent = 'Current mode: Default View';
        loadPermitsForCurrentMode();
      });

      // Permit type selection
      document.getElementById('permitType').addEventListener('change', function () {
        // Hide all permit sections
        document.querySelectorAll('.permit-section').forEach(section => {
          section.classList.remove('active');
        });
        // Add to your setupEventListeners() function
        document.getElementById('backToList').addEventListener('click', cancelPermitForm);
        // Show selected permit section
        document.getElementById(`${this.value}-sections`).classList.add('active');
      });
      // Lifting Equipment Type Other Specifier
      document.getElementById('liftingEquipmentType').addEventListener('change', function () {
        document.getElementById('otherLiftingEquipment').style.display =
          this.value === 'other' ? 'block' : 'none';
      });

      // Equipment to be Lifted Other Specifier
      document.getElementById('equipmentToBeLifted').addEventListener('change', function () {
        document.getElementById('otherEquipmentToBeLifted').style.display =
          this.value === 'other' ? 'block' : 'none';
      });

      // Lifting Calculations
      function updateLiftingCalculations() {
        const totalLoadWeight = parseFloat(document.getElementById('totalLoadWeight').value) || 0;
        const equipmentCapacity = parseFloat(document.getElementById('equipmentCapacity').value) || 0;
        const safetyFactor = parseFloat(document.getElementById('safetyFactor').value) || 0;

        if (totalLoadWeight > 0 && equipmentCapacity > 0) {
          const requiredCapacity = totalLoadWeight * (1 + (safetyFactor / 100));
          document.getElementById('requiredCapacity').value = requiredCapacity.toFixed(2);

          const boomLength = parseFloat(document.getElementById('boomLength').value) || 0;
          const boomAngle = parseFloat(document.getElementById('boomAngle').value) || 0;
          const loadRadius = parseFloat(document.getElementById('loadRadius').value) || 0;

          // Simplified calculation - in a real app you'd use the equipment's load chart
          let calculatedCapacity = equipmentCapacity;
          if (boomLength > 0 && boomAngle > 0) {
            // This is a simplified approximation - real calculations would use the load chart
            const angleFactor = Math.cos(boomAngle * Math.PI / 180);
            const lengthFactor = 1 - (boomLength / 100); // Assuming 100m is max boom length
            calculatedCapacity = equipmentCapacity * angleFactor * lengthFactor;
          }
          document.getElementById('calculatedCapacity').value = calculatedCapacity.toFixed(2);

          // Update safety indicator
          const safetyPercentage = Math.min(100, (calculatedCapacity / requiredCapacity) * 100);
          const progressBar = document.getElementById('safetyProgressBar');
          const safetyStatusText = document.getElementById('safetyStatusText');
          const safetyMessage = document.getElementById('safetyMessage');

          progressBar.style.width = `${safetyPercentage}%`;

          if (calculatedCapacity >= requiredCapacity) {
            progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-success';
            safetyStatusText.textContent = 'SAFE';
            safetyMessage.textContent = 'Lifting operation is within safe limits';
            safetyMessage.className = 'mt-2 text-center fw-bold text-success';
          } else {
            progressBar.className = 'progress-bar progress-bar-striped progress-bar-animated bg-danger';
            safetyStatusText.textContent = 'UNSAFE';
            safetyMessage.textContent = 'Lifting operation exceeds safe limits!';
            safetyMessage.className = 'mt-2 text-center fw-bold text-danger';
          }
        }
      }

      // Add event listeners for calculation fields
      ['totalLoadWeight', 'equipmentCapacity', 'boomLength', 'boomAngle', 'loadRadius'].forEach(id => {
        document.getElementById(id).addEventListener('input', updateLiftingCalculations);
      });


      // Form actions
      document.getElementById('saveDraft').addEventListener('click', saveAsDraft);
      document.getElementById('submitPermitRequest').addEventListener('click', submitPermitRequest);
      document.getElementById('cancelPermit').addEventListener('click', cancelPermitForm);
      document.getElementById('createNewPermit').addEventListener('click', showNewPermitForm);

      // Issuer actions

      document.getElementById('issuerApprovePermit').addEventListener('click', () => {
        if (confirm('Are you sure you want to approve this permit?')) {
          updatePermitStatus('approved');
        }
      });

      document.getElementById('issuerRejectPermit').addEventListener('click', () => {
        if (confirm('Are you sure you want to reject this permit?')) {
          updatePermitStatus('rejected');
        }
      });

      document.getElementById('issuerEditPermit').addEventListener('click', enableIssuerEditing);
      document.getElementById('issuerCancelPermit').addEventListener('click', cancelIssuerPermitForm);

      // Notifications
      document.getElementById('viewNotifications').addEventListener('click', showNotifications);
    }
    function handlePermitTypeChange(newType) {
      // Hide all permit sections
      document.querySelectorAll('.permit-section').forEach(section => {
        section.classList.remove('active');
      });

      // Show selected permit section
      document.getElementById(`${newType}-sections`).classList.add('active');

      // If we have a current draft for this permit type, load it
      loadDraftForPermitType(newType);
    }

    function loadDraftForPermitType(permitType) {
      const permits = getAllPermits();
      const draftForType = Object.values(permits).find(p =>
        p.status === 'draft' && p.permitType === permitType
      );

      if (draftForType) {
        currentPermitId = draftForType.id;
        populateFormWithDraft(draftForType);
      } else {
        // No draft exists for this type - reset form for new draft
        resetFormForNewDraft(permitType);
      }
    }

    function populateFormWithDraft(draft) {
      // Set basic fields
      document.getElementById('permitNumber').value = draft.permitNumber || '';
      document.getElementById('dateIssued').value = draft.dateIssued || '';
      document.getElementById('requestorName').value = draft.requestorName || '';
      document.getElementById('requestorDate').value = draft.requestorDate || '';
      document.getElementById('requestorTime').value = draft.requestorTime || '';
      document.getElementById('permitIssuerSelect').value = draft.selectedIssuer || '';

      // Set Work Execution Plan fields
      document.getElementById('validFrom').value = draft.validFrom || '';
      document.getElementById('validTo').value = draft.validTo || '';
      document.getElementById('locationOfWork').value = draft.locationOfWork || '';
      document.getElementById('functionalName').value = draft.functionalName || '';
      document.getElementById('equipmentNo').value = draft.equipmentNo || '';
      document.getElementById('equipmentType').value = draft.equipmentType || '';
      document.getElementById('workDescription').value = permit.workDescription || '';
      setCheckedValues('documents', draft.documents || []);
      if (draft.docOthersSpecify) {
        document.getElementById('docOthersSpecify').value = draft.docOthersSpecify;
      }
      // In the populateFormWithDraft function (around line 2100), add these lines:
      setCheckedValues('plantArea', permit.plantArea || []);
      if (permit.plantAreaOthersSpecify) {
        document.getElementById('areaOthersSpecify').value = permit.plantAreaOthersSpecify;
      }

      setCheckedValues('department', permit.department || []);
      if (permit.departmentOthersSpecify) {
        document.getElementById('deptOthersSpecify').value = permit.departmentOthersSpecify;
      }

      document.getElementById('contractorCompany').value = permit.contractorCompany || '';
      document.getElementById('numEmployees').value = permit.numEmployees || '';
      // Set night work checkboxes
      setCheckedValues('nightWork', draft.nightWork || []);
      document.getElementById('nightWorkOtherChecks').value = draft.nightWorkOtherChecks || '';

      // Set permit type specific data
      if (draft.permitType === 'general') {
        setCheckedValues('hazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('hazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('precautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('precOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('ppe', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('ppeOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      else if (draft.permitType === 'hot-work') {
        setCheckedValues('hwHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('hwHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('hwPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('hwPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('hwPPE', draft.ppe || []);
      }
      else if (draft.permitType === 'electrical') {
        setCheckedValues('electricalHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('electricalHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('electricalPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('electricalPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('electricalPPE', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('electricalPPEOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      else if (draft.permitType === 'confined') {
        setCheckedValues('confinedHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('confinedHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('confinedPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('confinedPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('confinedPPE', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('confinedPPEOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      else if (draft.permitType === 'height') {
        setCheckedValues('heightHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('heightHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('heightPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('heightPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('heightPPE', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('heightPPEOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      else if (draft.permitType === 'loto') {
        setCheckedValues('lotoHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('lotoHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('lotoPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('lotoPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('lotoPPE', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('lotoPPEOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      else if (draft.permitType === 'lifting') {
        setCheckedValues('liftingHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('liftingHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('liftingPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('liftingPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('liftingPPE', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('liftingPPEOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      if (permitType === 'lifting') {
        document.getElementById('liftingEquipmentType').value = permit.liftingEquipmentType || '';
        if (permit.liftingEquipmentType === 'other') {
          document.getElementById('otherLiftingEquipment').value = permit.otherLiftingEquipment || '';
          document.getElementById('otherLiftingEquipment').style.display = 'block';
        }
        document.getElementById('equipmentModel').value = permit.equipmentModel || '';
        document.getElementById('equipmentSerialNumber').value = permit.equipmentSerialNumber || '';
        document.getElementById('equipmentInspectionDate').value = permit.equipmentInspectionDate || '';
        document.getElementById('equipmentCertExpiry').value = permit.equipmentCertExpiry || '';

        document.getElementById('equipmentToBeLifted').value = permit.equipmentToBeLifted || '';
        if (permit.equipmentToBeLifted === 'other') {
          document.getElementById('otherEquipmentToBeLifted').value = permit.otherEquipmentToBeLifted || '';
          document.getElementById('otherEquipmentToBeLifted').style.display = 'block';
        }
        document.getElementById('equipmentDimensions').value = permit.equipmentDimensions || '';
        document.getElementById('equipmentSpecialNotes').value = permit.equipmentSpecialNotes || '';

        document.getElementById('totalLoadWeight').value = permit.totalLoadWeight || '';
        document.getElementById('equipmentCapacity').value = permit.equipmentCapacity || '';
        document.getElementById('safetyFactor').value = permit.safetyFactor || '25';
        document.getElementById('boomLength').value = permit.boomLength || '';
        document.getElementById('boomAngle').value = permit.boomAngle || '';
        document.getElementById('loadRadius').value = permit.loadRadius || '';
        document.getElementById('calculatedCapacity').value = permit.calculatedCapacity || '';
        document.getElementById('requiredCapacity').value = permit.requiredCapacity || '';

        // Trigger calculation update if needed
        if (permit.totalLoadWeight || permit.equipmentCapacity) {
          setTimeout(updateLiftingCalculations, 100);
        }
      }
      else if (draft.permitType === 'excavation') {
        setCheckedValues('excavationHazards', draft.hazards || []);
        if (draft.hazardOthersSpecify) {
          document.getElementById('excavationHazardOthersSpecify').value = draft.hazardOthersSpecify;
        }
        setCheckedValues('excavationPrecautions', draft.precautions || []);
        if (draft.precOthersSpecify) {
          document.getElementById('excavationPrecOthersSpecify').value = draft.precOthersSpecify;
        }
        setCheckedValues('excavationPPE', draft.ppe || []);
        if (draft.ppeOthersSpecify) {
          document.getElementById('excavationPPEOthersSpecify').value = draft.ppeOthersSpecify;
        }
      }
      // Set documents checkboxes
      if (draft.documents) {
        draft.documents.forEach(doc => {
          const checkbox = document.querySelector(`input[name="documents"][value="${doc}"]`);
          if (checkbox) checkbox.checked = true;
        });
      }
      if (draft.docOthersSpecify) {
        document.getElementById('docOthersSpecify').value = draft.docOthersSpecify;
      }


      document.querySelector('#crewMembersTable tbody').innerHTML = '';
      // Add crew members if they exist
      if (permit.crewMembers && permit.crewMembers.length > 0) {
        permit.crewMembers.forEach(member => {
          addCrewMemberRow(member);
        });
      } else {
        // Add one empty row by default
        addCrewMemberRow();
      }

      // Load signature if exists
      if (draft.requestorSignature) {
        signaturePads['requestorSignature'].fromDataURL(draft.requestorSignature);
      }

      updateStatusDisplay(draft.status || 'draft');
    }
    // Update the UI based on permit type
    updateFormForPermitType(draft.permitType);

    function setCheckedValues(prefix, values) {
      values.forEach(value => {
        const checkbox = document.getElementById(`${prefix}_${value.replace(/\s+/g, '_')}`);
        if (checkbox) checkbox.checked = true;
      });
    }


    function resetFormForNewDraft(permitType) {
      currentPermitId = null;

      // Reset form fields
      const form = document.getElementById('generalPermitForm');
      form.reset();
      // In the resetFormForNewDraft function (around line 2200), add these lines:
      document.getElementById('areaOthersSpecify').value = '';
      document.getElementById('deptOthersSpecify').value = '';
      document.getElementById('contractorCompany').value = '';
      document.getElementById('numEmployees').value = '';
      document.getElementById('workDescription').value = '';

      const areaCheckboxes = document.querySelectorAll('input[name="plantArea"]');
      areaCheckboxes.forEach(cb => cb.checked = false);

      const deptCheckboxes = document.querySelectorAll('input[name="department"]');
      deptCheckboxes.forEach(cb => cb.checked = false);

      // Reset lifting equipment fields
      document.getElementById('liftingEquipmentType').value = '';
      document.getElementById('otherLiftingEquipment').value = '';
      document.getElementById('otherLiftingEquipment').style.display = 'none';
      document.getElementById('equipmentModel').value = '';
      document.getElementById('equipmentSerialNumber').value = '';
      document.getElementById('equipmentInspectionDate').value = '';
      document.getElementById('equipmentCertExpiry').value = '';

      document.getElementById('equipmentToBeLifted').value = '';
      document.getElementById('otherEquipmentToBeLifted').value = '';
      document.getElementById('otherEquipmentToBeLifted').style.display = 'none';
      document.getElementById('equipmentDimensions').value = '';
      document.getElementById('equipmentSpecialNotes').value = '';

      document.getElementById('totalLoadWeight').value = '';
      document.getElementById('equipmentCapacity').value = '';
      document.getElementById('safetyFactor').value = '25';
      document.getElementById('boomLength').value = '';
      document.getElementById('boomAngle').value = '';
      document.getElementById('loadRadius').value = '';
      document.getElementById('calculatedCapacity').value = '';
      document.getElementById('requiredCapacity').value = '';

      // Reset safety indicator
      document.getElementById('safetyProgressBar').style.width = '0%';
      document.getElementById('safetyProgressBar').className = 'progress-bar progress-bar-striped progress-bar-animated';
      document.getElementById('safetyStatusText').textContent = 'Enter values to calculate';
      document.getElementById('safetyMessage').textContent = '';
      document.getElementById('safetyMessage').className = 'mt-2 text-center fw-bold';

      // Clear checkboxes
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = false);

      // Clear signature
      signaturePads['requestorSignature'].clear();

      // Set current date/time
      const today = new Date().toISOString().split('T')[0];
      const time = new Date().toTimeString().substring(0, 5);
      document.getElementById('dateIssued').value = today;
      document.getElementById('requestorDate').value = today;
      document.getElementById('requestorTime').value = time;

      // Set permit type
      document.getElementById('permitType').value = permitType;
      updateStatusDisplay('draft');
      const docCheckboxes = document.querySelectorAll('input[name="documents"]');
      docCheckboxes.forEach(cb => cb.checked = false);
      document.getElementById('docOthersSpecify').value = '';


      // Clear night work fields
      const nightWorkCheckboxes = document.querySelectorAll('input[name="nightWork"]');
      nightWorkCheckboxes.forEach(cb => cb.checked = false);
      document.getElementById('nightWorkOtherChecks').value = '';
    }



    function loadInitialData() {
      // Load next permit number from localStorage
      const savedNextNumber = localStorage.getItem('nextPermitNumber');
      if (savedNextNumber) {
        nextPermitNumber = parseInt(savedNextNumber);
      }

      // Load current mode if exists
      if (localStorage.getItem('currentMode')) {
        currentMode = localStorage.getItem('currentMode');
        updateUIForMode();
        document.getElementById('currentModeDisplay').textContent = `Current mode: ${getModeDisplayName(currentMode)}`;
      }

      // Set up tab switching
      const tabEl = document.querySelector(`#${currentMode}-tab`);
      if (tabEl) {
        new bootstrap.Tab(tabEl).show();
      }
    }

    function getModeDisplayName(mode) {
      switch (mode) {
        case 'issuer': return 'Issuer Mode';
        case 'requester': return 'Requester Mode';
        default: return 'Default View';
      }
    }

    function verifyPassword(modal, correctPassword, mode) {
      const passwordInput = document.getElementById('passwordInput');
      const passwordError = document.getElementById('passwordError');

      if (passwordInput.value === correctPassword) {
        currentMode = mode;
        localStorage.setItem('currentMode', mode);
        updateUIForMode();
        modal.hide();
        passwordInput.value = '';
        passwordError.classList.add('d-none');
        document.getElementById('currentModeDisplay').textContent = `Current mode: ${getModeDisplayName(mode)}`;

        // Show the appropriate tab
        const tabEl = document.querySelector(`#${mode}-tab`);
        if (tabEl) {
          new bootstrap.Tab(tabEl).show();
        }

        // Load permits for the new mode
        loadPermitsForCurrentMode();

        // If entering issuer mode, check for pending permits
        if (mode === 'issuer') {
          checkForPendingPermits();
        }
      } else {
        passwordError.classList.remove('d-none');
      }
    }

    function updateUIForMode() {
      // Update the active tab based on current mode
      const tabs = document.querySelectorAll('.mode-tabs .nav-link');
      tabs.forEach(tab => tab.classList.remove('active'));

      const activeTab = document.querySelector(`#${currentMode}-tab`);
      if (activeTab) {
        activeTab.classList.add('active');
      }

      // Update tab content visibility
      const tabContents = document.querySelectorAll('.tab-content .tab-pane');
      tabContents.forEach(content => content.classList.remove('show', 'active'));

      const activeContent = document.querySelector(`#${currentMode}-content`);
      if (activeContent) {
        activeContent.classList.add('show', 'active');
      }

      // Hide permit forms by default
      document.getElementById('requesterPermitFormCard').classList.add('d-none');
      document.getElementById('issuerPermitFormCard').classList.add('d-none');
    }

    function loadPermitsForCurrentMode() {
      const permits = getAllPermits();

      if (currentMode === 'requester') {
        // Load draft permits for requester
        const draftPermits = Object.values(permits).filter(p => p.status === 'draft');
        renderDraftPermits(draftPermits);
      } else if (currentMode === 'issuer') {
        // Load submitted permits for issuer
        const submittedPermits = Object.values(permits).filter(p => p.status === 'submitted');
        renderSubmittedPermits(submittedPermits);
      } else {
        // In default mode, use the new filtering system
        setupFilterControls();
        filterPermits('day'); // Default to showing today's permits
      }
    }

    function renderDraftPermits(permits) {
      const container = document.getElementById('draftPermitsList');
      container.innerHTML = '';

      if (permits.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No draft permits found</div>';
        document.getElementById('requesterPermitFormCard').classList.add('d-none');
        return;
      }

      permits.forEach(permit => {
        const hazardsBadge = permit.hazards?.length > 0
          ? `<span class="badge bg-warning text-dark ms-2">${permit.hazards.length} Hazards</span>`
          : '';

        const permitElement = document.createElement('div');
        permitElement.className = `permit-list-item ${currentPermitId === permit.id ? 'active-permit' : ''}`;
        permitElement.setAttribute('data-permit-id', permit.id);

        permitElement.innerHTML = `
      <div class="d-flex justify-content-between">
        <div class="permit-number">${PERMIT_TYPES[permit.permitType] || 'Draft Permit'} ${hazardsBadge}</div>
        <div class="permit-status">
          <span class="badge bg-secondary">DRAFT</span>
        </div>
      </div>
      <div class="permit-details">
        <div><span class="detail-label">Request Date:</span> ${permit.requestorDate || 'Not specified'}</div>
        ${permit.hazards?.length > 0 ? `
          <div><span class="detail-label">Main Hazards:</span> 
            ${permit.hazards.slice(0, 3).join(', ')}${permit.hazards.length > 3 ? '...' : ''}
          </div>
        ` : ''}
      </div>
      <div class="mt-2 d-flex gap-2">
        <button class="btn btn-sm btn-primary edit-permit-btn" data-permit-id="${permit.id}">
          <i class="bi bi-pencil"></i> Edit
        </button>
        <button class="btn btn-sm btn-danger delete-permit-btn" data-permit-id="${permit.id}">
          <i class="bi bi-trash"></i> Delete
        </button>
      </div>
    `;

        container.appendChild(permitElement);
      });

      // Add event listeners for edit buttons
      document.querySelectorAll('.edit-permit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const permitId = e.target.getAttribute('data-permit-id') ||
            e.target.closest('button').getAttribute('data-permit-id');
          loadPermitForRequester(permitId);
        });
      });

      // Add event listeners for delete buttons
      document.querySelectorAll('.delete-permit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const permitId = e.target.getAttribute('data-permit-id') ||
            e.target.closest('button').getAttribute('data-permit-id');
          deleteDraftPermit(permitId);
        });
      });

      // Keep the original click handler for the permit item
      document.querySelectorAll('.permit-list-item').forEach(item => {
        item.addEventListener('click', function () {
          const permitId = this.getAttribute('data-permit-id');
          loadPermitForRequester(permitId);
        });
      });

      if (currentPermitId) {
        const currentPermitElement = container.querySelector(`[data-permit-id="${currentPermitId}"]`);
        if (currentPermitElement) {
          currentPermitElement.classList.add('active-permit');
        }
      }
    }
   
    function deleteDraftPermit(permitId) {
      if (confirm('Are you sure you want to delete this draft permit? This action cannot be undone.')) {
        const permits = getAllPermits();

        if (permits[permitId]) {
          delete permits[permitId];
          localStorage.setItem('permits', JSON.stringify(permits));

          // If we're deleting the currently viewed permit, close the form
          if (currentPermitId === permitId) {
            cancelPermitForm();
          }

          // Reload the list
          const draftPermits = Object.values(permits).filter(p => p.status === 'draft');
          renderDraftPermits(draftPermits);

          alert('Draft permit deleted successfully');
        } else {
          alert('Permit not found');
        }
      }
    }
    // In the renderSubmittedPermits function, update the click event handler:
    function renderSubmittedPermits(permits) {
      const container = document.getElementById('submittedPermitsList');
      container.innerHTML = '';

      if (permits.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No submitted permits found</div>';
        return;
      }

      permits.forEach(permit => {
        const hazardsCount = permit.hazards?.length || 0;
        const hazardsBadge = hazardsCount > 0
          ? `<span class="badge bg-warning text-dark ms-2">${hazardsCount} Hazards</span>`
          : '';

        const permitElement = document.createElement('div');
        permitElement.className = 'permit-list-item';
        permitElement.innerHTML = `
      <div class="d-flex justify-content-between">
        <div class="permit-number">${PERMIT_TYPES[permit.permitType] || 'Submitted Permit'} ${hazardsBadge}</div>
        <div class="permit-status">
          <span class="badge bg-primary">SUBMITTED</span>
        </div>
      </div>
      <div class="permit-details">
        <div><span class="detail-label">Requester:</span> ${permit.requestorName || 'Unknown'}</div>
        <div><span class="detail-label">Request Date:</span> ${permit.requestorDate || 'Not specified'}</div>
        ${hazardsCount > 0 ? `
          <div><span class="detail-label">Main Hazards:</span> 
            ${permit.hazards.slice(0, 2).join(', ')}${permit.hazards.length > 2 ? '...' : ''}
          </div>
        ` : ''}
      </div>
    `;

        // Add click event listener directly to the element
        permitElement.addEventListener('click', (e) => {
          e.stopPropagation();
          loadPermitForIssuer(permit.id);
        });

        container.appendChild(permitElement);
      });
    }

    function renderCompletedPermits(permits) {
      const container = document.getElementById('completedPermitsList');
      container.innerHTML = '';

      if (permits.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No completed permits found</div>';
        return;
      }

      // Sort permits by permit number (newest first)
      const sortedPermits = permits.sort((a, b) => {
        if (a.permitNumber && b.permitNumber) {
          return b.permitNumber.localeCompare(a.permitNumber);
        }
        return 0;
      });

      sortedPermits.forEach(permit => {
        const hazardsCount = permit.hazards?.length || 0;
        const hazardsBadge = hazardsCount > 0
          ? `<span class="badge bg-warning text-dark ms-2">${hazardsCount} Hazards</span>`
          : '';

        const permitElement = document.createElement('div');
        permitElement.className = 'permit-list-item';
        permitElement.innerHTML = `
      <div class="d-flex justify-content-between">
        <div class="permit-number">${permit.permitNumber || 'No Number'} (${PERMIT_TYPES[permit.permitType] || 'Permit'}) ${hazardsBadge}</div>
        <div class="permit-status">
          <span class="badge ${permit.status === 'approved' ? 'bg-success' : 'bg-danger'}">
            ${permit.status.toUpperCase()}
          </span>
        </div>
      </div>
      <div class="permit-details">
        <div><span class="detail-label">Requester:</span> ${permit.requestorName || 'Unknown'}</div>
        <div><span class="detail-label">Issuer:</span> ${permit.issuerName || 'Not specified'}</div>
        <div><span class="detail-label">Status Date:</span> ${permit.issuerDate || 'Not specified'}</div>
        ${hazardsCount > 0 ? `
          <div><span class="detail-label">Main Hazards:</span> 
            ${permit.hazards.slice(0, 2).join(', ')}${permit.hazards.length > 2 ? '...' : ''}
          </div>
        ` : ''}
      </div>
      <div class="mt-2">
        <button class="btn btn-sm btn-outline-primary view-permit-btn" data-permit-id="${permit.id}">
          <i class="bi bi-eye"></i> View
        </button>
        <button class="btn btn-sm btn-outline-secondary download-permit-btn" data-permit-id="${permit.id}">
          <i class="bi bi-download"></i> Download
        </button>
      </div>
    `;

        container.appendChild(permitElement);
      });

      // Add event listeners to view buttons
      document.querySelectorAll('.view-permit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const permitId = e.target.getAttribute('data-permit-id') ||
            e.target.closest('button').getAttribute('data-permit-id');
          viewPermitDetails(permitId);
        });
      });

      // Add event listeners to download buttons
      document.querySelectorAll('.download-permit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const permitId = e.target.getAttribute('data-permit-id') ||
            e.target.closest('button').getAttribute('data-permit-id');
          downloadPermitAsPDF(permitId);
        });
      });
    }

    function showNewPermitForm() {
      resetForm();
      document.getElementById('requesterPermitFormCard').classList.remove('d-none');
      document.getElementById('draftPermitsList').classList.add('d-none');

      // Set current date and time for requester
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const time = now.toTimeString().substring(0, 5);

      document.getElementById('requestorDate').value = today;
      document.getElementById('requestorTime').value = time;
      document.getElementById('dateIssued').value = today;

      // Show general permit section by default
      document.querySelectorAll('.permit-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById('general-permit-sections').classList.add('active');
    }

    function cancelPermitForm() {
      document.getElementById('requesterPermitFormCard').classList.add('d-none');
      document.getElementById('draftPermitsList').classList.remove('d-none');
      currentPermitId = null;

      // Re-render the list to remove any highlights
      const permits = Object.values(getAllPermits()).filter(p => p.status === 'draft');
      renderDraftPermits(permits);
    }

    function cancelIssuerPermitForm() {
      document.getElementById('issuerPermitFormCard').classList.add('d-none');
      document.getElementById('submittedPermitsList').classList.remove('d-none');
      loadPermitsForCurrentMode();
    }

    function saveAsDraft() {
      const permitData = collectFormData();
      permitData.status = 'draft';
      permitData.permitType = document.getElementById('permitType').value;

      if (!currentPermitId) {
        currentPermitId = 'permit-' + Date.now();
      }

      permitData.id = currentPermitId;
      savePermit(permitData);
      updateStatusDisplay('draft');

      // Show success message
      alert(`${PERMIT_TYPES[permitData.permitType]} draft saved successfully!`);
    }




    function submitPermitRequest() {
      const issuerSelect = document.getElementById('permitIssuerSelect');
      if (!issuerSelect.value) {
        alert('Please select a permit issuer');
        return;
      }

      if (!document.getElementById('requestorName').value) {
        alert('Please select an authorized receiver');
        return;
      }

      // Make signature optional or provide better feedback
      if (signaturePads['requestorSignature'].isEmpty()) {
        if (!confirm('You haven\'t provided a signature. Continue without signature?')) {
          return;
        }
      }

      const permitData = collectFormData();
      permitData.status = 'submitted';
      permitData.selectedIssuer = issuerSelect.value;

      // Generate a unique ID for this permit if it doesn't have one
      if (!currentPermitId) {
        currentPermitId = 'permit-' + Date.now();
      }

      permitData.id = currentPermitId;
      savePermit(permitData);
      updateStatusDisplay('submitted');

      // Save as current permit
      localStorage.setItem('currentPermitId', currentPermitId);

      // Create a notification for the issuer
      createNotification(permitData);

      alert(`Permit submitted successfully to ${issuerSelect.value}!`);
      loadPermitsForCurrentMode();
      cancelPermitForm();
    }

    function updatePermitStatus(status) {
      if (signaturePads['issuerIssuerSignature'].isEmpty()) {
        alert('Please provide your signature as the issuer');
        return;
      }

      const permitData = getPermit(currentPermitId);
      if (!permitData) {
        alert('No permit found to update');
        return;
      }

      // Set current date and time for issuer
      const now = new Date();
      const today = now.toISOString().split('T')[0];
      const time = now.toTimeString().substring(0, 5);

      // Update permit data
      permitData.status = status;
      permitData.finalStatus = status;
      permitData.issuerName = document.getElementById('issuerIssuerName').value;
      permitData.issuerDate = today;
      permitData.issuerTime = time;
      permitData.issuerSignature = signaturePads['issuerIssuerSignature'].toDataURL();

      if (status === 'approved') {
        permitData.permitNumber = `O&M-PTW-${nextPermitNumber.toString().padStart(4, '0')}`;
        nextPermitNumber++;
        localStorage.setItem('nextPermitNumber', nextPermitNumber);
      }

      // Save updated permit
      savePermit(permitData);

      // Remove from pending notifications
      removeNotification(currentPermitId);

      // Show success message and reload permits
      alert(`Permit ${status} successfully!`);
      loadPermitsForCurrentMode();
      cancelIssuerPermitForm();
    }
    function enableIssuerEditing() {
      const form = document.getElementById('issuerPermitForm');
      const inputs = form.querySelectorAll('input, textarea, select');

      inputs.forEach(input => {
        // Enable editing for most fields except readonly ones
        if (!input.readOnly &&
          !input.id.includes('PermitNumber') &&
          !input.id.includes('PermitType') &&
          !input.id.includes('DateIssued')) {
          input.readOnly = false;
        }
      });
      // Add to enableIssuerEditing()
      document.getElementById('issuerValidFrom').readOnly = false;
      document.getElementById('issuerValidTo').readOnly = false;
      document.getElementById('issuerLocationOfWork').readOnly = false;
      document.getElementById('issuerFunctionalName').readOnly = false;
      document.getElementById('issuerEquipmentNo').readOnly = false;
      document.getElementById('issuerEquipmentType').readOnly = false;
      document.getElementById('issuerEquipmentType').type = 'select-one'; // Change from text input to select

      // Set issuer name from the selected issuer in the requester form
      const permitData = getPermit(currentPermitId);
      if (permitData) {
        document.getElementById('issuerIssuerName').value = permitData.selectedIssuer;
      }

      // Change buttons
      document.getElementById('issuerEditPermit').classList.add('d-none');
      document.getElementById('issuerApprovePermit').classList.remove('d-none');
      document.getElementById('issuerRejectPermit').classList.remove('d-none');
    }
    function collectFormData() {
      const permitType = document.getElementById('permitType').value;
      const activeSection = document.getElementById(`${permitType}-sections`);

      const formData = {
        id: currentPermitId,
        permitType: permitType,
        permitNumber: document.getElementById('permitNumber').value,
        dateIssued: document.getElementById('dateIssued').value,
        plantName: 'South Jeddah Noor 300 MWAC PV Solar Project',
        plantArea: getCheckedValues('plantArea'),
        plantAreaOthersSpecify: document.getElementById('areaOthersSpecify').value,
        department: getCheckedValues('department'),
        departmentOthersSpecify: document.getElementById('deptOthersSpecify').value,
        contractorCompany: document.getElementById('contractorCompany').value,
        numEmployees: document.getElementById('numEmployees').value,
        validFrom: document.getElementById('validFrom').value,
        validTo: document.getElementById('validTo').value,
        locationOfWork: document.getElementById('locationOfWork').value,
        functionalName: document.getElementById('functionalName').value,
        equipmentNo: document.getElementById('equipmentNo').value,
        equipmentType: document.getElementById('equipmentType').value,
        workDescription: document.getElementById('workDescription').value,
        documents: getCheckedValues('documents'),
        docOthersSpecify: document.getElementById('docOthersSpecify').value,
        nightWork: getCheckedValues('nightWork'),
        nightWorkOtherChecks: document.getElementById('nightWorkOtherChecks').value,
        requestorName: document.getElementById('requestorName').value,
        requestorDate: document.getElementById('requestorDate').value,
        requestorTime: document.getElementById('requestorTime').value,
        selectedIssuer: document.getElementById('permitIssuerSelect').value,
        crewMembers: getCrewMembers(),
        requestorSignature: signaturePads['requestorSignature'].toDataURL(),
        status: 'draft' // Will be updated for submission
      };

      // Collect data specific to permit type
      if (permitType === 'general') {

        formData.hazards = getCheckedValues('hazards');
        if (formData.hazards.includes('Others')) {
          formData.hazardOthersSpecify = document.getElementById('hazardOthersSpecify').value;
        }

        formData.precautions = getCheckedValues('precautions');
        if (formData.precautions.includes('Others')) {
          formData.precOthersSpecify = document.getElementById('precOthersSpecify').value;
        }
        formData.ppe = getCheckedValues('ppe');

        if (formData.ppe.includes('Others')) {
          formData.ppeOthersSpecify = document.getElementById('ppeOthersSpecify').value;
        }
      }
      if (permitType === 'hot-work') {
        formData.hazards = getCheckedValues('hwHazards');
        if (formData.hazards.includes('Others')) {
          formData.hazardOthersSpecify = document.getElementById('hwHazardOthersSpecify').value;
        }

        formData.precautions = getCheckedValues('hwPrecautions');
        if (formData.precautions.includes('Others')) {
          formData.precOthersSpecify = document.getElementById('hwPrecOthersSpecify').value;
        }
        formData.ppe = getCheckedValues('hwPPE');
        formData.ppeOthersSpecify = document.getElementById('ppeOthersSpecify').value;
      }
      // Add to collectFormData() function
      if (permitType === 'electrical') {
        formData.hazards = getCheckedValues('electricalHazards');
        formData.precautions = getCheckedValues('electricalPrecautions');
        formData.ppe = getCheckedValues('electricalPPE');
      }
      else if (permitType === 'confined') {
        formData.hazards = getCheckedValues('confinedHazards');
        formData.precautions = getCheckedValues('confinedPrecautions');
        formData.ppe = getCheckedValues('confinedPPE');
      }
      else if (permitType === 'height') {
        formData.hazards = getCheckedValues('heightHazards');
        formData.precautions = getCheckedValues('heightPrecautions');
        formData.ppe = getCheckedValues('heightPPE');
      }
      else if (permitType === 'loto') {
        formData.hazards = getCheckedValues('lotoHazards');
        formData.precautions = getCheckedValues('lotoPrecautions');
        formData.ppe = getCheckedValues('lotoPPE');
      }
      else if (permitType === 'lifting') {
        formData.hazards = getCheckedValues('liftingHazards');
        formData.precautions = getCheckedValues('liftingPrecautions');
        formData.ppe = getCheckedValues('liftingPPE');
      }
      if (permitType === 'lifting') {
        // Collect lifting plan data
        formData.liftingPlan = [];
        const liftingPlanRows = document.querySelectorAll('#liftingPlanTable tbody tr');
        liftingPlanRows.forEach((row, index) => {
          const question = row.querySelector('td:first-child').textContent.trim();
          const response = row.querySelector('.response-select').value;
          const remarks = row.querySelector('input[type="text"]')?.value || '';

          formData.liftingPlan.push({
            question,
            response,
            remarks
          });
        });

        // Collect weight data separately
        formData.loadWeight = document.querySelector('input[name="loadWeight"]').value;
        formData.riggingWeight = document.querySelector('input[name="riggingWeight"]').value;
      }
      if (permitType === 'lifting') {
        formData.liftingEquipmentType = document.getElementById('liftingEquipmentType').value;
        if (formData.liftingEquipmentType === 'other') {
          formData.otherLiftingEquipment = document.getElementById('otherLiftingEquipment').value;
        }
        formData.equipmentModel = document.getElementById('equipmentModel').value;
        formData.equipmentSerialNumber = document.getElementById('equipmentSerialNumber').value;
        formData.equipmentInspectionDate = document.getElementById('equipmentInspectionDate').value;
        formData.equipmentCertExpiry = document.getElementById('equipmentCertExpiry').value;

        formData.equipmentToBeLifted = document.getElementById('equipmentToBeLifted').value;
        if (formData.equipmentToBeLifted === 'other') {
          formData.otherEquipmentToBeLifted = document.getElementById('otherEquipmentToBeLifted').value;
        }
        formData.equipmentDimensions = document.getElementById('equipmentDimensions').value;
        formData.equipmentSpecialNotes = document.getElementById('equipmentSpecialNotes').value;

        formData.totalLoadWeight = document.getElementById('totalLoadWeight').value;
        formData.equipmentCapacity = document.getElementById('equipmentCapacity').value;
        formData.safetyFactor = document.getElementById('safetyFactor').value;
        formData.boomLength = document.getElementById('boomLength').value;
        formData.boomAngle = document.getElementById('boomAngle').value;
        formData.loadRadius = document.getElementById('loadRadius').value;
        formData.calculatedCapacity = document.getElementById('calculatedCapacity').value;
        formData.requiredCapacity = document.getElementById('requiredCapacity').value;
      }


      else if (permitType === 'excavation') {
        formData.hazards = getCheckedValues('excavationHazards');
        formData.precautions = getCheckedValues('excavationPrecautions');
        formData.ppe = getCheckedValues('excavationPPE');
      }
      return formData;
    }



    function getCheckedValues(name) {
      const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
      return Array.from(checkboxes).map(cb => cb.value);
    }

    function savePermit(permitData) {
      const permits = getAllPermits();
      permits[permitData.id] = permitData;
      localStorage.setItem('permits', JSON.stringify(permits));
    }

    function getPermit(permitId) {
      const permits = getAllPermits();
      return permits[permitId];
    }

    function getAllPermits() {
      const permitsJson = localStorage.getItem('permits');
      return permitsJson ? JSON.parse(permitsJson) : {};
    }
    function loadPermitForRequester(permitId) {
      const permit = getPermit(permitId);
      if (!permit) {
        alert('Permit not found');
        return;
      }

      currentPermitId = permitId;

      // Set permit type
      document.getElementById('permitType').value = permit.permitType || 'general';

      // Trigger change event to show correct section
      document.getElementById('permitType').dispatchEvent(new Event('change'));

      // Set basic info
      document.getElementById('permitNumber').value = permit.permitNumber || '';
      document.getElementById('dateIssued').value = permit.dateIssued || '';
      document.getElementById('requestorName').value = permit.requestorName || '';
      document.getElementById('requestorDate').value = permit.requestorDate || '';
      document.getElementById('requestorTime').value = permit.requestorTime || '';
      document.getElementById('permitIssuerSelect').value = permit.selectedIssuer || '';

      // Set Work Execution Plan fields
      document.getElementById('validFrom').value = permit.validFrom || '';
      document.getElementById('validTo').value = permit.validTo || '';
      document.getElementById('locationOfWork').value = permit.locationOfWork || '';
      document.getElementById('functionalName').value = permit.functionalName || '';
      document.getElementById('equipmentNo').value = permit.equipmentNo || '';
      document.getElementById('equipmentType').value = permit.equipmentType || '';

      // Load permit type specific data
      if (permit.permitType === 'general') {
        setCheckedValues('hazards', permit.hazards || []);
        if (permit.hazardOthersSpecify) {
          document.getElementById('hazardOthersSpecify').value = permit.hazardOthersSpecify;
        }

        setCheckedValues('precautions', permit.precautions || []);
        if (permit.precOthersSpecify) {
          document.getElementById('precOthersSpecify').value = permit.precOthersSpecify;
        }

        setCheckedValues('ppe', permit.ppe || []);
        if (permit.ppeOthersSpecify) {
          document.getElementById('ppeOthersSpecify').value = permit.ppeOthersSpecify;
        }
      }

      else if (permit.permitType === 'hot-work') {
        // Set checkboxes
        setCheckedValues('hwHazards', permit.hazards || []);
        setCheckedValues('hwPrecautions', permit.precautions || []);
        setCheckedValues('hwPPE', permit.ppe || []);
        // Set PPE Others specify field
        document.getElementById('ppeOthersSpecify').value = permit.ppeOthersSpecify || '';
      }
      // Add to loadPermitForRequester() function
      else if (permit.permitType === 'electrical') {
        setCheckedValues('electricalHazards', permit.hazards || []);
        setCheckedValues('electricalPrecautions', permit.precautions || []);
        setCheckedValues('electricalPPE', permit.ppe || []);
      }
      else if (permit.permitType === 'confined') {
        setCheckedValues('confinedHazards', permit.hazards || []);
        setCheckedValues('confinedPrecautions', permit.precautions || []);
        setCheckedValues('confinedPPE', permit.ppe || []);
      }
      else if (permit.permitType === 'height') {
        setCheckedValues('heightHazards', permit.hazards || []);
        setCheckedValues('heightPrecautions', permit.precautions || []);
        setCheckedValues('heightPPE', permit.ppe || []);
      }
      else if (permit.permitType === 'loto') {
        setCheckedValues('lotoHazards', permit.hazards || []);
        setCheckedValues('lotoPrecautions', permit.precautions || []);
        setCheckedValues('lotoPPE', permit.ppe || []);
      }
      else if (permit.permitType === 'lifting') {
        setCheckedValues('liftingHazards', permit.hazards || []);
        setCheckedValues('liftingPrecautions', permit.precautions || []);
        setCheckedValues('liftingPPE', permit.ppe || []);
      }
      if (permit.permitType === 'lifting' && permit.liftingPlan) {
        const rows = document.querySelectorAll('#liftingPlanTable tbody tr');
        permit.liftingPlan.forEach((item, index) => {
          if (index < rows.length) {
            const row = rows[index];
            row.querySelector('.response-select').value = item.response;
            const remarksInput = row.querySelector('input[type="text"]');
            if (remarksInput) {
              remarksInput.value = item.remarks;
            }
          }
        });

        if (permit.loadWeight) {
          document.querySelector('input[name="loadWeight"]').value = permit.loadWeight;
        }
        if (permit.riggingWeight) {
          document.querySelector('input[name="riggingWeight"]').value = permit.riggingWeight;
        }
      }
      
    // Load lifting equipment data if it exists
    if (permit.permitType === 'lifting') {
        document.getElementById('liftingEquipmentType').value = permit.liftingEquipmentType || '';
        if (permit.liftingEquipmentType === 'other') {
            document.getElementById('otherLiftingEquipment').value = permit.otherLiftingEquipment || '';
            document.getElementById('otherLiftingEquipment').style.display = 'block';
        }
        
        document.getElementById('equipmentModel').value = permit.equipmentModel || '';
        document.getElementById('equipmentSerialNumber').value = permit.equipmentSerialNumber || '';
        document.getElementById('equipmentInspectionDate').value = permit.equipmentInspectionDate || '';
        document.getElementById('equipmentCertExpiry').value = permit.equipmentCertExpiry || '';
        
        document.getElementById('equipmentToBeLifted').value = permit.equipmentToBeLifted || '';
        if (permit.equipmentToBeLifted === 'other') {
            document.getElementById('otherEquipmentToBeLifted').value = permit.otherEquipmentToBeLifted || '';
            document.getElementById('otherEquipmentToBeLifted').style.display = 'block';
        }
        
        document.getElementById('equipmentDimensions').value = permit.equipmentDimensions || '';
        document.getElementById('equipmentSpecialNotes').value = permit.equipmentSpecialNotes || '';
        
        document.getElementById('totalLoadWeight').value = permit.totalLoadWeight || '';
        document.getElementById('equipmentCapacity').value = permit.equipmentCapacity || '';
        document.getElementById('safetyFactor').value = permit.safetyFactor || '25';
        document.getElementById('boomLength').value = permit.boomLength || '';
        document.getElementById('boomAngle').value = permit.boomAngle || '';
        document.getElementById('loadRadius').value = permit.loadRadius || '';
        document.getElementById('calculatedCapacity').value = permit.calculatedCapacity || '';
        document.getElementById('requiredCapacity').value = permit.requiredCapacity || '';       
        // Trigger calculation update if needed
        if (permit.totalLoadWeight || permit.equipmentCapacity) {
            setTimeout(updateLiftingCalculations, 100);
        }
    }

      else if (permit.permitType === 'excavation') {
        setCheckedValues('excavationHazards', permit.hazards || []);
        setCheckedValues('excavationPrecautions', permit.precautions || []);
        setCheckedValues('excavationPPE', permit.ppe || []);
      }
      // Load signature if exists
      if (permit.requestorSignature) {
        signaturePads['requestorSignature'].fromDataURL(permit.requestorSignature);
      }

      // Update status display
      updateStatusDisplay(permit.status || 'draft');

      // Show the form and hide the list
      document.getElementById('requesterPermitFormCard').classList.remove('d-none');
      document.getElementById('draftPermitsList').classList.add('d-none');
    }

    function setCheckedValues(name, values) {
      const checkboxes = document.querySelectorAll(`input[name="${name}"]`);
      checkboxes.forEach(checkbox => {
        checkbox.checked = values.includes(checkbox.value);
      });
    }
    // Update the loadPermitForIssuer function to ensure proper display:
    function loadPermitForIssuer(permitId) {
      const permit = getPermit(permitId);
      if (!permit) {
        alert('Permit not found');
        return;
      }

      currentPermitId = permitId;

      // Hide the list and show the form
      document.getElementById('submittedPermitsList').classList.add('d-none');
      const issuerFormCard = document.getElementById('issuerPermitFormCard');
      issuerFormCard.classList.remove('d-none');

      // Reset form state
      document.getElementById('issuerEditPermit').classList.remove('d-none');
      document.getElementById('issuerApprovePermit').classList.add('d-none');
      document.getElementById('issuerRejectPermit').classList.add('d-none');

      // Set basic info
      document.getElementById('issuerPermitNumber').value = permit.permitNumber || '';
      document.getElementById('issuerDateIssued').value = permit.dateIssued || '';
      document.getElementById('issuerPermitType').value = PERMIT_TYPES[permit.permitType] || 'General Work Permit';

      // Set work execution details
      document.getElementById('issuerValidFrom').value = permit.validFrom || '';
      document.getElementById('issuerValidTo').value = permit.validTo || '';
      document.getElementById('issuerLocationOfWork').value = permit.locationOfWork || '';
      document.getElementById('issuerFunctionalName').value = permit.functionalName || '';
      document.getElementById('issuerEquipmentNo').value = permit.equipmentNo || '';
      document.getElementById('issuerEquipmentType').value = permit.equipmentType || '';

      // Set requester info
      document.getElementById('issuerRequestorName').value = permit.requestorName || '';
      document.getElementById('issuerRequestorDate').value = permit.requestorDate || '';
      document.getElementById('issuerRequestorTime').value = permit.requestorTime || '';

      // Load signature if exists
      if (permit.requestorSignature) {
        signaturePads['issuerRequestorSignature'].fromDataURL(permit.requestorSignature);
      }

      // Set issuer info
      document.getElementById('issuerIssuerName').value = permit.selectedIssuer || '';

      // Clear existing info boxes
      const form = document.getElementById('issuerPermitForm');
      const existingBoxes = form.querySelectorAll('.permit-info-box');
      existingBoxes.forEach(box => box.remove());

      // Create and add plant area/department section
      const plantAreaContainer = document.createElement('div');
      plantAreaContainer.className = 'permit-info-box';
      plantAreaContainer.innerHTML = `
    <div class="info-title">Plant Area & Department</div>
    <div class="info-content">
      <div class="row">
        <div class="col-md-6">
          <div><strong>Plant Area:</strong></div>
          <ul>
            ${(permit.plantArea || []).map(a => `<li>${a}</li>`).join('')}
            ${permit.plantAreaOthersSpecify ? `<li>Others: ${permit.plantAreaOthersSpecify}</li>` : ''}
            ${!permit.plantArea?.length && !permit.plantAreaOthersSpecify ? '<li>No area specified</li>' : ''}
          </ul>
        </div>
        <div class="col-md-6">
          <div><strong>Department:</strong></div>
          <ul>
            ${(permit.department || []).map(d => `<li>${d}</li>`).join('')}
            ${permit.departmentOthersSpecify ? `<li>Others: ${permit.departmentOthersSpecify}</li>` : ''}
            ${!permit.department?.length && !permit.departmentOthersSpecify ? '<li>No department specified</li>' : ''}
          </ul>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-md-6">
          <div><strong>Contractor/Company:</strong> ${permit.contractorCompany || 'N/A'}</div>
        </div>
        <div class="col-md-6">
          <div><strong>Number of Employees:</strong> ${permit.numEmployees || 'N/A'}</div>
        </div>
      </div>
    </div>
  `;
      form.insertBefore(plantAreaContainer, form.querySelector('.card'));

      // Add work description section
      const workDescriptionContainer = document.createElement('div');
      workDescriptionContainer.className = 'permit-info-box';
      workDescriptionContainer.innerHTML = `
    <div class="info-title">Description of Work</div>
    <div class="info-content">
      ${permit.workDescription || 'No description provided'}
    </div>
  `;
      form.insertBefore(workDescriptionContainer, form.querySelector('.card'));

      if (permit.permitType === 'lifting' && permit.liftingPlan) {
        const liftingPlanContainer = document.createElement('div');
        liftingPlanContainer.className = 'permit-info-box';

        let liftingPlanHtml = `
        <div class="info-title">Lifting Plan Checklist</div>
        <div class="info-content">
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th width="45%">Lifting Plan Item</th>
                        <th width="15%">Response</th>
                        <th width="40%">Remarks</th>
                    </tr>
                </thead>
                <tbody>
    `;

        permit.liftingPlan.forEach(item => {
          liftingPlanHtml += `
            <tr>
                <td>${item.question}</td>
                <td>${item.response.toUpperCase()}</td>
                <td>${item.remarks || '-'}</td>
            </tr>
        `;
        });

        liftingPlanHtml += `
                </tbody>
            </table>
    `;

        if (permit.loadWeight || permit.riggingWeight) {
          liftingPlanHtml += `
            <div class="mt-3">
                <strong>Load Weight:</strong> ${permit.loadWeight || 'N/A'} kg<br>
                <strong>Rigging Weight:</strong> ${permit.riggingWeight || 'N/A'} kg
            </div>
        `;
        }

        liftingPlanHtml += `</div>`;
        liftingPlanContainer.innerHTML = liftingPlanHtml;
        form.insertBefore(liftingPlanContainer, form.querySelector('.card'));
      }

    // Add lifting equipment section if this is a lifting permit
    if (permit.permitType === 'lifting') {
        const liftingEquipmentContainer = document.createElement('div');
        liftingEquipmentContainer.className = 'permit-info-box';
        liftingEquipmentContainer.innerHTML = `
            <div class="info-title">Lifting Equipment Details</div>
            <div class="info-content">
                <div class="row">
                    <div class="col-md-6">
                        <div><strong>Equipment Type:</strong> ${permit.liftingEquipmentType || 'N/A'}</div>
                        ${permit.liftingEquipmentType === 'other' ? `<div><strong>Other Equipment:</strong> ${permit.otherLiftingEquipment || ''}</div>` : ''}
                        <div><strong>Model:</strong> ${permit.equipmentModel || 'N/A'}</div>
                        <div><strong>Serial Number:</strong> ${permit.equipmentSerialNumber || 'N/A'}</div>
                    </div>
                    <div class="col-md-6">
                        <div><strong>Last Inspection:</strong> ${permit.equipmentInspectionDate || 'N/A'}</div>
                        <div><strong>Cert Expiry:</strong> ${permit.equipmentCertExpiry || 'N/A'}</div>
                    </div>
                </div>
            </div>
        `;
        form.insertBefore(liftingEquipmentContainer, form.querySelector('.card'));

        const loadDetailsContainer = document.createElement('div');
        loadDetailsContainer.className = 'permit-info-box';
        loadDetailsContainer.innerHTML = `
            <div class="info-title">Load Details</div>
            <div class="info-content">
                <div class="row">
                    <div class="col-md-6">
                        <div><strong>Equipment Being Lifted:</strong> ${permit.equipmentToBeLifted || 'N/A'}</div>
                        ${permit.equipmentToBeLifted === 'other' ? `<div><strong>Other Equipment:</strong> ${permit.otherEquipmentToBeLifted || ''}</div>` : ''}
                        <div><strong>Dimensions:</strong> ${permit.equipmentDimensions || 'N/A'}</div>
                    </div>
                    <div class="col-md-6">
                        <div><strong>Special Notes:</strong> ${permit.equipmentSpecialNotes || 'N/A'}</div>
                    </div>
                </div>
            </div>
        `;
        form.insertBefore(loadDetailsContainer, form.querySelector('.card'));

        const calculationsContainer = document.createElement('div');
        calculationsContainer.className = 'permit-info-box';
        calculationsContainer.innerHTML = `
            <div class="info-title">Lifting Calculations</div>
            <div class="info-content">
                <div class="row">
                    <div class="col-md-4">
                        <div><strong>Total Load Weight:</strong> ${permit.totalLoadWeight || '0'} kg</div>
                    </div>
                    <div class="col-md-4">
                        <div><strong>Equipment Capacity:</strong> ${permit.equipmentCapacity || '0'} kg</div>
                    </div>
                    <div class="col-md-4">
                        <div><strong>Safety Factor:</strong> ${permit.safetyFactor || '25'}%</div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-4">
                        <div><strong>Boom Length:</strong> ${permit.boomLength || '0'} m</div>
                    </div>
                    <div class="col-md-4">
                        <div><strong>Boom Angle:</strong> ${permit.boomAngle || '0'}°</div>
                    </div>
                    <div class="col-md-4">
                        <div><strong>Load Radius:</strong> ${permit.loadRadius || '0'} m</div>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <div><strong>Calculated Capacity:</strong> ${permit.calculatedCapacity || '0'} kg</div>
                    </div>
                    <div class="col-md-6">
                        <div><strong>Required Capacity:</strong> ${permit.requiredCapacity || '0'} kg</div>
                    </div>
                </div>
                <div class="alert ${permit.calculatedCapacity >= permit.requiredCapacity ? 'alert-success' : 'alert-danger'} mt-3">
                    <strong>Safety Status:</strong> ${permit.calculatedCapacity >= permit.requiredCapacity ? 'SAFE' : 'UNSAFE'}
                </div>
            </div>
        `;
        form.insertBefore(calculationsContainer, form.querySelector('.card'));
    }

      // Add hazards section
      if (permit.hazards && permit.hazards.length > 0) {
        const hazardsContainer = document.createElement('div');
        hazardsContainer.className = 'permit-info-box';
        hazardsContainer.innerHTML = `
      <div class="info-title">Identified Hazards</div>
      <div class="info-content">
        <ul>
          ${permit.hazards.map(h => `<li>${h}</li>`).join('')}
          ${permit.hazardOthersSpecify ? `<li>Others: ${permit.hazardOthersSpecify}</li>` : ''}
        </ul>
      </div>
    `;
        form.insertBefore(hazardsContainer, form.querySelector('.card'));
      }

      // Add precautions section
      if (permit.precautions && permit.precautions.length > 0) {
        const precautionsContainer = document.createElement('div');
        precautionsContainer.className = 'permit-info-box';
        precautionsContainer.innerHTML = `
      <div class="info-title">Precautions / Mitigation Measures</div>
      <div class="info-content">
        <ul>
          ${permit.precautions.map(p => `<li>${p}</li>`).join('')}
          ${permit.precOthersSpecify ? `<li>Others: ${permit.precOthersSpecify}</li>` : ''}
        </ul>
      </div>
    `;
        form.insertBefore(precautionsContainer, form.querySelector('.card'));
      }

      // Add PPE section
      if (permit.ppe && permit.ppe.length > 0) {
        const ppeContainer = document.createElement('div');
        ppeContainer.className = 'permit-info-box';
        ppeContainer.innerHTML = `
      <div class="info-title">Personal Protective Equipment (PPE)</div>
      <div class="info-content">
        <ul>
          ${permit.ppe.map(p => `<li>${p}</li>`).join('')}
          ${permit.ppeOthersSpecify ? `<li>Others: ${permit.ppeOthersSpecify}</li>` : ''}
        </ul>
      </div>
    `;
        form.insertBefore(ppeContainer, form.querySelector('.card'));
      }

      // Add crew members section
      if (permit.crewMembers && permit.crewMembers.length > 0) {
        const crewContainer = document.createElement('div');
        crewContainer.className = 'permit-info-box';
        crewContainer.innerHTML = `
      <div class="info-title">Crew Members</div>
      <div class="info-content">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>Name</th>
              <th>Iqama Number</th>
              <th>Designation</th>
              <th>Company</th>
            </tr>
          </thead>
          <tbody>
            ${permit.crewMembers.map(member => `
              <tr>
                <td>${member.srNo || ''}</td>
                <td>${member.name || ''}</td>
                <td>${member.iqama || ''}</td>
                <td>${member.designation || ''}</td>
                <td>${member.company || ''}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    `;
        form.insertBefore(crewContainer, form.querySelector('.card'));
      }

      // Update status display
      updateIssuerStatusDisplay(permit.status || 'submitted');
    }

    function updateStatusDisplay(status) {
      const statusElement = document.getElementById('permitStatus');
      const finalStatusElement = document.getElementById('finalStatusDisplay');

      statusElement.className = 'status-badge ' + status;
      statusElement.textContent = status.toUpperCase();

      if (status === 'approved' || status === 'rejected') {
        finalStatusElement.className = `final-status ${status}`;
        finalStatusElement.textContent = `PERMIT ${status.toUpperCase()}`;
        finalStatusElement.classList.remove('d-none');
      } else {
        finalStatusElement.classList.add('d-none');
      }
    }
    document.getElementById('submittedPermitsList').classList.add('d-none');
    document.getElementById('issuerPermitFormCard').classList.remove('d-none');

    // Add this helper function
    function updateIssuerStatusDisplay(status) {
      const statusElement = document.getElementById('issuerPermitStatus');
      const finalStatusElement = document.getElementById('issuerFinalStatusDisplay');

      statusElement.className = 'status-badge ' + status;
      statusElement.textContent = status.toUpperCase();

      if (status === 'approved' || status === 'rejected') {
        finalStatusElement.classList.remove('d-none');
        finalStatusElement.className = `final-status ${status}`;
        finalStatusElement.textContent = status.toUpperCase();
      } else {
        finalStatusElement.classList.add('d-none');
      }
    }

    function clearSignature(signatureId) {
      if (signaturePads[signatureId]) {
        signaturePads[signatureId].clear();
      }
    }


    function resetForm() {
      currentPermitId = null;

      // Reset all form fields
      const form = document.getElementById('generalPermitForm');
      form.reset();

      // Clear all checkboxes
      const checkboxes = form.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = false);

      // Clear all signature pads
      Object.values(signaturePads).forEach(pad => pad.clear());

      // Reset status display
      updateStatusDisplay('draft');

      // Generate new permit number
      document.getElementById('permitNumber').value = '';

      // Set current date
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('dateIssued').value = today;
      document.getElementById('requestorDate').value = today;

      // Set current time
      const now = new Date();
      const time = now.toTimeString().substring(0, 5);
      document.getElementById('requestorTime').value = time;

      // Set default permit type
      document.getElementById('permitType').value = 'general';
    }

    function setDefaultDates() {
      const today = new Date().toISOString().split('T')[0];
      const now = new Date();
      const time = now.toTimeString().substring(0, 5);

      // Set default dates for requester form
      document.getElementById('dateIssued').value = today;
      document.getElementById('requestorDate').value = today;
      document.getElementById('requestorTime').value = time;

      // Set default dates for issuer form
      document.getElementById('issuerDateIssued').value = today;
      document.getElementById('issuerRequestorDate').value = today;
      document.getElementById('issuerRequestorTime').value = time;
      document.getElementById('issuerIssuerDate').value = today;
      document.getElementById('issuerIssuerTime').value = time;
    }

    function createNotification(permitData) {
      const notifications = getNotifications();
      const notificationId = 'notif-' + Date.now();

      notifications[notificationId] = {
        id: notificationId,
        permitId: permitData.id,
        requesterName: permitData.requestorName,
        location: permitData.workLocation,
        date: new Date().toISOString(),
        status: 'pending',
        permitType: permitData.permitType
      };

      localStorage.setItem('notifications', JSON.stringify(notifications));

      // Update notification badge
      checkForPendingPermits();
    }

    function removeNotification(permitId) {
      const notifications = getNotifications();
      let found = false;

      for (const [id, notification] of Object.entries(notifications)) {
        if (notification.permitId === permitId) {
          delete notifications[id];
          found = true;
          break;
        }
      }

      if (found) {
        localStorage.setItem('notifications', JSON.stringify(notifications));
        checkForPendingPermits();
      }
    }

    function getNotifications() {
      const notificationsJson = localStorage.getItem('notifications');
      return notificationsJson ? JSON.parse(notificationsJson) : {};
    }

    function checkForPendingPermits() {
      if (currentMode !== 'issuer') return;

      const notifications = getNotifications();
      const pendingCount = Object.values(notifications).filter(n => n.status === 'pending').length;

      const issuerBadge = document.getElementById('issuerNotificationBadge');
      const activeBadge = document.getElementById('activeNotificationBadge');

      if (pendingCount > 0) {
        issuerBadge.textContent = pendingCount;
        issuerBadge.classList.remove('d-none');
        activeBadge.textContent = pendingCount;
        activeBadge.classList.remove('d-none');
      } else {
        issuerBadge.classList.add('d-none');
        activeBadge.classList.add('d-none');
      }
    }

    function showNotifications() {
      const notifications = getNotifications();
      const pendingNotifications = Object.values(notifications).filter(n => n.status === 'pending');

      const notificationsList = document.getElementById('notificationsList');
      notificationsList.innerHTML = '';

      if (pendingNotifications.length === 0) {
        notificationsList.innerHTML = '<div class="alert alert-info">No pending notifications</div>';
      } else {
        pendingNotifications.forEach(notification => {
          const notificationElement = document.createElement('div');
          notificationElement.className = 'notification-item';
          notificationElement.innerHTML = `
            <div class="d-flex justify-content-between">
              <div>
                <span class="requester-name">${notification.requesterName}</span>
                <span class="location">${notification.location}</span>
                <div class="permit-type">${PERMIT_TYPES[notification.permitType] || 'Permit'}</div>
              </div>
              <div class="date">${new Date(notification.date).toLocaleString()}</div>
            </div>
          `;

          notificationElement.addEventListener('click', () => {
            loadPermitForIssuer(notification.permitId);
            notificationsModal.hide();
          });

          notificationsList.appendChild(notificationElement);
        });
      }

      notificationsModal.show();
    }
    // Add these functions to your script
    function setupFilterControls() {
      // Date range filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          const range = this.getAttribute('data-range');
          document.getElementById('customDateRange').style.display = range === 'custom' ? 'block' : 'none';
          filterPermits(range);
        });
      });

      // Custom date range apply button
      document.getElementById('applyCustomRange').addEventListener('click', function () {
        filterPermits('custom');
      });

      // Tab change handler
      document.getElementById('permitStatusTabs').addEventListener('shown.bs.tab', function () {
        const activeTab = document.querySelector('#permitStatusTabs .nav-link.active');
        const range = document.querySelector('.filter-btn.active')?.getAttribute('data-range') || 'day';
        filterPermits(range);
      });
    }

    function filterPermits(range) {
      const permits = Object.values(getAllPermits()).filter(p => p.status === 'approved' || p.status === 'rejected');
      let filteredPermits = [];
      const now = new Date();

      switch (range) {
        case 'day':
          filteredPermits = permits.filter(p => {
            const permitDate = new Date(p.issuerDate || p.dateIssued);
            return isSameDay(permitDate, now);
          });
          break;
        case 'week':
          filteredPermits = permits.filter(p => {
            const permitDate = new Date(p.issuerDate || p.dateIssued);
            return isSameWeek(permitDate, now);
          });
          break;
        case 'month':
          filteredPermits = permits.filter(p => {
            const permitDate = new Date(p.issuerDate || p.dateIssued);
            return isSameMonth(permitDate, now);
          });
          break;
        case 'custom':
          const fromDate = new Date(document.getElementById('dateFrom').value);
          const toDate = new Date(document.getElementById('dateTo').value);
          filteredPermits = permits.filter(p => {
            const permitDate = new Date(p.issuerDate || p.dateIssued);
            return permitDate >= fromDate && permitDate <= toDate;
          });
          break;
        default:
          filteredPermits = permits;
      }

      renderFilteredPermits(filteredPermits);
    }

    function isSameDay(date1, date2) {
      return date1.getFullYear() === date2.getFullYear() &&
        date1.getMonth() === date2.getMonth() &&
        date1.getDate() === date2.getDate();
    }

    function isSameWeek(date1, date2) {
      const oneDay = 24 * 60 * 60 * 1000;
      const diffDays = Math.round(Math.abs((date1 - date2) / oneDay));
      return diffDays < 7 && date1.getDay() <= date2.getDay();
    }

    function isSameMonth(date1, date2) {
      return date1.getFullYear() === date2.getFullYear() &&
        date1.getMonth() === date2.getMonth();
    }

    function renderFilteredPermits(permits) {
      const activeTab = document.querySelector('#permitStatusTabs .nav-link.active').id;
      const isApprovedTab = activeTab === 'approved-tab';

      const filtered = permits.filter(p =>
        isApprovedTab ? p.status === 'approved' : p.status === 'rejected'
      );

      const containerId = isApprovedTab ? 'approvedPermitsList' : 'rejectedPermitsList';
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      if (filtered.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No permits found</div>';
        return;
      }

      // Sort by date (newest first)
      const sortedPermits = filtered.sort((a, b) => {
        const dateA = new Date(a.issuerDate || a.dateIssued);
        const dateB = new Date(b.issuerDate || b.dateIssued);
        return dateB - dateA;
      });

      sortedPermits.forEach(permit => {
        const permitElement = document.createElement('div');
        permitElement.className = 'permit-list-item';
        permitElement.innerHTML = `
      <div class="d-flex justify-content-between">
        <div class="permit-number">${permit.permitNumber || 'No Number'} (${PERMIT_TYPES[permit.permitType] || 'Permit'})</div>
        <div class="permit-status">
          <span class="badge ${permit.status === 'approved' ? 'bg-success' : 'bg-danger'}">
            ${permit.status.toUpperCase()}
          </span>
        </div>
      </div>
      <div class="permit-details">
        <div><span class="detail-label">Requester:</span> ${permit.requestorName || 'Unknown'}</div>
        <div><span class="detail-label">Issuer:</span> ${permit.issuerName || 'Not specified'}</div>
        <div><span class="detail-label">Status Date:</span> ${permit.issuerDate || 'Not specified'}</div>
      </div>
      <div class="mt-2">
        <button class="btn btn-sm btn-outline-primary view-permit-btn" data-permit-id="${permit.id}">
          <i class="bi bi-eye"></i> View
        </button>
        <button class="btn btn-sm btn-outline-secondary download-permit-btn" data-permit-id="${permit.id}">
          <i class="bi bi-download"></i> Download
        </button>
      </div>
    `;

        container.appendChild(permitElement);
      });

      // Reattach event listeners
      document.querySelectorAll('.view-permit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const permitId = e.target.getAttribute('data-permit-id') ||
            e.target.closest('button').getAttribute('data-permit-id');
          viewPermitDetails(permitId);
        });
      });

      document.querySelectorAll('.download-permit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const permitId = e.target.getAttribute('data-permit-id') ||
            e.target.closest('button').getAttribute('data-permit-id');
          downloadPermitAsPDF(permitId);
        });
      });
    }
    function viewPermitDetails(permitId) {
      const permit = getPermit(permitId);
      if (!permit) {
        alert('Permit not found');
        return;
      }

      // Create a modal to display permit details
      const modalHtml = `
        <div class="modal fade" id="permitDetailsModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-xl">
            <div class="modal-content">
               <div class="header-section text-center mb-4">
               <h2>South Jeddah Noor 300MW<sub>AC</sub> Solar Plant</h2>
                <h4>O&M Permit to Work Management</h4>
             </div>
              <div class="modal-header">
                <h5 class="modal-title">Permit Details - ${permit.permitNumber} (${PERMIT_TYPES[permit.permitType] || 'Permit'})</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="permit-info-box">
                  <div class="info-title">Basic Information</div>
                  <div class="info-content">
                    <div><strong>Permit Type:</strong> ${PERMIT_TYPES[permit.permitType] || 'General Work Permit'}</div>
                    <div><strong>Plant Name:</strong> ${permit.plantName}</div>
                    <div><strong>Status:</strong> <span class="badge ${permit.status === 'approved' ? 'bg-success' : 'bg-danger'}">${permit.status.toUpperCase()}</span></div>
                    <div><strong>Date Issued:</strong> ${permit.dateIssued}</div>
                  </div>
                </div>
                <div class="permit-info-box">
    <div class="info-title">Plant Area & Department</div>
    <div class="info-content">
      <div class="row">
        <div class="col-md-6">
          <div><strong>Plant Area:</strong></div>
          <ul>
            ${(permit.plantArea || []).map(a => `<li>${a}</li>`).join('')}
            ${permit.plantAreaOthersSpecify ? `<li>Others: ${permit.plantAreaOthersSpecify}</li>` : ''}
            ${!permit.plantArea?.length && !permit.plantAreaOthersSpecify ? '<li>No area specified</li>' : ''}
          </ul>
        </div>
        <div class="col-md-6">
          <div><strong>Department:</strong></div>
          <ul>
            ${(permit.department || []).map(d => `<li>${d}</li>`).join('')}
            ${permit.departmentOthersSpecify ? `<li>Others: ${permit.departmentOthersSpecify}</li>` : ''}
            ${!permit.department?.length && !permit.departmentOthersSpecify ? '<li>No department specified</li>' : ''}
          </ul>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-md-6">
          <div><strong>Contractor/Company:</strong> ${permit.contractorCompany || 'N/A'}</div>
        </div>
        <div class="col-md-6">
          <div><strong>Number of Employees:</strong> ${permit.numEmployees || 'N/A'}</div>
        </div>
      </div>
    </div>
  </div>
                <div class="permit-info-box">
                 <div class="info-title">Work Execution Plan</div>
                   <div class="info-content">
                   <div class="row">
                   <div class="col-md-6">
                   <div><strong>Valid From:</strong> ${permit.validFrom || 'N/A'}</div>
                   <div><strong>Valid To:</strong> ${permit.validTo || 'N/A'}</div>
                   <div><strong>Location of Work:</strong> ${permit.locationOfWork || 'N/A'}</div>
                 </div>
                 <div class="col-md-6">
                 <div><strong>Equipment Functional Name:</strong> ${permit.functionalName || 'N/A'}</div>
                 <div><strong>Equipment Identification Number:</strong> ${permit.equipmentNo || 'N/A'}</div>
                 <div><strong>Tools and Equipment:</strong> ${permit.equipmentType || 'N/A'}</div>
                 </div>
              </div>
            </div>
          </div>

           ${permit.permitType === 'lifting' && permit.liftingPlan ? `
                        <div class="permit-info-box">
                            <div class="info-title">Lifting Plan Checklist</div>
                            <div class="info-content">
                                <table class="table table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th width="45%">Lifting Plan Item</th>
                                            <th width="15%">Response</th>
                                            <th width="40%">Remarks</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${permit.liftingPlan.map(item => `
                                            <tr>
                                                <td>${item.question}</td>
                                                <td>${item.response.toUpperCase()}</td>
                                                <td>${item.remarks || '-'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                                ${permit.loadWeight || permit.riggingWeight ? `
                                <div class="mt-3">
                                    <strong>Load Weight:</strong> ${permit.loadWeight || 'N/A'} kg<br>
                                    <strong>Rigging Weight:</strong> ${permit.riggingWeight || 'N/A'} kg
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        ` : ''}  
                        
                    ${permit.permitType === 'lifting' ? `
                        <div class="permit-info-box">
                            <div class="info-title">Lifting Equipment Details</div>
                            <div class="info-content">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div><strong>Equipment Type:</strong> ${permit.liftingEquipmentType || 'N/A'}</div>
                                        ${permit.liftingEquipmentType === 'other' ? `<div><strong>Other Equipment:</strong> ${permit.otherLiftingEquipment || ''}</div>` : ''}
                                        <div><strong>Model:</strong> ${permit.equipmentModel || 'N/A'}</div>
                                        <div><strong>Serial Number:</strong> ${permit.equipmentSerialNumber || 'N/A'}</div>
                                    </div>
                                    <div class="col-md-6">
                                        <div><strong>Last Inspection:</strong> ${permit.equipmentInspectionDate || 'N/A'}</div>
                                        <div><strong>Cert Expiry:</strong> ${permit.equipmentCertExpiry || 'N/A'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permit-info-box">
                            <div class="info-title">Load Details</div>
                            <div class="info-content">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div><strong>Equipment Being Lifted:</strong> ${permit.equipmentToBeLifted || 'N/A'}</div>
                                        ${permit.equipmentToBeLifted === 'other' ? `<div><strong>Other Equipment:</strong> ${permit.otherEquipmentToBeLifted || ''}</div>` : ''}
                                        <div><strong>Dimensions:</strong> ${permit.equipmentDimensions || 'N/A'}</div>
                                    </div>
                                    <div class="col-md-6">
                                        <div><strong>Special Notes:</strong> ${permit.equipmentSpecialNotes || 'N/A'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="permit-info-box">
                            <div class="info-title">Lifting Calculations</div>
                            <div class="info-content">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div><strong>Total Load Weight:</strong> ${permit.totalLoadWeight || '0'} kg</div>
                                    </div>
                                    <div class="col-md-4">
                                        <div><strong>Equipment Capacity:</strong> ${permit.equipmentCapacity || '0'} kg</div>
                                    </div>
                                    <div class="col-md-4">
                                        <div><strong>Safety Factor:</strong> ${permit.safetyFactor || '25'}%</div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4">
                                        <div><strong>Boom Length:</strong> ${permit.boomLength || '0'} m</div>
                                    </div>
                                    <div class="col-md-4">
                                        <div><strong>Boom Angle:</strong> ${permit.boomAngle || '0'}°</div>
                                    </div>
                                    <div class="col-md-4">
                                        <div><strong>Load Radius:</strong> ${permit.loadRadius || '0'} m</div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-6">
                                        <div><strong>Calculated Capacity:</strong> ${permit.calculatedCapacity || '0'} kg</div>
                                    </div>
                                    <div class="col-md-6">
                                        <div><strong>Required Capacity:</strong> ${permit.requiredCapacity || '0'} kg</div>
                                    </div>
                                </div>
                                <div class="alert ${permit.calculatedCapacity >= permit.requiredCapacity ? 'alert-success' : 'alert-danger'} mt-3">
                                    <strong>Safety Status:</strong> ${permit.calculatedCapacity >= permit.requiredCapacity ? 'SAFE' : 'UNSAFE'}
                                </div>
                            </div>
                        </div>
                        ` : ''}       

          <div class="permit-info-box">
  <div class="info-title">Description of Work</div>
  <div class="info-content">
    ${permit.workDescription || 'No description provided'}
  </div>
</div>    

                <div class="permit-info-box">
                  <div class="info-title">Safety Information</div>
                  <div class="info-content">
                    <div class="row">
                    <div class="col-md-4">
                    <div><strong>Hazards:</strong></div>
                    <ul>
                    ${(permit.hazards || []).map(h => `<li>${h}</li>`).join('')}
                    ${permit.hazardOthersSpecify ? `<li>Others: ${permit.hazardOthersSpecify}</li>` : ''}
                    ${!permit.hazards?.length && !permit.hazardOthersSpecify ? '<li>No hazards specified</li>' : ''}
                    </ul>
                  </div>

                     <div class="col-md-4">
  <div><strong>Precautions:</strong></div>
  <ul>
    ${(permit.precautions || []).map(p => `<li>${p}</li>`).join('')}
    ${permit.precOthersSpecify ? `<li>Others: ${permit.precOthersSpecify}</li>` : ''}
    ${!permit.precautions?.length && !permit.precOthersSpecify ? '<li>No precautions specified</li>' : ''}
  </ul>
</div>
                      <div class="col-md-4">
                        <div><strong>PPE:</strong></div>
                        <ul>
                          ${(permit.ppe || []).map(p => `<li>${p}</li>`).join('')}
                          ${permit.ppeOthersSpecify ? `<li>Others: ${permit.ppeOthersSpecify}</li>` : ''}
                          ${!permit.ppe?.length && !permit.ppeOthersSpecify ? '<li>No ppe specified</li>' : ''}
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
<div class="permit-info-box">
      <div class="info-title">Attached Documents</div>
      <div class="info-content">
        <ul>
          ${(permit.documents || []).map(d => `<li>${d}</li>`).join('')}
          ${permit.docOthersSpecify ? `<li>Others: ${permit.docOthersSpecify}</li>` : ''}
          ${!permit.documents?.length && !permit.docOthersSpecify ? '<li>No documents specified</li>' : ''}
        </ul>
      </div>
    </div>
    <div class="permit-info-box">
      <div class="info-title">Night Work Checklist</div>
      <div class="info-content">
        <div><strong>Emergency Power Backup:</strong> ${permit.nightWork?.includes('Is sufficient emergency power backup available') ? 'Yes' : 'No'}</div>
        ${permit.nightWorkOtherChecks ? `<div><strong>Other Checks:</strong> ${permit.nightWorkOtherChecks}</div>` : ''}
      </div>
    </div>



              <div class="permit-info-box">
      <div class="info-title">Crew Members</div>
      <div class="info-content">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Sr No.</th>
              <th>Name</th>
              <th>Iqama Number</th>
              <th>Designation</th>
              <th>Company</th>
            </tr>
          </thead>
          <tbody>
            ${(permit.crewMembers || []).map(member => `
              <tr>
                <td>${member.srNo}</td>
                <td>${member.name}</td>
                <td>${member.iqama}</td>
                <td>${member.designation}</td>
                <td>${member.company}</td>
              </tr>
            `).join('')}
            ${!permit.crewMembers?.length ? '<tr><td colspan="5">No crew members specified</td></tr>' : ''}
          </tbody>
        </table>
      </div>
    </div>


 <div class="row">
   <div class="col-md-6">
                  <div class="permit-info-box">
                  <div class="info-title">Requestor Information</div>
                  <div class="info-content">
                    <div><strong>Name:</strong> ${permit.requestorName}</div>
                    <div><strong>Date:</strong> ${permit.requestorDate} ${permit.requestorTime}</div>
                  </div>
                  </div>
                </div>
                 <div class="col-md-6">
            <div class="permit-info-box">
              <div class="info-title">Requestor Signature</div>
              <div class="info-content">
                ${permit.requestorSignature ?
          `<img src="${permit.requestorSignature}" alt="Requestor Signature">` :
          '<div>No signature available</div>'}
              </div>
            </div>
          </div>
 </div>
           
    <div class="row">
      
          <div class="col-md-6">
        <div class="permit-info-box">
                  <div class="info-title">Issuer Information</div>
                  <div class="info-content">
                    <div><strong>Name:</strong> ${permit.issuerName || 'N/A'}</div>
                    <div><strong>Date:</strong> ${permit.issuerDate || 'N/A'} ${permit.issuerTime || ''}</div>
                  </div>
                </div>
          </div>

          <div class="col-md-6">
            <div class="permit-info-box">
              <div class="info-title">Issuer Signature</div>
              <div class="info-content">
                ${permit.issuerSignature ?
          `<img src="${permit.issuerSignature}" alt="Issuer Signature">` :
          '<div>No signature available</div>'}
              </div>
            </div>
          </div>
        </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="downloadPermitFromModal" data-permit-id="${permitId}">
                  <i class="bi bi-download"></i> Download
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      // Add modal to DOM
      const modalContainer = document.createElement('div');
      modalContainer.innerHTML = modalHtml;
      document.body.appendChild(modalContainer);

      // Show the modal
      const modal = new bootstrap.Modal(document.getElementById('permitDetailsModal'));
      modal.show();

      // Add event listener for download button
      document.getElementById('downloadPermitFromModal').addEventListener('click', () => {
        downloadPermitAsPDF(permitId);
        modal.hide();
      });

      // Remove modal from DOM after it's hidden
      document.getElementById('permitDetailsModal').addEventListener('hidden.bs.modal', () => {
        modalContainer.remove();
      });
    }
    function downloadPermitAsPDF(permitId) {
      const permit = getPermit(permitId);
      if (!permit) {
        alert('Permit not found');
        return;
      }

      // Create a temporary div to hold the content for PDF generation
      const pdfContainer = document.createElement('div');
      pdfContainer.id = 'pdf-container'; // Add ID for CSS targeting
      pdfContainer.style.width = '190mm'; // Reduced width for margins
      pdfContainer.style.padding = '15px';
      pdfContainer.style.fontFamily = 'Arial, sans-serif';
      pdfContainer.style.boxSizing = 'border-box';

      // Add the same content as the modal but optimized for PDF
      pdfContainer.innerHTML = `
    <div style="width: 100%; overflow: hidden;">
     <div class="header-section text-center mb-4">
      <h2 style="margin-bottom: 5px;">South Jeddah Noor 300MW<sub>AC</sub> Solar Plant</h2>
      <h4 style="margin-top: 0;">O&M Permit to Work Management</h4>
      <hr style="border-top: 2px solid #000;">
    </div>
    
    <h3 style="text-align: center; margin-bottom: 20px;">
      Permit Details - ${permit.permitNumber} (${PERMIT_TYPES[permit.permitType] || 'Permit'})
    </h3>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Basic Information</div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
        <div><strong>Permit Type:</strong> ${PERMIT_TYPES[permit.permitType] || 'General Work Permit'}</div>
        <div><strong>Plant Name:</strong> ${permit.plantName}</div>
        <div><strong>Status:</strong> <span style="background-color: ${permit.status === 'approved' ? '#28a745' : '#dc3545'}; color: white; padding: 2px 5px; border-radius: 3px;">${permit.status.toUpperCase()}</span></div>
        <div><strong>Date Issued:</strong> ${permit.dateIssued}</div>
      </div>
    </div>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Plant Area & Department</div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
        <div>
          <div><strong>Plant Area:</strong></div>
          <ul style="margin-top: 5px; padding-left: 20px;">
            ${(permit.plantArea || []).map(a => `<li>${a}</li>`).join('')}
            ${permit.plantAreaOthersSpecify ? `<li>Others: ${permit.plantAreaOthersSpecify}</li>` : ''}
            ${!permit.plantArea?.length && !permit.plantAreaOthersSpecify ? '<li>No area specified</li>' : ''}
          </ul>
        </div>
        <div>
          <div><strong>Department:</strong></div>
          <ul style="margin-top: 5px; padding-left: 20px;">
            ${(permit.department || []).map(d => `<li>${d}</li>`).join('')}
            ${permit.departmentOthersSpecify ? `<li>Others: ${permit.departmentOthersSpecify}</li>` : ''}
            ${!permit.department?.length && !permit.departmentOthersSpecify ? '<li>No department specified</li>' : ''}
          </ul>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 10px;">
        <div><strong>Contractor/Company:</strong> ${permit.contractorCompany || 'N/A'}</div>
        <div><strong>Number of Employees:</strong> ${permit.numEmployees || 'N/A'}</div>
      </div>
    </div>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Work Execution Plan</div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
        <div>
          <div><strong>Valid From:</strong> ${permit.validFrom || 'N/A'}</div>
          <div><strong>Valid To:</strong> ${permit.validTo || 'N/A'}</div>
          <div><strong>Location of Work:</strong> ${permit.locationOfWork || 'N/A'}</div>
        </div>
        <div>
          <div><strong>Equipment Functional Name:</strong> ${permit.functionalName || 'N/A'}</div>
          <div><strong>Equipment Identification Number:</strong> ${permit.equipmentNo || 'N/A'}</div>
          <div><strong>Tools and Equipment:</strong> ${permit.equipmentType || 'N/A'}</div>
        </div>
      </div>
    </div>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Description of Work</div>
      <div>${permit.workDescription || 'No description provided'}</div>
    </div>
     ${permit.permitType === 'lifting' && permit.liftingPlan ? `
            <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
                <div style="font-weight: bold; margin-bottom: 5px;">Lifting Plan Checklist</div>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th style="border: 1px solid #000; padding: 8px; text-align: left; width: 45%;">Lifting Plan Item</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: left; width: 15%;">Response</th>
                            <th style="border: 1px solid #000; padding: 8px; text-align: left; width: 40%;">Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${permit.liftingPlan.map(item => `
                            <tr>
                                <td style="border: 1px solid #000; padding: 8px;">${item.question}</td>
                                <td style="border: 1px solid #000; padding: 8px;">${item.response.toUpperCase()}</td>
                                <td style="border: 1px solid #000; padding: 8px;">${item.remarks || '-'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                ${permit.loadWeight || permit.riggingWeight ? `
                <div>
                    <strong>Load Weight:</strong> ${permit.loadWeight || 'N/A'} kg<br>
                    <strong>Rigging Weight:</strong> ${permit.riggingWeight || 'N/A'} kg
                </div>
                ` : ''}
            </div>
            ` : ''}
             ${permit.permitType === 'lifting' ? `
            <div style="margin-bottom: 15px;">
                <h4 style="color: #1a5276; border-bottom: 1px solid #3498db; padding-bottom: 3px;">Lifting Equipment Details</h4>
                <div style="display: flex;">
                    <div style="width: 50%;">
                        <div><strong>Equipment Type:</strong> ${permit.liftingEquipmentType || 'N/A'}</div>
                        ${permit.liftingEquipmentType === 'other' ? `<div><strong>Other Equipment:</strong> ${permit.otherLiftingEquipment || ''}</div>` : ''}
                        <div><strong>Model:</strong> ${permit.equipmentModel || 'N/A'}</div>
                        <div><strong>Serial Number:</strong> ${permit.equipmentSerialNumber || 'N/A'}</div>
                    </div>
                    <div style="width: 50%;">
                        <div><strong>Last Inspection:</strong> ${permit.equipmentInspectionDate || 'N/A'}</div>
                        <div><strong>Cert Expiry:</strong> ${permit.equipmentCertExpiry || 'N/A'}</div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #1a5276; border-bottom: 1px solid #3498db; padding-bottom: 3px;">Load Details</h4>
                <div style="display: flex;">
                    <div style="width: 50%;">
                        <div><strong>Equipment Being Lifted:</strong> ${permit.equipmentToBeLifted || 'N/A'}</div>
                        ${permit.equipmentToBeLifted === 'other' ? `<div><strong>Other Equipment:</strong> ${permit.otherEquipmentToBeLifted || ''}</div>` : ''}
                        <div><strong>Dimensions:</strong> ${permit.equipmentDimensions || 'N/A'}</div>
                    </div>
                    <div style="width: 50%;">
                        <div><strong>Special Notes:</strong> ${permit.equipmentSpecialNotes || 'N/A'}</div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #1a5276; border-bottom: 1px solid #3498db; padding-bottom: 3px;">Lifting Calculations</h4>
                <div style="display: flex; flex-wrap: wrap;">
                    <div style="width: 33%;"><strong>Total Load Weight:</strong> ${permit.totalLoadWeight || '0'} kg</div>
                    <div style="width: 33%;"><strong>Equipment Capacity:</strong> ${permit.equipmentCapacity || '0'} kg</div>
                    <div style="width: 33%;"><strong>Safety Factor:</strong> ${permit.safetyFactor || '25'}%</div>
                    <div style="width: 33%;"><strong>Boom Length:</strong> ${permit.boomLength || '0'} m</div>
                    <div style="width: 33%;"><strong>Boom Angle:</strong> ${permit.boomAngle || '0'}°</div>
                    <div style="width: 33%;"><strong>Load Radius:</strong> ${permit.loadRadius || '0'} m</div>
                    <div style="width: 50%;"><strong>Calculated Capacity:</strong> ${permit.calculatedCapacity || '0'} kg</div>
                    <div style="width: 50%;"><strong>Required Capacity:</strong> ${permit.requiredCapacity || '0'} kg</div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background-color: ${permit.calculatedCapacity >= permit.requiredCapacity ? '#d4edda' : '#f8d7da'}; border: 1px solid ${permit.calculatedCapacity >= permit.requiredCapacity ? '#c3e6cb' : '#f5c6cb'};">
                    <strong>Safety Status:</strong> ${permit.calculatedCapacity >= permit.requiredCapacity ? 'SAFE' : 'UNSAFE'}
                </div>
            </div>
            ` : ''}
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Safety Information</div>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
        <div>
          <div><strong>Hazards:</strong></div>
          <ul style="margin-top: 5px; padding-left: 20px;">
            ${(permit.hazards || []).map(h => `<li>${h}</li>`).join('')}
            ${permit.hazardOthersSpecify ? `<li>Others: ${permit.hazardOthersSpecify}</li>` : ''}
            ${!permit.hazards?.length && !permit.hazardOthersSpecify ? '<li>No hazards specified</li>' : ''}
          </ul>
        </div>
        <div>
          <div><strong>Precautions:</strong></div>
          <ul style="margin-top: 5px; padding-left: 20px;">
            ${(permit.precautions || []).map(p => `<li>${p}</li>`).join('')}
            ${permit.precOthersSpecify ? `<li>Others: ${permit.precOthersSpecify}</li>` : ''}
            ${!permit.precautions?.length && !permit.precOthersSpecify ? '<li>No precautions specified</li>' : ''}
          </ul>
        </div>
        <div>
          <div><strong>PPE:</strong></div>
          <ul style="margin-top: 5px; padding-left: 20px;">
            ${(permit.ppe || []).map(p => `<li>${p}</li>`).join('')}
            ${permit.ppeOthersSpecify ? `<li>Others: ${permit.ppeOthersSpecify}</li>` : ''}
            ${!permit.ppe?.length && !permit.ppeOthersSpecify ? '<li>No PPE specified</li>' : ''}
          </ul>
        </div>
      </div>
    </div>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Attached Documents</div>
      <ul style="margin-top: 5px; padding-left: 20px;">
        ${(permit.documents || []).map(d => `<li>${d}</li>`).join('')}
        ${permit.docOthersSpecify ? `<li>Others: ${permit.docOthersSpecify}</li>` : ''}
        ${!permit.documents?.length && !permit.docOthersSpecify ? '<li>No documents specified</li>' : ''}
      </ul>
    </div>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Night Work Checklist</div>
      <div><strong>Emergency Power Backup:</strong> ${permit.nightWork?.includes('Is sufficient emergency power backup available') ? 'Yes' : 'No'}</div>
      ${permit.nightWorkOtherChecks ? `<div><strong>Other Checks:</strong> ${permit.nightWorkOtherChecks}</div>` : ''}
    </div>
    
    <div style="border: 1px solid #000; padding: 10px; margin-bottom: 15px;">
      <div style="font-weight: bold; margin-bottom: 5px;">Crew Members</div>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background-color: #f2f2f2;">
            <th style="border: 1px solid #000; padding: 8px; text-align: left;">Sr No.</th>
            <th style="border: 1px solid #000; padding: 8px; text-align: left;">Name</th>
            <th style="border: 1px solid #000; padding: 8px; text-align: left;">Iqama Number</th>
            <th style="border: 1px solid #000; padding: 8px; text-align: left;">Designation</th>
            <th style="border: 1px solid #000; padding: 8px; text-align: left;">Company</th>
          </tr>
        </thead>
        <tbody>
          ${(permit.crewMembers || []).map(member => `
            <tr>
              <td style="border: 1px solid #000; padding: 8px;">${member.srNo}</td>
              <td style="border: 1px solid #000; padding: 8px;">${member.name}</td>
              <td style="border: 1px solid #000; padding: 8px;">${member.iqama}</td>
              <td style="border: 1px solid #000; padding: 8px;">${member.designation}</td>
              <td style="border: 1px solid #000; padding: 8px;">${member.company}</td>
            </tr>
          `).join('')}
          ${!permit.crewMembers?.length ? '<tr><td colspan="5" style="border: 1px solid #000; padding: 8px; text-align: center;">No crew members specified</td></tr>' : ''}
        </tbody>
      </table>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
      <div style="border: 1px solid #000; padding: 10px;">
        <div style="font-weight: bold; margin-bottom: 5px;">Requestor Information</div>
        <div><strong>Name:</strong> ${permit.requestorName}</div>
        <div><strong>Date:</strong> ${permit.requestorDate} ${permit.requestorTime}</div>
      </div>
      <div style="border: 1px solid #000; padding: 10px;">
        <div style="font-weight: bold; margin-bottom: 5px;">Requestor Signature</div>
        <div style="min-height: 50px;">
          ${permit.requestorSignature ?
          `<img src="${permit.requestorSignature}" alt="Requestor Signature" style="max-width: 200px; max-height: 80px;">` :
          '<div>No signature available</div>'}
        </div>
      </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
      <div style="border: 1px solid #000; padding: 10px;">
        <div style="font-weight: bold; margin-bottom: 5px;">Issuer Information</div>
        <div><strong>Name:</strong> ${permit.issuerName || 'N/A'}</div>
        <div><strong>Date:</strong> ${permit.issuerDate || 'N/A'} ${permit.issuerTime || ''}</div>
      </div>
      <div style="border: 1px solid #000; padding: 10px;">
        <div style="font-weight: bold; margin-bottom: 5px;">Issuer Signature</div>
        <div style="min-height: 50px;">
          ${permit.issuerSignature ?
          `<img src="${permit.issuerSignature}" alt="Issuer Signature" style="max-width: 200px; max-height: 80px;">` :
          '<div>No signature available</div>'}
        </div>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #666;">
      Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
    </div>
    </div>
  `;

      // Add the container to the body temporarily
      document.body.appendChild(pdfContainer);

      // Use html2pdf library to generate the PDF
      const options = {
        margin: [5, 5, 5, 5], // [top, right, bottom, left] margins in mm
        filename: `Permit_${permit.permitNumber}.pdf`,
        image: { type: 'jpeg', quality: 1 },
        html2canvas: {
          scale: 2,
          useCORS: true,
          letterRendering: true,
          allowTaint: true,
          scrollX: 0,
          scrollY: 0
        },
        jsPDF: {
          unit: 'mm',
          format: 'a4',
          orientation: 'portrait',
          hotfixes: ["px_scaling"]
        }
      };

      // Generate the PDF
      html2pdf().from(pdfContainer).set(options).save().then(() => {
        // Remove the temporary container
        document.body.removeChild(pdfContainer);
      });
    }


    function clearSignature(signatureId) {
      if (signaturePads[signatureId]) {
        signaturePads[signatureId].clear();
      }
    }

    // Initialize the app
    window.onload = function () {
      // Set current date and time for all date fields
      setDefaultDates();

      // Check for pending permits if in issuer mode
      if (currentMode === 'issuer') {
        checkForPendingPermits();
      }
    };
  </script>
</body>

</html>